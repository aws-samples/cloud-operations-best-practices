"use strict";(self.webpackChunkaws_cloud_operations_best_practices=self.webpackChunkaws_cloud_operations_best_practices||[]).push([[9643],{1470:(e,s,a)=>{a.d(s,{A:()=>j});var n=a(6540),t=a(4164),r=a(3104),c=a(6347),i=a(205),o=a(7485),l=a(1682),u=a(679);function d(e){return n.Children.toArray(e).filter((e=>"\n"!==e)).map((e=>{if(!e||(0,n.isValidElement)(e)&&function(e){const{props:s}=e;return!!s&&"object"==typeof s&&"value"in s}(e))return e;throw new Error(`Docusaurus error: Bad <Tabs> child <${"string"==typeof e.type?e.type:e.type.name}>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.`)}))?.filter(Boolean)??[]}function p(e){const{values:s,children:a}=e;return(0,n.useMemo)((()=>{const e=s??function(e){return d(e).map((({props:{value:e,label:s,attributes:a,default:n}})=>({value:e,label:s,attributes:a,default:n})))}(a);return function(e){const s=(0,l.XI)(e,((e,s)=>e.value===s.value));if(s.length>0)throw new Error(`Docusaurus error: Duplicate values "${s.map((e=>e.value)).join(", ")}" found in <Tabs>. Every value needs to be unique.`)}(e),e}),[s,a])}function m({value:e,tabValues:s}){return s.some((s=>s.value===e))}function v({queryString:e=!1,groupId:s}){const a=(0,c.W6)(),t=function({queryString:e=!1,groupId:s}){if("string"==typeof e)return e;if(!1===e)return null;if(!0===e&&!s)throw new Error('Docusaurus error: The <Tabs> component groupId prop is required if queryString=true, because this value is used as the search param name. You can also provide an explicit value such as queryString="my-search-param".');return s??null}({queryString:e,groupId:s});return[(0,o.aZ)(t),(0,n.useCallback)((e=>{if(!t)return;const s=new URLSearchParams(a.location.search);s.set(t,e),a.replace({...a.location,search:s.toString()})}),[t,a])]}function h(e){const{defaultValue:s,queryString:a=!1,groupId:t}=e,r=p(e),[c,o]=(0,n.useState)((()=>function({defaultValue:e,tabValues:s}){if(0===s.length)throw new Error("Docusaurus error: the <Tabs> component requires at least one <TabItem> children component");if(e){if(!m({value:e,tabValues:s}))throw new Error(`Docusaurus error: The <Tabs> has a defaultValue "${e}" but none of its children has the corresponding value. Available values are: ${s.map((e=>e.value)).join(", ")}. If you intend to show no default tab, use defaultValue={null} instead.`);return e}const a=s.find((e=>e.default))??s[0];if(!a)throw new Error("Unexpected error: 0 tabValues");return a.value}({defaultValue:s,tabValues:r}))),[l,d]=v({queryString:a,groupId:t}),[h,f]=function({groupId:e}){const s=function(e){return e?`docusaurus.tab.${e}`:null}(e),[a,t]=(0,u.Dv)(s);return[a,(0,n.useCallback)((e=>{s&&t.set(e)}),[s,t])]}({groupId:t}),b=(()=>{const e=l??h;return m({value:e,tabValues:r})?e:null})();(0,i.A)((()=>{b&&o(b)}),[b]);return{selectedValue:c,selectValue:(0,n.useCallback)((e=>{if(!m({value:e,tabValues:r}))throw new Error(`Can't select invalid tab value=${e}`);o(e),d(e),f(e)}),[d,f,r]),tabValues:r}}var f=a(2303);const b={tabList:"tabList__CuJ",tabItem:"tabItem_LNqP"};var A=a(4848);function g({className:e,block:s,selectedValue:a,selectValue:n,tabValues:c}){const i=[],{blockElementScrollPositionUntilNextRender:o}=(0,r.a_)(),l=e=>{const s=e.currentTarget,t=i.indexOf(s),r=c[t].value;r!==a&&(o(s),n(r))},u=e=>{let s=null;switch(e.key){case"Enter":l(e);break;case"ArrowRight":{const a=i.indexOf(e.currentTarget)+1;s=i[a]??i[0];break}case"ArrowLeft":{const a=i.indexOf(e.currentTarget)-1;s=i[a]??i[i.length-1];break}}s?.focus()};return(0,A.jsx)("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,t.A)("tabs",{"tabs--block":s},e),children:c.map((({value:e,label:s,attributes:n})=>(0,A.jsx)("li",{role:"tab",tabIndex:a===e?0:-1,"aria-selected":a===e,ref:e=>{i.push(e)},onKeyDown:u,onClick:l,...n,className:(0,t.A)("tabs__item",b.tabItem,n?.className,{"tabs__item--active":a===e}),children:s??e},e)))})}function x({lazy:e,children:s,selectedValue:a}){const r=(Array.isArray(s)?s:[s]).filter(Boolean);if(e){const e=r.find((e=>e.props.value===a));return e?(0,n.cloneElement)(e,{className:(0,t.A)("margin-top--md",e.props.className)}):null}return(0,A.jsx)("div",{className:"margin-top--md",children:r.map(((e,s)=>(0,n.cloneElement)(e,{key:s,hidden:e.props.value!==a})))})}function q(e){const s=h(e);return(0,A.jsxs)("div",{className:(0,t.A)("tabs-container",b.tabList),children:[(0,A.jsx)(g,{...s,...e}),(0,A.jsx)(x,{...s,...e})]})}function j(e){const s=(0,f.A)();return(0,A.jsx)(q,{...e,children:d(e.children)},String(s))}},1902:(e,s,a)=>{a.r(s),a.d(s,{assets:()=>u,contentTitle:()=>l,default:()=>m,frontMatter:()=>o,metadata:()=>n,toc:()=>d});const n=JSON.parse('{"id":"recipes/centralized-operations-management/just-in-time-node-access/event-driven-requests","title":"EventBridge integration with JITNA","description":"When using just-in-time node access (JITNA), there are three types of events emitted to EventBridge when session access request are created that require manual approval:","source":"@site/docs/recipes/centralized-operations-management/just-in-time-node-access/event-driven-requests.mdx","sourceDirName":"recipes/centralized-operations-management/just-in-time-node-access","slug":"/recipes/centralized-operations-management/just-in-time-node-access/event-driven-requests","permalink":"/cloud-operations-best-practices/docs/recipes/centralized-operations-management/just-in-time-node-access/event-driven-requests","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":3,"frontMatter":{"sidebar_position":3},"sidebar":"tutorialSidebar","previous":{"title":"Enable JITNA using Infrastructure-as-Code (IaC)","permalink":"/cloud-operations-best-practices/docs/recipes/centralized-operations-management/just-in-time-node-access/enable-using-iac"},"next":{"title":"JITNA Cedar policy examples","permalink":"/cloud-operations-best-practices/docs/recipes/centralized-operations-management/just-in-time-node-access/policy-examples"}}');var t=a(4848),r=a(8453),c=a(1470),i=a(9365);const o={sidebar_position:3},l="EventBridge integration with JITNA",u={},d=[{value:"Example event details",id:"example-event-details",level:2},{value:"Requester access request event",id:"requester-access-request-event",level:3},{value:"Approver access request event",id:"approver-access-request-event",level:3},{value:"JITNA Access Request Failed",id:"jitna-access-request-failed",level:3},{value:"Example OpsItem details",id:"example-opsitem-details",level:3},{value:"EventBridge rule patterns",id:"eventbridge-rule-patterns",level:2}];function p(e){const s={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",...(0,r.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(s.header,{children:(0,t.jsx)(s.h1,{id:"eventbridge-integration-with-jitna",children:"EventBridge integration with JITNA"})}),"\n",(0,t.jsxs)(s.p,{children:["When using just-in-time node access (JITNA), there are three types of events emitted to ",(0,t.jsx)(s.a,{href:"https://aws.amazon.com/eventbridge/",children:"EventBridge"})," when session access request are created that require manual approval:"]}),"\n",(0,t.jsxs)(s.ol,{children:["\n",(0,t.jsx)(s.li,{children:"Requester Access Request Status Update"}),"\n",(0,t.jsx)(s.li,{children:"Approver Access Request Status Update"}),"\n",(0,t.jsx)(s.li,{children:"JITNA Access Request Failed"}),"\n"]}),"\n",(0,t.jsx)(s.admonition,{type:"info",children:(0,t.jsx)(s.p,{children:"Events are not emitted for access requests that are automatically approved based on your auto-approval policy."})}),"\n",(0,t.jsx)(s.h2,{id:"example-event-details",children:"Example event details"}),"\n",(0,t.jsx)(s.h3,{id:"requester-access-request-event",children:"Requester access request event"}),"\n",(0,t.jsxs)(s.p,{children:["Below is an example of the event details for the ",(0,t.jsx)(s.code,{children:"Requester Access Request Status Update"})," event."]}),"\n","\n",(0,t.jsxs)(c.A,{groupId:"status",defaultValue:"pending",values:[{label:"Pending Approval",value:"pending"},{label:"Approved",value:"approved"}],children:[(0,t.jsx)(i.A,{value:"pending",children:(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-json",children:'{\n    "version": "0",\n    "id": "6cfc3d6d-fd93-29e2-e96c-909a080ce519",\n    "detail-type": "Requester Access Request Status Update",\n    "source": "aws.ssm",\n    "account": "123456789012",\n    "time": "2025-04-10T20:19:32Z",\n    "region": "us-east-2",\n    "resources": ["arn:aws:ssm:us-east-2:123456789012:automation-execution/0aa5a695-4685-449f-90cc-49d24139dbe9"],\n    "detail": {\n        "ExecutionId": "0aa5a695-4685-449f-90cc-49d24139dbe9",\n        "OpsItemId": "oi-f57e817742bd",\n        "StartTime": "Apr 10, 2025, 8:19:30 PM",\n        "TargetResourceArn": "arn:aws:ec2:us-east-2:123456789012:instance/i-0b3952fba006f5f0d",\n        "Title": "Access Request - 2025-04-10 20:19 UTC",\n        "Requester": "e1fbc510-8081-70c2-448f-123456789012",\n        "AccessRequestStatus": "PendingApproval"\n    }\n}\n'})})}),(0,t.jsx)(i.A,{value:"approved",children:(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-json",children:'{\n    "version": "0",\n    "id": "3d3b64bc-3903-ec60-7101-78e9befbbdac",\n    "detail-type": "Requester Access Request Status Update",\n    "source": "aws.ssm",\n    "account": "123456789012",\n    "time": "2025-04-10T20:40:02Z",\n    "region": "us-east-2",\n    "resources": ["arn:aws:ssm:us-east-2:123456789012:automation-execution/0aa5a695-4685-449f-90cc-49d24139dbe9"],\n    "detail": {\n        "ExecutionId": "0aa5a695-4685-449f-90cc-49d24139dbe9",\n        "OpsItemId": "oi-f57e817742bd",\n        "StartTime": "Apr 10, 2025, 8:40:00 PM",\n        "TargetResourceArn": "arn:aws:ec2:us-east-2:123456789012:instance/i-0b3952fba006f5f0d",\n        "Title": "Access Request - 2025-04-10 20:19 UTC",\n        "Requester": "e1fbc510-8081-70c2-448f-123456789012",\n        "AccessRequestStatus": "Approved"\n    }\n}\n'})})})]}),"\n",(0,t.jsx)(s.h3,{id:"approver-access-request-event",children:"Approver access request event"}),"\n",(0,t.jsxs)(s.p,{children:["Below is an example of the event details for the ",(0,t.jsx)(s.code,{children:"Approver Access Request Status Update"})," event."]}),"\n",(0,t.jsxs)(c.A,{groupId:"status",defaultValue:"pending",values:[{label:"Pending Approval",value:"pending"},{label:"Approved",value:"approved"}],children:[(0,t.jsx)(i.A,{value:"pending",children:(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-json",children:'{\n    "version": "0",\n    "id": "5d6ee943-9c8f-62aa-ee19-84391b0dc60a",\n    "detail-type": "Approver Access Request Status Update",\n    "source": "aws.ssm",\n    "account": "123456789012",\n    "time": "2025-04-10T20:19:30Z",\n    "region": "us-east-2",\n    "resources": ["arn:aws:ssm:us-east-2:123456789012:automation-execution/0aa5a695-4685-449f-90cc-49d24139dbe9"],\n    "detail": {\n        "ExecutionId": "0aa5a695-4685-449f-90cc-49d24139dbe9",\n        "OpsItemId": "oi-f57e817742bd",\n        "StartTime": "Apr 10, 2025, 8:19:29 PM",\n        "Requester": "e1fbc510-8081-70c2-448f-123456789012",\n        "Title": "Access Request - 2025-04-10 20:19 UTC",\n        "TargetResourceArn": "arn:aws:ec2:us-east-2:123456789012:instance/i-0b3952fba006f5f0d",\n        "AccessRequestApprovalLevelStatus": "PendingApproval",\n        "StepName": "ManualApproval",\n        "RequestReason": "Requesting access to node - production",\n        "Approvers": ["816b5550-f031-70c9-4d41-123456789012", "d1db5560-10e1-7090-5614-123456789012"]\n    }\n}\n'})})}),(0,t.jsx)(i.A,{value:"approved",children:(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-json",children:'{\n    "version": "0",\n    "id": "92833908-12b7-142f-d434-84995819239d",\n    "detail-type": "Approver Access Request Status Update",\n    "source": "aws.ssm",\n    "account": "123456789012",\n    "time": "2025-04-10T20:40:00Z",\n    "region": "us-east-2",\n    "resources": ["arn:aws:ssm:us-east-2:123456789012:automation-execution/0aa5a695-4685-449f-90cc-49d24139dbe9"],\n    "detail": {\n        "ExecutionId": "0aa5a695-4685-449f-90cc-49d24139dbe9",\n        "OpsItemId": "oi-f57e817742bd",\n        "StartTime": "Apr 10, 2025, 8:39:58 PM",\n        "Requester": "e1fbc510-8081-70c2-448f-123456789012",\n        "Title": "Access Request - 2025-04-10 20:19 UTC",\n        "TargetResourceArn": "arn:aws:ec2:us-east-2:123456789012:instance/i-0b3952fba006f5f0d",\n        "AccessRequestApprovalLevelStatus": "Approved",\n        "StepName": "ManualApproval",\n        "RequestReason": "Requesting access to node - production",\n        "Approvers": ["816b5550-f031-70c9-4d41-123456789012", "d1db5560-10e1-7090-5614-123456789012"]\n    }\n}\n'})})})]}),"\n",(0,t.jsx)(s.h3,{id:"jitna-access-request-failed",children:"JITNA Access Request Failed"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-json",children:'{\n    "version": "0",\n    "id": "aa09fe20-2b39-c973-42a0-edfa7eb85200",\n    "detail-type": "JITNA Access Request Failed",\n    "source": "aws.ssm",\n    "account": "123456789012",\n    "time": "2025-04-11T14:14:02Z",\n    "region": "us-east-2",\n    "resources": ["arn:aws:ssm:us-east-2:123456789012:opsitem/oi-fdac6036584a"],\n    "detail": {\n        "ApplicablePolicies": ["Approval-Policy-Production-Nodes", "prod"],\n        "TargetResourceArn": "arn:aws:ec2:us-east-2:123456789012:instance/i-05d8934df93bb43db",\n        "OpsItemId": "oi-fdac6036584a",\n        "CreatedDate": "Fri Apr 11 14:13:58 UTC 2025",\n        "Requester": "e1fbc510-8081-70c2-448f-123456789012"\n    }\n}\n'})}),"\n",(0,t.jsx)(s.h3,{id:"example-opsitem-details",children:"Example OpsItem details"}),"\n",(0,t.jsxs)(s.p,{children:["Just-in-time node access requests are stored as a ",(0,t.jsx)(s.a,{href:"https://docs.aws.amazon.com/systems-manager/latest/APIReference/API_OpsItem.html",children:"Systems Manager OpsItem resource"}),". Below is an example of the details for an OpsItem that is for a session access request that was automatically approved by an auto-approval policy."]}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-json",children:'{\n    "OpsItem": {\n        "CreatedBy": "arn:aws:sts::123456789012:assumed-role/AWSReservedSSO_jitna-operator_434098e0f9f1965d/bob@example.com",\n        "OpsItemType": "/aws/accessrequest",\n        "CreatedTime": "2025-05-02T14:57:14.118000+00:00",\n        "Description": "OpsItem created for AccessRequest J8eDlHbgoAMEebw=.",\n        "LastModifiedBy": "arn:aws:sts::123456789012:assumed-role/AWSServiceRoleForSystemsManagerJustInTimeAccess/JustInTimeAccessService",\n        "LastModifiedTime": "2025-05-02T14:57:16.160000+00:00",\n        "Notifications": [],\n        "RelatedOpsItems": [],\n        "Status": "Approved",\n        "OpsItemId": "oi-a71f4d891d72",\n        "Version": "1746197836160",\n        "Title": "Access Request - 2025-05-02 14:57 UTC",\n        "Source": "aws.ssm",\n        "OperationalData": {\n            "/aws/accessrequest/approvaldetails": {\n                "Value": "Requesting access to node",\n                "Type": "SearchableString"\n            },\n            "/aws/accessrequest/context": {\n                "Value": "{\\"targets\\":{\\"instanceId\\":\\"arn:aws:ec2:us-east-2:123456789012:instance/i-02999bd501754105a\\"},\\"accessTokenRole\\":\\"SSM-JustInTimeAccessTokenRole\\"}",\n                "Type": "SearchableString"\n            },\n            "/aws/accessrequest/accessduration": {\n                "Value": "PT3600S",\n                "Type": "SearchableString"\n            },\n            "/aws/accessrequest/endtime": {\n                "Value": "2025-05-02 15:57:16 UTC",\n                "Type": "SearchableString"\n            },\n            "/aws/accessrequest": {\n                "Value": "{\\"requester\\":{\\"isReplica\\":\\"false\\",\\"sourceOpsItemId\\":\\"oi-a71f4d891d72\\",\\"sourceAccountId\\":\\"\\",\\"id\\":\\"\\",\\"sourceRegion\\":\\"\\",\\"arn\\":\\"arn:aws:sts::123456789012:assumed-role/AWSReservedSSO_jitna-operator_434098e0f9f1965d/bob@example.com\\"},\\"approvalPolicy\\":\\"SSM-JustInTimeAccessAutoApprovalPolicy\\",\\"approvalPolicyVersion\\":\\"1\\",\\"automationExecutionId\\":\\"\\"}",\n                "Type": "SearchableString"\n            },\n            "/aws/accessrequest/starttime": {\n                "Value": "2025-05-02 14:57:16 UTC",\n                "Type": "SearchableString"\n            }\n        },\n        "OpsItemArn": "arn:aws:ssm:us-east-2:123456789012:opsitem/oi-a71f4d891d72"\n    }\n}\n'})}),"\n",(0,t.jsx)(s.h2,{id:"eventbridge-rule-patterns",children:"EventBridge rule patterns"}),"\n",(0,t.jsxs)(c.A,{defaultValue:"requester",values:[{label:"Requester event",value:"requester"},{label:"Approver event",value:"approver"},{label:"Failed event",value:"failed"}],children:[(0,t.jsx)(i.A,{value:"requester",children:(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-json",children:'{\n  "source": ["aws.ssm"],\n  "detail-type": ["Requester Access Request Status Update"]\n}\n'})})}),(0,t.jsx)(i.A,{value:"approver",children:(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-json",children:'{\n  "source": ["aws.ssm"],\n  "detail-type": ["Approver Access Request Status Update"],\n  "detail": {\n    "Approvers": ["AccessApprover1"]\n  }\n}\n'})})}),(0,t.jsx)(i.A,{value:"failed",children:(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-json",children:'{\n  "source": ["aws.ssm"],\n  "detail-type": ["JITNA Access Request Failed"]\n}\n'})})})]})]})}function m(e={}){const{wrapper:s}={...(0,r.R)(),...e.components};return s?(0,t.jsx)(s,{...e,children:(0,t.jsx)(p,{...e})}):p(e)}},8453:(e,s,a)=>{a.d(s,{R:()=>c,x:()=>i});var n=a(6540);const t={},r=n.createContext(t);function c(e){const s=n.useContext(r);return n.useMemo((function(){return"function"==typeof e?e(s):{...s,...e}}),[s,e])}function i(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:c(e.components),n.createElement(r.Provider,{value:s},e.children)}},9365:(e,s,a)=>{a.d(s,{A:()=>c});a(6540);var n=a(4164);const t={tabItem:"tabItem_Ymn6"};var r=a(4848);function c({children:e,hidden:s,className:a}){return(0,r.jsx)("div",{role:"tabpanel",className:(0,n.A)(t.tabItem,a),hidden:s,children:e})}}}]);