"use strict";(globalThis.webpackChunkaws_cloud_operations_best_practices=globalThis.webpackChunkaws_cloud_operations_best_practices||[]).push([[1722],{5186:(t,e,n)=>{n.d(e,{A:()=>a});const a=n.p+"assets/images/data-events-estimate-cost-a58dda22fbf4dbd1b5140ff51779e956.png"},6946:(t,e,n)=>{n.r(e),n.d(e,{assets:()=>l,contentTitle:()=>r,default:()=>u,frontMatter:()=>s,metadata:()=>a,toc:()=>c});const a=JSON.parse('{"id":"recipes/AWS CloudTrail/data-events-estimate-cost/index","title":"Estimating CloudTrail Data Event Costs","description":"Introduction","source":"@site/docs/recipes/AWS CloudTrail/data-events-estimate-cost/index.md","sourceDirName":"recipes/AWS CloudTrail/data-events-estimate-cost","slug":"/recipes/AWS CloudTrail/data-events-estimate-cost/","permalink":"/cloud-operations-best-practices/docs/recipes/AWS CloudTrail/data-events-estimate-cost/","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"AWS CloudTrail Security Resources","permalink":"/cloud-operations-best-practices/docs/recipes/AWS CloudTrail/CloudTrail Security/additional-resources"},"next":{"title":"CloudTrail Enrichment with CloudWatch Logs Transformation","permalink":"/cloud-operations-best-practices/docs/recipes/AWS CloudTrail/logs-transformation-best-practices/"}}');var i=n(4848),o=n(8453);const s={},r="Estimating CloudTrail Data Event Costs",l={},c=[{value:"Introduction",id:"introduction",level:2},{value:"Overview of Cost Estimation for data events for S3 Using CUR",id:"overview-of-cost-estimation-for-data-events-for-s3-using-cur",level:2},{value:"Important Limitations",id:"important-limitations",level:2}];function d(t){const e={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",header:"header",img:"img",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,o.R)(),...t.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(e.header,{children:(0,i.jsx)(e.h1,{id:"estimating-cloudtrail-data-event-costs",children:"Estimating CloudTrail Data Event Costs"})}),"\n",(0,i.jsx)(e.h2,{id:"introduction",children:"Introduction"}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.a,{href:"https://docs.aws.amazon.com/awscloudtrail/latest/userguide/logging-data-events-with-cloudtrail.html",children:"CloudTrail Data Events"})," provide detailed logging of data plane operations on AWS resources like S3 objects, DynamoDB tables, Lambda functions and many more. While these events offer valuable security and compliance insights, they can generate significant costs due to the high volume of operations in production environments. Understanding the potential cost impact before enabling Data Events is crucial for budget planning and cost optimization."]}),"\n",(0,i.jsx)(e.p,{children:"In this guide will demonstrate how to use a Cost and Usage Report (CUR) query to estimate the costs for CloudTrail data events for S3.  In the future will update the guide to include other example for estimating cost for additional data event resource types."}),"\n",(0,i.jsx)(e.admonition,{type:"note",children:(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"Note"}),": This guide provides a cost approximation method using CUR data, which may underestimate actual CloudTrail costs since CUR only tracks billable operations while CloudTrail logs all operations."]})}),"\n",(0,i.jsx)(e.h2,{id:"overview-of-cost-estimation-for-data-events-for-s3-using-cur",children:"Overview of Cost Estimation for data events for S3 Using CUR"}),"\n",(0,i.jsxs)(e.p,{children:["The ",(0,i.jsx)(e.a,{href:"https://docs.aws.amazon.com/cur/latest/userguide/creating-cur.html",children:"AWS Cost and Usage Report (CUR)"})," contains detailed information about your AWS service usage, including individual API operations. By analyzing S3 API operations in your CUR data, you can approximate the potential cost of enabling CloudTrail Data Events. This approach provides a baseline estimate because:"]}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"Partial correlation"}),": Each S3 API operation recorded in CUR would generate one CloudTrail Data Event if logging were enabled, but CUR only tracks billable operations"]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"Historical analysis"}),": CUR data provides historical usage patterns for billable operations to project future costs"]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"Granular visibility"}),": You can analyze costs by account, bucket, operation type, and time period for tracked operations"]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"Cost calculation"}),": CloudTrail Data Events are priced at $0.10 per 100,000 events"]}),"\n"]}),"\n",(0,i.jsx)(e.admonition,{type:"note",children:(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"Important"}),": This method provides a conservative estimate as CUR doesn't track free tier operations, failed operations, or operations below billing thresholds that CloudTrail would still log."]})}),"\n",(0,i.jsxs)(e.p,{children:["The following query analyzes your Amazon S3 API operations associated to ",(0,i.jsx)(e.a,{href:"https://docs.aws.amazon.com/AmazonS3/latest/userguide/cloudtrail-logging-s3-info.html#cloudtrail-data-events",children:"CloudTrail data events for S3"})," from CUR data to estimate CloudTrail Data Events costs."]}),"\n",(0,i.jsx)(e.h2,{id:"important-limitations",children:"Important Limitations"}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"CUR Tracking Limitations"}),": CUR ",(0,i.jsx)(e.code,{children:"line_item_operation"})," only tracks operations that result in billable usage or costs. This means:"]}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"Operations not tracked"}),": Free tier operations, failed operations, access denied events, and operations below billing thresholds are not included in CUR"]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"CloudTrail logs everything"}),": CloudTrail Data Events capture ALL operations regardless of success, failure, or billing status"]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"Cost estimate accuracy"}),": CUR-based estimates may be ",(0,i.jsx)(e.strong,{children:"lower"})," than actual CloudTrail costs since CloudTrail logs more operations than CUR tracks"]}),"\n"]}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"Recommendation"}),": Use this estimate as a baseline understanding that actual CloudTrail Data Events costs could be higher, especially in environments with high volumes of failed operations or free tier usage."]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-sql",children:"WITH base_data AS (\n\tSELECT DATE(line_item_usage_start_date) as usage_date,\n\t\tbill_payer_account_id as payer_account_id,\n\t\tline_item_usage_account_id as usage_account_id,\n\t\tline_item_operation,\n\t\tline_item_resource_id as bucket_name,\n\t\tCOUNT(*) as operation_count,\n\t\tCONCAT('$', FORMAT('%.6f', (COUNT(*) / 100000.0) * 0.10)) as data_events_estimated_cost\n\tFROM <CUR TABLE>\n\tWHERE line_item_product_code = 'AmazonS3'\n\t\tAND line_item_operation IN (\n\t\t\t'AbortMultipartUpload',\n\t\t\t'CompleteMultipartUpload',\n\t\t\t'CopyObject',\n\t\t\t'CreateMultipartUpload',\n\t\t\t'DeleteObject',\n\t\t\t'DeleteObjectTagging',\n\t\t\t'DeleteObjects',\n\t\t\t'GetObject',\n\t\t\t'GetObjectAcl',\n\t\t\t'GetObjectAttributes',\n\t\t\t'GetObjectLegalHold',\n\t\t\t'GetObjectRetention',\n\t\t\t'GetObjectTagging',\n\t\t\t'GetObjectTorrent',\n\t\t\t'HeadObject',\n\t\t\t'HeadBucket',\n\t\t\t'ListObjectVersions',\n\t\t\t'ListObjects',\n\t\t\t'ListParts',\n\t\t\t'PutObject',\n\t\t\t'PutObjectAcl',\n\t\t\t'PutObjectLegalHold',\n\t\t\t'PutObjectRetention',\n\t\t\t'PutObjectTagging',\n\t\t\t'RestoreObject',\n\t\t\t'SelectObjectContent',\n\t\t\t'UploadPart',\n\t\t\t'UploadPartCopy'\n\t\t)\n\t\tAND line_item_usage_start_date >= DATE('2025-09-01')\n\t\tAND line_item_usage_start_date < DATE('2025-09-30')\n\tGROUP BY DATE(line_item_usage_start_date),\n\t\tbill_payer_account_id,\n\t\tline_item_usage_account_id,\n\t\tline_item_operation,\n\t\tline_item_resource_id\n)\nSELECT *\nFROM base_data\nUNION ALL\nSELECT NULL as usage_date,\n\tpayer_account_id,\n\tusage_account_id,\n\t'TOTAL' as line_item_operation,\n\t'ALL BUCKETS' as bucket_name,\n\tSUM(operation_count) as operation_count,\n\tCONCAT('$', FORMAT('%.6f', (SUM(operation_count) / 100000.0) * 0.10)) as data_events_estimated_cost\nFROM base_data\nGROUP BY payer_account_id,\n\tusage_account_id\nORDER BY CASE WHEN bucket_name = 'ALL BUCKETS' THEN 0 ELSE 1 END,\n\toperation_count DESC;\n"})}),"\n",(0,i.jsx)(e.p,{children:"The below image shows the output of the CUR query. It will first give the overall count of billable S3 API operations for all buckets and the approximate cost for Data Events. Then, it will give the billable S3 API operation count for each bucket and the approximate cost. This baseline information will help when defining specific advanced event selector filters in excluding/including specific S3 resources for data events, keeping in mind that actual CloudTrail costs may be higher due to operations not tracked in CUR."}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.img,{alt:"CloudTrail Estimation of Data Event Cost for S3",src:n(5186).A+"",width:"1482",height:"469"})})]})}function u(t={}){const{wrapper:e}={...(0,o.R)(),...t.components};return e?(0,i.jsx)(e,{...t,children:(0,i.jsx)(d,{...t})}):d(t)}},8453:(t,e,n)=>{n.d(e,{R:()=>s,x:()=>r});var a=n(6540);const i={},o=a.createContext(i);function s(t){const e=a.useContext(o);return a.useMemo(function(){return"function"==typeof t?t(e):{...e,...t}},[e,t])}function r(t){let e;return e=t.disableParentContext?"function"==typeof t.components?t.components(i):t.components||i:s(t.components),a.createElement(o.Provider,{value:e},t.children)}}}]);