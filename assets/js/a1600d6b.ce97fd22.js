"use strict";(self.webpackChunkaws_cloud_operations_best_practices=self.webpackChunkaws_cloud_operations_best_practices||[]).push([[643],{6357:(e,s,n)=>{n.r(s),n.d(s,{assets:()=>N,contentTitle:()=>y,default:()=>C,frontMatter:()=>S,metadata:()=>a,toc:()=>E});const a=JSON.parse('{"id":"recipes/centralized-operations-management/just-in-time-node-access/event-driven-requests","title":"EventBridge integration with JITNA","description":"When using just-in-time node access (JITNA), there are three types of events emitted to EventBridge when session access request are created that require manual approval:","source":"@site/docs/recipes/centralized-operations-management/just-in-time-node-access/event-driven-requests.mdx","sourceDirName":"recipes/centralized-operations-management/just-in-time-node-access","slug":"/recipes/centralized-operations-management/just-in-time-node-access/event-driven-requests","permalink":"/cloud-operations-best-practices/docs/recipes/centralized-operations-management/just-in-time-node-access/event-driven-requests","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":3,"frontMatter":{"sidebar_position":3},"sidebar":"tutorialSidebar","previous":{"title":"Enable JITNA using Infrastructure-as-Code (IaC)","permalink":"/cloud-operations-best-practices/docs/recipes/centralized-operations-management/just-in-time-node-access/enable-using-iac"},"next":{"title":"JITNA Cedar policy examples","permalink":"/cloud-operations-best-practices/docs/recipes/centralized-operations-management/just-in-time-node-access/policy-examples"}}');var t=n(4848),r=n(8453),c=n(6540),i=n(4164),o=n(5627),l=n(6347),u=n(372),d=n(604),p=n(1861),m=n(8749);function v(e){return c.Children.toArray(e).filter((e=>"\n"!==e)).map((e=>{if(!e||(0,c.isValidElement)(e)&&function(e){const{props:s}=e;return!!s&&"object"==typeof s&&"value"in s}(e))return e;throw new Error(`Docusaurus error: Bad <Tabs> child <${"string"==typeof e.type?e.type:e.type.name}>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.`)}))?.filter(Boolean)??[]}function h(e){const{values:s,children:n}=e;return(0,c.useMemo)((()=>{const e=s??function(e){return v(e).map((e=>{let{props:{value:s,label:n,attributes:a,default:t}}=e;return{value:s,label:n,attributes:a,default:t}}))}(n);return function(e){const s=(0,p.XI)(e,((e,s)=>e.value===s.value));if(s.length>0)throw new Error(`Docusaurus error: Duplicate values "${s.map((e=>e.value)).join(", ")}" found in <Tabs>. Every value needs to be unique.`)}(e),e}),[s,n])}function f(e){let{value:s,tabValues:n}=e;return n.some((e=>e.value===s))}function b(e){let{queryString:s=!1,groupId:n}=e;const a=(0,l.W6)(),t=function(e){let{queryString:s=!1,groupId:n}=e;if("string"==typeof s)return s;if(!1===s)return null;if(!0===s&&!n)throw new Error('Docusaurus error: The <Tabs> component groupId prop is required if queryString=true, because this value is used as the search param name. You can also provide an explicit value such as queryString="my-search-param".');return n??null}({queryString:s,groupId:n});return[(0,d.aZ)(t),(0,c.useCallback)((e=>{if(!t)return;const s=new URLSearchParams(a.location.search);s.set(t,e),a.replace({...a.location,search:s.toString()})}),[t,a])]}function g(e){const{defaultValue:s,queryString:n=!1,groupId:a}=e,t=h(e),[r,i]=(0,c.useState)((()=>function(e){let{defaultValue:s,tabValues:n}=e;if(0===n.length)throw new Error("Docusaurus error: the <Tabs> component requires at least one <TabItem> children component");if(s){if(!f({value:s,tabValues:n}))throw new Error(`Docusaurus error: The <Tabs> has a defaultValue "${s}" but none of its children has the corresponding value. Available values are: ${n.map((e=>e.value)).join(", ")}. If you intend to show no default tab, use defaultValue={null} instead.`);return s}const a=n.find((e=>e.default))??n[0];if(!a)throw new Error("Unexpected error: 0 tabValues");return a.value}({defaultValue:s,tabValues:t}))),[o,l]=b({queryString:n,groupId:a}),[d,p]=function(e){let{groupId:s}=e;const n=function(e){return e?`docusaurus.tab.${e}`:null}(s),[a,t]=(0,m.Dv)(n);return[a,(0,c.useCallback)((e=>{n&&t.set(e)}),[n,t])]}({groupId:a}),v=(()=>{const e=o??d;return f({value:e,tabValues:t})?e:null})();(0,u.A)((()=>{v&&i(v)}),[v]);return{selectedValue:r,selectValue:(0,c.useCallback)((e=>{if(!f({value:e,tabValues:t}))throw new Error(`Can't select invalid tab value=${e}`);i(e),l(e),p(e)}),[l,p,t]),tabValues:t}}var A=n(9136);const x={tabList:"tabList__CuJ",tabItem:"tabItem_LNqP"};function q(e){let{className:s,block:n,selectedValue:a,selectValue:r,tabValues:c}=e;const l=[],{blockElementScrollPositionUntilNextRender:u}=(0,o.a_)(),d=e=>{const s=e.currentTarget,n=l.indexOf(s),t=c[n].value;t!==a&&(u(s),r(t))},p=e=>{let s=null;switch(e.key){case"Enter":d(e);break;case"ArrowRight":{const n=l.indexOf(e.currentTarget)+1;s=l[n]??l[0];break}case"ArrowLeft":{const n=l.indexOf(e.currentTarget)-1;s=l[n]??l[l.length-1];break}}s?.focus()};return(0,t.jsx)("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,i.A)("tabs",{"tabs--block":n},s),children:c.map((e=>{let{value:s,label:n,attributes:r}=e;return(0,t.jsx)("li",{role:"tab",tabIndex:a===s?0:-1,"aria-selected":a===s,ref:e=>{l.push(e)},onKeyDown:p,onClick:d,...r,className:(0,i.A)("tabs__item",x.tabItem,r?.className,{"tabs__item--active":a===s}),children:n??s},s)}))})}function j(e){let{lazy:s,children:n,selectedValue:a}=e;const r=(Array.isArray(n)?n:[n]).filter(Boolean);if(s){const e=r.find((e=>e.props.value===a));return e?(0,c.cloneElement)(e,{className:(0,i.A)("margin-top--md",e.props.className)}):null}return(0,t.jsx)("div",{className:"margin-top--md",children:r.map(((e,s)=>(0,c.cloneElement)(e,{key:s,hidden:e.props.value!==a})))})}function I(e){const s=g(e);return(0,t.jsxs)("div",{className:(0,i.A)("tabs-container",x.tabList),children:[(0,t.jsx)(q,{...s,...e}),(0,t.jsx)(j,{...s,...e})]})}function T(e){const s=(0,A.A)();return(0,t.jsx)(I,{...e,children:v(e.children)},String(s))}const w={tabItem:"tabItem_Ymn6"};function R(e){let{children:s,hidden:n,className:a}=e;return(0,t.jsx)("div",{role:"tabpanel",className:(0,i.A)(w.tabItem,a),hidden:n,children:s})}const S={sidebar_position:3},y="EventBridge integration with JITNA",N={},E=[{value:"Example event details",id:"example-event-details",level:2},{value:"Requester access request event",id:"requester-access-request-event",level:3},{value:"Approver access request event",id:"approver-access-request-event",level:3},{value:"JITNA Access Request Failed",id:"jitna-access-request-failed",level:3},{value:"Example OpsItem details",id:"example-opsitem-details",level:3},{value:"EventBridge rule patterns",id:"eventbridge-rule-patterns",level:2}];function V(e){const s={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",...(0,r.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(s.header,{children:(0,t.jsx)(s.h1,{id:"eventbridge-integration-with-jitna",children:"EventBridge integration with JITNA"})}),"\n",(0,t.jsxs)(s.p,{children:["When using just-in-time node access (JITNA), there are three types of events emitted to ",(0,t.jsx)(s.a,{href:"https://aws.amazon.com/eventbridge/",children:"EventBridge"})," when session access request are created that require manual approval:"]}),"\n",(0,t.jsxs)(s.ol,{children:["\n",(0,t.jsx)(s.li,{children:"Requester Access Request Status Update"}),"\n",(0,t.jsx)(s.li,{children:"Approver Access Request Status Update"}),"\n",(0,t.jsx)(s.li,{children:"JITNA Access Request Failed"}),"\n"]}),"\n",(0,t.jsx)(s.admonition,{type:"info",children:(0,t.jsx)(s.p,{children:"Events are not emitted for access requests that are automatically approved based on your auto-approval policy."})}),"\n",(0,t.jsx)(s.h2,{id:"example-event-details",children:"Example event details"}),"\n",(0,t.jsx)(s.h3,{id:"requester-access-request-event",children:"Requester access request event"}),"\n",(0,t.jsxs)(s.p,{children:["Below is an example of the event details for the ",(0,t.jsx)(s.code,{children:"Requester Access Request Status Update"})," event."]}),"\n","\n",(0,t.jsxs)(T,{groupId:"status",defaultValue:"pending",values:[{label:"Pending Approval",value:"pending"},{label:"Approved",value:"approved"}],children:[(0,t.jsx)(R,{value:"pending",children:(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-json",children:'{\n    "version": "0",\n    "id": "6cfc3d6d-fd93-29e2-e96c-909a080ce519",\n    "detail-type": "Requester Access Request Status Update",\n    "source": "aws.ssm",\n    "account": "123456789012",\n    "time": "2025-04-10T20:19:32Z",\n    "region": "us-east-2",\n    "resources": ["arn:aws:ssm:us-east-2:123456789012:automation-execution/0aa5a695-4685-449f-90cc-49d24139dbe9"],\n    "detail": {\n        "ExecutionId": "0aa5a695-4685-449f-90cc-49d24139dbe9",\n        "OpsItemId": "oi-f57e817742bd",\n        "StartTime": "Apr 10, 2025, 8:19:30 PM",\n        "TargetResourceArn": "arn:aws:ec2:us-east-2:123456789012:instance/i-0b3952fba006f5f0d",\n        "Title": "Access Request - 2025-04-10 20:19 UTC",\n        "Requester": "e1fbc510-8081-70c2-448f-123456789012",\n        "AccessRequestStatus": "PendingApproval"\n    }\n}\n'})})}),(0,t.jsx)(R,{value:"approved",children:(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-json",children:'{\n    "version": "0",\n    "id": "3d3b64bc-3903-ec60-7101-78e9befbbdac",\n    "detail-type": "Requester Access Request Status Update",\n    "source": "aws.ssm",\n    "account": "123456789012",\n    "time": "2025-04-10T20:40:02Z",\n    "region": "us-east-2",\n    "resources": ["arn:aws:ssm:us-east-2:123456789012:automation-execution/0aa5a695-4685-449f-90cc-49d24139dbe9"],\n    "detail": {\n        "ExecutionId": "0aa5a695-4685-449f-90cc-49d24139dbe9",\n        "OpsItemId": "oi-f57e817742bd",\n        "StartTime": "Apr 10, 2025, 8:40:00 PM",\n        "TargetResourceArn": "arn:aws:ec2:us-east-2:123456789012:instance/i-0b3952fba006f5f0d",\n        "Title": "Access Request - 2025-04-10 20:19 UTC",\n        "Requester": "e1fbc510-8081-70c2-448f-123456789012",\n        "AccessRequestStatus": "Approved"\n    }\n}\n'})})})]}),"\n",(0,t.jsx)(s.h3,{id:"approver-access-request-event",children:"Approver access request event"}),"\n",(0,t.jsxs)(s.p,{children:["Below is an example of the event details for the ",(0,t.jsx)(s.code,{children:"Approver Access Request Status Update"})," event."]}),"\n",(0,t.jsxs)(T,{groupId:"status",defaultValue:"pending",values:[{label:"Pending Approval",value:"pending"},{label:"Approved",value:"approved"}],children:[(0,t.jsx)(R,{value:"pending",children:(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-json",children:'{\n    "version": "0",\n    "id": "5d6ee943-9c8f-62aa-ee19-84391b0dc60a",\n    "detail-type": "Approver Access Request Status Update",\n    "source": "aws.ssm",\n    "account": "123456789012",\n    "time": "2025-04-10T20:19:30Z",\n    "region": "us-east-2",\n    "resources": ["arn:aws:ssm:us-east-2:123456789012:automation-execution/0aa5a695-4685-449f-90cc-49d24139dbe9"],\n    "detail": {\n        "ExecutionId": "0aa5a695-4685-449f-90cc-49d24139dbe9",\n        "OpsItemId": "oi-f57e817742bd",\n        "StartTime": "Apr 10, 2025, 8:19:29 PM",\n        "Requester": "e1fbc510-8081-70c2-448f-123456789012",\n        "Title": "Access Request - 2025-04-10 20:19 UTC",\n        "TargetResourceArn": "arn:aws:ec2:us-east-2:123456789012:instance/i-0b3952fba006f5f0d",\n        "AccessRequestApprovalLevelStatus": "PendingApproval",\n        "StepName": "ManualApproval",\n        "RequestReason": "Requesting access to node - production",\n        "Approvers": ["816b5550-f031-70c9-4d41-123456789012", "d1db5560-10e1-7090-5614-123456789012"]\n    }\n}\n'})})}),(0,t.jsx)(R,{value:"approved",children:(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-json",children:'{\n    "version": "0",\n    "id": "92833908-12b7-142f-d434-84995819239d",\n    "detail-type": "Approver Access Request Status Update",\n    "source": "aws.ssm",\n    "account": "123456789012",\n    "time": "2025-04-10T20:40:00Z",\n    "region": "us-east-2",\n    "resources": ["arn:aws:ssm:us-east-2:123456789012:automation-execution/0aa5a695-4685-449f-90cc-49d24139dbe9"],\n    "detail": {\n        "ExecutionId": "0aa5a695-4685-449f-90cc-49d24139dbe9",\n        "OpsItemId": "oi-f57e817742bd",\n        "StartTime": "Apr 10, 2025, 8:39:58 PM",\n        "Requester": "e1fbc510-8081-70c2-448f-123456789012",\n        "Title": "Access Request - 2025-04-10 20:19 UTC",\n        "TargetResourceArn": "arn:aws:ec2:us-east-2:123456789012:instance/i-0b3952fba006f5f0d",\n        "AccessRequestApprovalLevelStatus": "Approved",\n        "StepName": "ManualApproval",\n        "RequestReason": "Requesting access to node - production",\n        "Approvers": ["816b5550-f031-70c9-4d41-123456789012", "d1db5560-10e1-7090-5614-123456789012"]\n    }\n}\n'})})})]}),"\n",(0,t.jsx)(s.h3,{id:"jitna-access-request-failed",children:"JITNA Access Request Failed"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-json",children:'{\n    "version": "0",\n    "id": "aa09fe20-2b39-c973-42a0-edfa7eb85200",\n    "detail-type": "JITNA Access Request Failed",\n    "source": "aws.ssm",\n    "account": "123456789012",\n    "time": "2025-04-11T14:14:02Z",\n    "region": "us-east-2",\n    "resources": ["arn:aws:ssm:us-east-2:123456789012:opsitem/oi-fdac6036584a"],\n    "detail": {\n        "ApplicablePolicies": ["Approval-Policy-Production-Nodes", "prod"],\n        "TargetResourceArn": "arn:aws:ec2:us-east-2:123456789012:instance/i-05d8934df93bb43db",\n        "OpsItemId": "oi-fdac6036584a",\n        "CreatedDate": "Fri Apr 11 14:13:58 UTC 2025",\n        "Requester": "e1fbc510-8081-70c2-448f-123456789012"\n    }\n}\n'})}),"\n",(0,t.jsx)(s.h3,{id:"example-opsitem-details",children:"Example OpsItem details"}),"\n",(0,t.jsxs)(s.p,{children:["Just-in-time node access requests are stored as a ",(0,t.jsx)(s.a,{href:"https://docs.aws.amazon.com/systems-manager/latest/APIReference/API_OpsItem.html",children:"Systems Manager OpsItem resource"}),". Below is an example of the details for an OpsItem that is for a session access request that was automatically approved by an auto-approval policy."]}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-json",children:'{\n    "OpsItem": {\n        "CreatedBy": "arn:aws:sts::123456789012:assumed-role/AWSReservedSSO_jitna-operator_434098e0f9f1965d/bob@example.com",\n        "OpsItemType": "/aws/accessrequest",\n        "CreatedTime": "2025-05-02T14:57:14.118000+00:00",\n        "Description": "OpsItem created for AccessRequest J8eDlHbgoAMEebw=.",\n        "LastModifiedBy": "arn:aws:sts::123456789012:assumed-role/AWSServiceRoleForSystemsManagerJustInTimeAccess/JustInTimeAccessService",\n        "LastModifiedTime": "2025-05-02T14:57:16.160000+00:00",\n        "Notifications": [],\n        "RelatedOpsItems": [],\n        "Status": "Approved",\n        "OpsItemId": "oi-a71f4d891d72",\n        "Version": "1746197836160",\n        "Title": "Access Request - 2025-05-02 14:57 UTC",\n        "Source": "aws.ssm",\n        "OperationalData": {\n            "/aws/accessrequest/approvaldetails": {\n                "Value": "Requesting access to node",\n                "Type": "SearchableString"\n            },\n            "/aws/accessrequest/context": {\n                "Value": "{\\"targets\\":{\\"instanceId\\":\\"arn:aws:ec2:us-east-2:123456789012:instance/i-02999bd501754105a\\"},\\"accessTokenRole\\":\\"SSM-JustInTimeAccessTokenRole\\"}",\n                "Type": "SearchableString"\n            },\n            "/aws/accessrequest/accessduration": {\n                "Value": "PT3600S",\n                "Type": "SearchableString"\n            },\n            "/aws/accessrequest/endtime": {\n                "Value": "2025-05-02 15:57:16 UTC",\n                "Type": "SearchableString"\n            },\n            "/aws/accessrequest": {\n                "Value": "{\\"requester\\":{\\"isReplica\\":\\"false\\",\\"sourceOpsItemId\\":\\"oi-a71f4d891d72\\",\\"sourceAccountId\\":\\"\\",\\"id\\":\\"\\",\\"sourceRegion\\":\\"\\",\\"arn\\":\\"arn:aws:sts::123456789012:assumed-role/AWSReservedSSO_jitna-operator_434098e0f9f1965d/bob@example.com\\"},\\"approvalPolicy\\":\\"SSM-JustInTimeAccessAutoApprovalPolicy\\",\\"approvalPolicyVersion\\":\\"1\\",\\"automationExecutionId\\":\\"\\"}",\n                "Type": "SearchableString"\n            },\n            "/aws/accessrequest/starttime": {\n                "Value": "2025-05-02 14:57:16 UTC",\n                "Type": "SearchableString"\n            }\n        },\n        "OpsItemArn": "arn:aws:ssm:us-east-2:123456789012:opsitem/oi-a71f4d891d72"\n    }\n}\n'})}),"\n",(0,t.jsx)(s.h2,{id:"eventbridge-rule-patterns",children:"EventBridge rule patterns"}),"\n",(0,t.jsxs)(T,{defaultValue:"requester",values:[{label:"Requester event",value:"requester"},{label:"Approver event",value:"approver"},{label:"Failed event",value:"failed"}],children:[(0,t.jsx)(R,{value:"requester",children:(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-json",children:'{\n  "source": ["aws.ssm"],\n  "detail-type": ["Requester Access Request Status Update"]\n}\n'})})}),(0,t.jsx)(R,{value:"approver",children:(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-json",children:'{\n  "source": ["aws.ssm"],\n  "detail-type": ["Approver Access Request Status Update"],\n  "detail": {\n    "Approvers": ["AccessApprover1"]\n  }\n}\n'})})}),(0,t.jsx)(R,{value:"failed",children:(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-json",children:'{\n  "source": ["aws.ssm"],\n  "detail-type": ["JITNA Access Request Failed"]\n}\n'})})})]})]})}function C(e={}){const{wrapper:s}={...(0,r.R)(),...e.components};return s?(0,t.jsx)(s,{...e,children:(0,t.jsx)(V,{...e})}):V(e)}},8453:(e,s,n)=>{n.d(s,{R:()=>c,x:()=>i});var a=n(6540);const t={},r=a.createContext(t);function c(e){const s=a.useContext(r);return a.useMemo((function(){return"function"==typeof e?e(s):{...s,...e}}),[s,e])}function i(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:c(e.components),a.createElement(r.Provider,{value:s},e.children)}}}]);