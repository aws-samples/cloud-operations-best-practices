"use strict";(globalThis.webpackChunkaws_cloud_operations_best_practices=globalThis.webpackChunkaws_cloud_operations_best_practices||[]).push([[114],{1470:(e,n,t)=>{t.d(n,{A:()=>S});var a=t(6540),s=t(4164),i=t(7559),o=t(3104),r=t(6347),c=t(205),l=t(7485),d=t(1682),u=t(679);function p(e){return a.Children.toArray(e).filter(e=>"\n"!==e).map(e=>{if(!e||(0,a.isValidElement)(e)&&function(e){const{props:n}=e;return!!n&&"object"==typeof n&&"value"in n}(e))return e;throw new Error(`Docusaurus error: Bad <Tabs> child <${"string"==typeof e.type?e.type:e.type.name}>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.`)})?.filter(Boolean)??[]}function h(e){const{values:n,children:t}=e;return(0,a.useMemo)(()=>{const e=n??function(e){return p(e).map(({props:{value:e,label:n,attributes:t,default:a}})=>({value:e,label:n,attributes:t,default:a}))}(t);return function(e){const n=(0,d.XI)(e,(e,n)=>e.value===n.value);if(n.length>0)throw new Error(`Docusaurus error: Duplicate values "${n.map(e=>e.value).join(", ")}" found in <Tabs>. Every value needs to be unique.`)}(e),e},[n,t])}function m({value:e,tabValues:n}){return n.some(n=>n.value===e)}function g({queryString:e=!1,groupId:n}){const t=(0,r.W6)(),s=function({queryString:e=!1,groupId:n}){if("string"==typeof e)return e;if(!1===e)return null;if(!0===e&&!n)throw new Error('Docusaurus error: The <Tabs> component groupId prop is required if queryString=true, because this value is used as the search param name. You can also provide an explicit value such as queryString="my-search-param".');return n??null}({queryString:e,groupId:n});return[(0,l.aZ)(s),(0,a.useCallback)(e=>{if(!s)return;const n=new URLSearchParams(t.location.search);n.set(s,e),t.replace({...t.location,search:n.toString()})},[s,t])]}function f(e){const{defaultValue:n,queryString:t=!1,groupId:s}=e,i=h(e),[o,r]=(0,a.useState)(()=>function({defaultValue:e,tabValues:n}){if(0===n.length)throw new Error("Docusaurus error: the <Tabs> component requires at least one <TabItem> children component");if(e){if(!m({value:e,tabValues:n}))throw new Error(`Docusaurus error: The <Tabs> has a defaultValue "${e}" but none of its children has the corresponding value. Available values are: ${n.map(e=>e.value).join(", ")}. If you intend to show no default tab, use defaultValue={null} instead.`);return e}const t=n.find(e=>e.default)??n[0];if(!t)throw new Error("Unexpected error: 0 tabValues");return t.value}({defaultValue:n,tabValues:i})),[l,d]=g({queryString:t,groupId:s}),[p,f]=function({groupId:e}){const n=function(e){return e?`docusaurus.tab.${e}`:null}(e),[t,s]=(0,u.Dv)(n);return[t,(0,a.useCallback)(e=>{n&&s.set(e)},[n,s])]}({groupId:s}),j=(()=>{const e=l??p;return m({value:e,tabValues:i})?e:null})();(0,c.A)(()=>{j&&r(j)},[j]);return{selectedValue:o,selectValue:(0,a.useCallback)(e=>{if(!m({value:e,tabValues:i}))throw new Error(`Can't select invalid tab value=${e}`);r(e),d(e),f(e)},[d,f,i]),tabValues:i}}var j=t(2303);const x={tabList:"tabList__CuJ",tabItem:"tabItem_LNqP"};var b=t(4848);function y({className:e,block:n,selectedValue:t,selectValue:a,tabValues:i}){const r=[],{blockElementScrollPositionUntilNextRender:c}=(0,o.a_)(),l=e=>{const n=e.currentTarget,s=r.indexOf(n),o=i[s].value;o!==t&&(c(n),a(o))},d=e=>{let n=null;switch(e.key){case"Enter":l(e);break;case"ArrowRight":{const t=r.indexOf(e.currentTarget)+1;n=r[t]??r[0];break}case"ArrowLeft":{const t=r.indexOf(e.currentTarget)-1;n=r[t]??r[r.length-1];break}}n?.focus()};return(0,b.jsx)("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,s.A)("tabs",{"tabs--block":n},e),children:i.map(({value:e,label:n,attributes:a})=>(0,b.jsx)("li",{role:"tab",tabIndex:t===e?0:-1,"aria-selected":t===e,ref:e=>{r.push(e)},onKeyDown:d,onClick:l,...a,className:(0,s.A)("tabs__item",x.tabItem,a?.className,{"tabs__item--active":t===e}),children:n??e},e))})}function v({lazy:e,children:n,selectedValue:t}){const i=(Array.isArray(n)?n:[n]).filter(Boolean);if(e){const e=i.find(e=>e.props.value===t);return e?(0,a.cloneElement)(e,{className:(0,s.A)("margin-top--md",e.props.className)}):null}return(0,b.jsx)("div",{className:"margin-top--md",children:i.map((e,n)=>(0,a.cloneElement)(e,{key:n,hidden:e.props.value!==t}))})}function w(e){const n=f(e);return(0,b.jsxs)("div",{className:(0,s.A)(i.G.tabs.container,"tabs-container",x.tabList),children:[(0,b.jsx)(y,{...n,...e}),(0,b.jsx)(v,{...n,...e})]})}function S(e){const n=(0,j.A)();return(0,b.jsx)(w,{...e,children:p(e.children)},String(n))}},2630:(e,n,t)=>{t.d(n,{A:()=>a});const a=t.p+"assets/images/jitna-resources-f4f37bb3c830db73f2ed2a5bc3aaf9bc.png"},5720:(e,n,t)=>{t.d(n,{A:()=>a});const a=t.p+"assets/images/jitna-organization-64cb59e83f286b5e8474226af4a6cb25.png"},7794:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>d,contentTitle:()=>l,default:()=>h,frontMatter:()=>c,metadata:()=>a,toc:()=>u});const a=JSON.parse('{"id":"recipes/centralized-operations-management/just-in-time-node-access/enable-using-iac","title":"Enable JITNA using Infrastructure-as-Code (IaC)","description":"The following section describes how to deploy just-in-time node access using CloudFormation in an AWS Organization. To deploy just-in-time node access, you must first enable just-in-time node access for your environment and then you can deploy just-in-time node access resources which include approval policies, session preferences, and notification configurations.","source":"@site/docs/recipes/centralized-operations-management/just-in-time-node-access/enable-using-iac.mdx","sourceDirName":"recipes/centralized-operations-management/just-in-time-node-access","slug":"/recipes/centralized-operations-management/just-in-time-node-access/enable-using-iac","permalink":"/cloud-operations-best-practices/docs/recipes/centralized-operations-management/just-in-time-node-access/enable-using-iac","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":2,"frontMatter":{"sidebar_position":2},"sidebar":"tutorialSidebar","previous":{"title":"Just-in-time node access (JITNA)","permalink":"/cloud-operations-best-practices/docs/recipes/centralized-operations-management/just-in-time-node-access/"},"next":{"title":"EventBridge integration with JITNA","permalink":"/cloud-operations-best-practices/docs/recipes/centralized-operations-management/just-in-time-node-access/event-driven-requests"}}');var s=t(4848),i=t(8453),o=t(1470),r=t(9365);const c={sidebar_position:2},l="Enable JITNA using Infrastructure-as-Code (IaC)",d={},u=[{value:"Enable just-in-time node access",id:"enable-just-in-time-node-access",level:2},{value:"Deploy Quick Setup configuration managers",id:"deploy-quick-setup-configuration-managers",level:3},{value:"Sample CloudFormation template",id:"sample-cloudformation-template",level:4},{value:"CloudFormation template parameters",id:"cloudformation-template-parameters",level:5},{value:"Configure just-in-time node access",id:"configure-just-in-time-node-access",level:2},{value:"Deploy approval policies for your nodes",id:"deploy-approval-policies-for-your-nodes",level:3},{value:"Sample CloudFormation template - JITNA Configuration",id:"sample-cloudformation-template---jitna-configuration",level:4}];function p(e){const n={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",h5:"h5",header:"header",img:"img",li:"li",ol:"ol",p:"p",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,i.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.header,{children:(0,s.jsx)(n.h1,{id:"enable-jitna-using-infrastructure-as-code-iac",children:"Enable JITNA using Infrastructure-as-Code (IaC)"})}),"\n",(0,s.jsx)(n.p,{children:"The following section describes how to deploy just-in-time node access using CloudFormation in an AWS Organization. To deploy just-in-time node access, you must first enable just-in-time node access for your environment and then you can deploy just-in-time node access resources which include approval policies, session preferences, and notification configurations."}),"\n",(0,s.jsx)(n.admonition,{type:"info",children:(0,s.jsx)(n.p,{children:"The Systems Manager unified console and just-in-time node access can also be enabled on a per account/Region basis by performing local deployments rather than by enabling the features within the delegated administrator account."})}),"\n",(0,s.jsx)(n.h2,{id:"enable-just-in-time-node-access",children:"Enable just-in-time node access"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsx)(n.li,{children:"In the AWS management account for your organization, specify a delegated administrator account for Systems Manager."}),"\n",(0,s.jsxs)(n.li,{children:["Deploy the ",(0,s.jsx)(n.a,{href:"https://docs.aws.amazon.com/systems-manager/latest/userguide/systems-manager-setting-up-organizations.html",children:"Systems Manager unified console"}),"."]}),"\n",(0,s.jsxs)(n.li,{children:["Deploy ",(0,s.jsx)(n.a,{href:"https://docs.aws.amazon.com/systems-manager/latest/userguide/systems-manager-just-in-time-node-access.html",children:"Just-in-time node access"}),"."]}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"Below is an example architecture diagram for deploying Quick Setup configuration managers for the unified console and just-in-time node access."}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{alt:"Example architecture diagram for deploying Quick Setup configuration managers for the unified console and just-in-time node access",src:t(5720).A+"",title:"Just-in-time node access architecture diagram",width:"1803",height:"1853"})}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsx)(n.li,{children:"Create a CloudFormation stack within the delegated administrator account for Systems Manager."}),"\n",(0,s.jsx)(n.li,{children:"The CloudFormation stack creates Quick Setup configuration managers."}),"\n",(0,s.jsx)(n.li,{children:"The Quick Setup configuration manager for the unified console is deployed to all OUs in the organization, A, B, and C."}),"\n",(0,s.jsx)(n.li,{children:"The Quick Setup configuration manager for JITNA is deployed into OUs A and B."}),"\n"]}),"\n",(0,s.jsx)(n.admonition,{type:"info",children:(0,s.jsx)(n.p,{children:"Just-in-time node access can either be enabled across your AWS Organization or for specific Organizational Units (OUs) within the organization. Deployable Regions for just-in-time node access include all Regions you have enabled for the Systems Manager unified console. You cannot enable JITNA for Regions where the unified console is not enabled."})}),"\n",(0,s.jsx)(n.h3,{id:"deploy-quick-setup-configuration-managers",children:"Deploy Quick Setup configuration managers"}),"\n",(0,s.jsx)(n.p,{children:"To enable just-in-time node access using infrastructure-as-code (IaC), you need to:"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:["Deploy Quick Setup IAM service roles.","\n",(0,s.jsx)(n.admonition,{type:"info",children:(0,s.jsxs)(n.p,{children:["For more information on IAM service roles for Quick Setup, see ",(0,s.jsx)(n.a,{href:"https://docs.aws.amazon.com/systems-manager/latest/userguide/quick-setup-getting-started.html#quick-setup-api-manual-onboarding",children:"Manual onboarding for working with Quick Setup API programatically"}),"."]})}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["Deploy two ",(0,s.jsx)(n.a,{href:"https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-resource-ssmquicksetup-configurationmanager.html",children:"Quick Setup Configuration Managers"}),":","\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsx)(n.li,{children:"Systems Manager unified console."}),"\n",(0,s.jsx)(n.li,{children:"Systems Manager just-in-time-node access."}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"The following example CloudFormation template includes creating the two required Quick Setup IAM service roles and deploys the two Quick Setup configuration managers for the Systems Manager unified console and JITNA."}),"\n",(0,s.jsx)(n.h4,{id:"sample-cloudformation-template",children:"Sample CloudFormation template"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.a,{href:"https://github.com/aws-samples/cloud-operations-best-practices/blob/main/cloud-operations-best-practices/static/cfn-templates/just-in-time-node-access/just-in-time-quick-setup-cfn-template.yaml",children:"Just-in-time node access sample CFN template - Quick Setup configuration managers"})}),"\n",(0,s.jsx)(n.h5,{id:"cloudformation-template-parameters",children:"CloudFormation template parameters"}),"\n","\n",(0,s.jsx)(o.A,{groupId:"type",defaultValue:"organization",values:[{label:"AWS Organization enablement",value:"organization"}],children:(0,s.jsx)(r.A,{value:"organization",children:(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"Parameter Name"}),(0,s.jsx)(n.th,{children:"Description"}),(0,s.jsx)(n.th,{children:"Example value"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"AgentUpdateSchedule"})}),(0,s.jsx)(n.td,{children:"(Optional) The interval at which the agent update association runs. To opt-out, enter none."}),(0,s.jsx)(n.td,{children:"rate(14 days)"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"DelegatedAdminAccountId"})}),(0,s.jsx)(n.td,{children:"AWS Account ID for the Systems Manager delegated administrator account."}),(0,s.jsx)(n.td,{children:"123456789012"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"EnableDHMCSchedule"})}),(0,s.jsx)(n.td,{children:"(Optional) The interval at which the DHMC association runs. To opt-out, enter none."}),(0,s.jsx)(n.td,{children:"rate(1 day)"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"HomeRegion"})}),(0,s.jsx)(n.td,{children:"AWS Region where the Systems Manager unified console is deployed."}),(0,s.jsx)(n.td,{children:"us-east-1"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"IdentityProviderSetting"})}),(0,s.jsx)(n.td,{children:"Specifies identity provider IAM Identity Access Management (IAM) or Single Sign-On (SSO) used for determining who is the current access control template approver."}),(0,s.jsx)(n.td,{children:"IAM"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"InventoryCollectionSchedule"})}),(0,s.jsx)(n.td,{children:"(Optional) The interval at which inventory collection runs. To opt-out, enter none."}),(0,s.jsx)(n.td,{children:"rate(24 hours)"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"JITNATargetOrganizationalUnits"})}),(0,s.jsx)(n.td,{children:"Comma-separated list of AWS Organization Unit IDs where just-in-time node access is set up."}),(0,s.jsx)(n.td,{children:"ou-a1b2-abcd1234,ou-a1b2-efgh1234,ou-a1b2-hijk1234"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"JITNATargetRegions"})}),(0,s.jsxs)(n.td,{children:["The Regions where you want to enable just-in-time node access. The Regions specified must either match the Regions specified in the parameter ",(0,s.jsx)(n.code,{children:"UnifiedConsoleTargetRegions"})," or must be a subset of Regions specified in the parameter ",(0,s.jsx)(n.code,{children:"UnifiedConsoleTargetRegions"}),"."]}),(0,s.jsx)(n.td,{children:"us-east-1,us-east-2,us-west-2"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"UnifiedConsoleRootOrganizationUnitID"})}),(0,s.jsx)(n.td,{children:"The root AWS Organization unit ID."}),(0,s.jsx)(n.td,{children:"r-abcd"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"UnifiedConsoleTargetRegions"})}),(0,s.jsx)(n.td,{children:"Comma-separated list of AWS Regions where the Systems Manager unified console is set up. Data is aggregated from these Regions and replicated to your home Region."}),(0,s.jsx)(n.td,{children:"us-east-1,us-east-2,us-west-2"})]})]})]})})}),"\n",(0,s.jsx)(n.h2,{id:"configure-just-in-time-node-access",children:"Configure just-in-time node access"}),"\n",(0,s.jsx)(n.p,{children:"After you have enabled just-in-time node access for your environment, you can then begin deploying approval policies, session preferences, and notification configurations."}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.a,{href:"https://docs.aws.amazon.com/systems-manager/latest/userguide/systems-manager-just-in-time-node-access-approval-policies.html",children:"Approval policies for your nodes"}),"."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.a,{href:"https://docs.aws.amazon.com/systems-manager/latest/userguide/systems-manager-just-in-time-node-access-session-preferences.html",children:"Session preferences"})," for just-in-time sessions."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.a,{href:"https://docs.aws.amazon.com/systems-manager/latest/userguide/systems-manager-just-in-time-node-access-notifications.html",children:"Notification configurations"})," for just-in-time access requests."]}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"deploy-approval-policies-for-your-nodes",children:"Deploy approval policies for your nodes"}),"\n",(0,s.jsx)(n.p,{children:"Below is an example architecture diagram for deploying just-in-time node access approval policies and session preferences."}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{alt:"Example architecture diagram for deploying just-in-time node access approval policies and session preferences",src:t(2630).A+"",title:"Just-in-time node access approval policies and preferences architecture diagram",width:"1778",height:"1278"})}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsx)(n.li,{children:"Create a CloudFormation StackSet to deploy an auto-approval policy, manual approval policy (or policies), and session preferences as Systems Manager documents."}),"\n",(0,s.jsx)(n.li,{children:"In each target account and Region, CloudFormation stacks deploy the required resources."}),"\n",(0,s.jsx)(n.li,{children:"Create a CloudFormation Stack in the delegated administrator account for Systems Manager to deploy the deny-only access policy."}),"\n"]}),"\n",(0,s.jsxs)(n.admonition,{type:"info",children:[(0,s.jsx)(n.p,{children:"You can only have one deny-access policy per organization. You can only have one auto-approval policy per account and Region."}),(0,s.jsx)(n.p,{children:"You can create up to 50 manual approval policies per AWS account and AWS Region. However, when multiple manual approval policies apply to a node, this results in a conflict and users are unable to request access to the node. Keep this in mind when creating your manual approval policies since some instances might have multiple tags depending on your case."})]}),"\n",(0,s.jsx)(n.p,{children:"The following example CloudFormation template creates:"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:["An auto-approval policy to allow automatic access to development managed nodes identified by the resource tag key-value pair ",(0,s.jsx)(n.code,{children:"ENV:DEV"}),"."]}),"\n",(0,s.jsxs)(n.li,{children:["Two manual approval policies:","\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:["One manual approval policy for the E-commerce application which applies to managed nodes with the resource tag key-value pair ",(0,s.jsx)(n.code,{children:"Workload:Ecommerce"}),"."]}),"\n",(0,s.jsxs)(n.li,{children:["One manual approval policy for the Finance application which applies to managed nodes with the resource tag key-value pair ",(0,s.jsx)(n.code,{children:"Workload:Finance"}),"."]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.li,{children:"A session preferences document to be used during just-in-time node access sessions."}),"\n"]}),"\n",(0,s.jsx)(n.h4,{id:"sample-cloudformation-template---jitna-configuration",children:"Sample CloudFormation template - JITNA Configuration"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.a,{href:"https://github.com/aws-samples/cloud-operations-best-practices/blob/main/cloud-operations-best-practices/static/cfn-templates/just-in-time-node-access/just-in-time-cfn-approval-policies.yaml",children:"Just-in-time node access sample CFN template - Approval policies and Session preferences"})})]})}function h(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(p,{...e})}):p(e)}},8453:(e,n,t)=>{t.d(n,{R:()=>o,x:()=>r});var a=t(6540);const s={},i=a.createContext(s);function o(e){const n=a.useContext(i);return a.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function r(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:o(e.components),a.createElement(i.Provider,{value:n},e.children)}},9365:(e,n,t)=>{t.d(n,{A:()=>o});t(6540);var a=t(4164);const s={tabItem:"tabItem_Ymn6"};var i=t(4848);function o({children:e,hidden:n,className:t}){return(0,i.jsx)("div",{role:"tabpanel",className:(0,a.A)(s.tabItem,t),hidden:n,children:e})}}}]);