"use strict";(self.webpackChunkaws_cloud_operations_best_practices=self.webpackChunkaws_cloud_operations_best_practices||[]).push([[829],{3055:(e,t,i)=>{i.r(t),i.d(t,{assets:()=>c,contentTitle:()=>a,default:()=>u,frontMatter:()=>s,metadata:()=>n,toc:()=>d});const n=JSON.parse('{"id":"guides/AWS CloudTrail/CloudTrail Network Activity Events/index","title":"CloudTrail Network Activity Events","description":"With network activity events for VPC endpoints, you can view details of who is accessing resources within your network giving you greater ability to identify and respond to malicious or unauthorized actions in your data perimeter. For example, as the VPC endpoint owner, you can view logs of actions that were denied due to VPC endpoint policies or determine if an actor outside of your data perimeter is trying to access the data in your S3 buckets.","source":"@site/docs/guides/AWS CloudTrail/CloudTrail Network Activity Events/index.mdx","sourceDirName":"guides/AWS CloudTrail/CloudTrail Network Activity Events","slug":"/guides/AWS CloudTrail/CloudTrail Network Activity Events/","permalink":"/cloud-operations-best-practices/docs/guides/AWS CloudTrail/CloudTrail Network Activity Events/","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":5,"frontMatter":{"sidebar_position":5},"sidebar":"tutorialSidebar","previous":{"title":"CloudTrail Data Events","permalink":"/cloud-operations-best-practices/docs/guides/AWS CloudTrail/CloudTrail-DataEvents/"},"next":{"title":"Application Operations","permalink":"/cloud-operations-best-practices/docs/guides/application-operations/"}}');var o=i(4848),r=i(8453);const s={sidebar_position:5},a="CloudTrail Network Activity Events",c={},d=[{value:"Advanced Event Selectors for Network Activity Events",id:"advanced-event-selectors-for-network-activity-events",level:3},{value:"Demo: Network Activity Events for CloudTrail Lake",id:"demo-network-activity-events-for-cloudtrail-lake",level:3},{value:"Sample SQL Queries for CloudTrail Lake:",id:"sample-sql-queries-for-cloudtrail-lake",level:3},{value:"Count of VPC Access Denied Errors",id:"count-of-vpc-access-denied-errors",level:4},{value:"VPC Access Denied Errors",id:"vpc-access-denied-errors",level:4},{value:"Cloud Operation Show: Securing your VPC Endpoints using Network Activity Events | AWS CloudTrail",id:"cloud-operation-show-securing-your-vpc-endpoints-using-network-activity-events--aws-cloudtrail",level:3}];function l(e){const t={a:"a",code:"code",h1:"h1",h3:"h3",h4:"h4",header:"header",p:"p",pre:"pre",...(0,r.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(t.header,{children:(0,o.jsx)(t.h1,{id:"cloudtrail-network-activity-events",children:"CloudTrail Network Activity Events"})}),"\n",(0,o.jsx)(t.p,{children:"With network activity events for VPC endpoints, you can view details of who is accessing resources within your network giving you greater ability to identify and respond to malicious or unauthorized actions in your data perimeter. For example, as the VPC endpoint owner, you can view logs of actions that were denied due to VPC endpoint policies or determine if an actor outside of your data perimeter is trying to access the data in your S3 buckets."}),"\n",(0,o.jsx)(t.h3,{id:"advanced-event-selectors-for-network-activity-events",children:"Advanced Event Selectors for Network Activity Events"}),"\n",(0,o.jsx)(t.p,{children:"When you use network activity events, advanced event selectors offer greater control over which CloudTrail events are ingested into your event data stores. With advanced event selectors, you can include or exclude values on fields such as errorCode, eventName, & vpcEndpointId. Advanced event selectors also support including or excluding values with pattern matching on partial strings. This increases the efficiency and precision of your security, compliance, and operational investigations while helping reduce costs. For example, you can filter CloudTrail events based on the vpcEndpointId attribute to only inlcude events from a specific VPC edpoint Id. This allows you to significantly reduce the volume of CloudTrail events ingested into CloudTrail Lake, lowering costs while maintaining visibility into relevant user and system activities."}),"\n",(0,o.jsx)(t.h3,{id:"demo-network-activity-events-for-cloudtrail-lake",children:(0,o.jsx)(t.a,{href:"https://aws-cloudops.storylane.io/demo/n5vlqcsmygpi",children:"Demo: Network Activity Events for CloudTrail Lake"})}),"\n",(0,o.jsx)(t.p,{children:"In the following interactive demo we will explore how to use network activity events for VPC endpoints in CloudTrail Lake."}),"\n",(0,o.jsxs)("div",{children:[(0,o.jsx)("script",{async:!0,src:"https://js.storylane.io/js/v2/storylane.js"}),(0,o.jsx)("div",{class:"sl-embed",style:{position:"relative",paddingBottom:"56.25%",width:"100%",height:"0",transform:"scale(1)"},children:(0,o.jsx)("iframe",{loading:"lazy",class:"sl-demo",src:"https://aws-cloudops.storylane.io/demo/n5vlqcsmygpi?embed=inline",name:"sl-embed",allow:"fullscreen",allowfullscreen:!0,style:{position:"absolute",top:"0",left:"0",width:"100%",height:"100%",border:"1px solid rgba(63,95,172,0.35)",boxShadow:"0px 0px 18px rgba(26, 19, 72, 0.15)",borderRadius:"10px;box-sizing:border-box"}})})]}),"\n",(0,o.jsx)(t.h3,{id:"sample-sql-queries-for-cloudtrail-lake",children:"Sample SQL Queries for CloudTrail Lake:"}),"\n",(0,o.jsx)(t.h4,{id:"count-of-vpc-access-denied-errors",children:"Count of VPC Access Denied Errors"}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{children:"SELECT count(*) as VPCAccessDenied, userIdentity.arn,\n    userIdentity.accountid,\n    eventName,\n    errorMessage,\n    vpcEndpointId,\n    vpcEndpointAccountId,\n    sourceIPAddress\nFROM $EDS_ID\nWHERE eventCategory = 'NetworkActivity'\n    AND eventSource = 's3.amazonaws.com' \n    AND errorCode = 'VpceAccessDenied' \n    AND eventtime >= '2025-02-18 17:00:00'\n    AND eventtime <= '2025-02-21 17:00:00'\n    GROUP BY \n    userIdentity.arn,\n    userIdentity.accountid,\n    eventName,\n    errorMessage,\n    vpcEndpointId,\n    vpcEndpointAccountId,\n    sourceIPAddress\n    ORDER BY eventName DESC;\n"})}),"\n",(0,o.jsx)(t.h4,{id:"vpc-access-denied-errors",children:"VPC Access Denied Errors"}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{children:"SELECT userIdentity.arn,\n    userIdentity.accountid,\n    eventType,\n    eventCategory,\n    eventName,\n    errorCode,\n    errorMessage,\n    vpcEndpointId,\n    vpcEndpointAccountId,\n    sourceIPAddress\nFROM $EDS_ID\nWHERE eventCategory = 'NetworkActivity'\n    AND eventSource = 's3.amazonaws.com' \n    AND errorCode = 'VpceAccessDenied' \n    AND eventtime >= '2025-02-18 17:00:00'\n    AND eventtime <= '2025-02-20 17:00:00'\n    ORDER BY eventTime DESC;\n"})}),"\n",(0,o.jsx)(t.h3,{id:"cloud-operation-show-securing-your-vpc-endpoints-using-network-activity-events--aws-cloudtrail",children:"Cloud Operation Show: Securing your VPC Endpoints using Network Activity Events | AWS CloudTrail"}),"\n",(0,o.jsx)("div",{align:"center",children:(0,o.jsx)("iframe",{width:"560",height:"315",src:"https://www.youtube.com/embed/pAppy_tkWPY?si=sy7w_Yp8nejmwbLv",title:"YouTube video player",frameborder:"0",allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share",referrerpolicy:"strict-origin-when-cross-origin",allowfullscreen:!0})})]})}function u(e={}){const{wrapper:t}={...(0,r.R)(),...e.components};return t?(0,o.jsx)(t,{...e,children:(0,o.jsx)(l,{...e})}):l(e)}},8453:(e,t,i)=>{i.d(t,{R:()=>s,x:()=>a});var n=i(6540);const o={},r=n.createContext(o);function s(e){const t=n.useContext(r);return n.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function a(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:s(e.components),n.createElement(r.Provider,{value:t},e.children)}}}]);