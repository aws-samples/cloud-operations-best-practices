<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-recipes/centralized-operations-management/patch-reporting/index" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.9.2">
<title data-rh="true">Centralized patch compliance reporting | AWS Cloud Operations Best Practices</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://aws-samples.github.io/cloud-operations-best-practices/docs/recipes/centralized-operations-management/patch-reporting/"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Centralized patch compliance reporting | AWS Cloud Operations Best Practices"><meta data-rh="true" name="description" content="What is patch compliance?"><meta data-rh="true" property="og:description" content="What is patch compliance?"><link data-rh="true" rel="icon" href="/cloud-operations-best-practices/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://aws-samples.github.io/cloud-operations-best-practices/docs/recipes/centralized-operations-management/patch-reporting/"><link data-rh="true" rel="alternate" href="https://aws-samples.github.io/cloud-operations-best-practices/docs/recipes/centralized-operations-management/patch-reporting/" hreflang="en"><link data-rh="true" rel="alternate" href="https://aws-samples.github.io/cloud-operations-best-practices/docs/recipes/centralized-operations-management/patch-reporting/" hreflang="x-default"><script data-rh="true" type="application/ld+json">{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Recipes","item":"https://aws-samples.github.io/cloud-operations-best-practices/docs/recipes/"},{"@type":"ListItem","position":2,"name":"Centralized Operations Management","item":"https://aws-samples.github.io/cloud-operations-best-practices/docs/recipes/centralized-operations-management/"},{"@type":"ListItem","position":3,"name":"Centralized patch compliance reporting","item":"https://aws-samples.github.io/cloud-operations-best-practices/docs/recipes/centralized-operations-management/patch-reporting/"}]}</script><link rel="stylesheet" href="/cloud-operations-best-practices/assets/css/styles.4d5a722e.css">
<script src="/cloud-operations-best-practices/assets/js/runtime~main.090c0998.js" defer="defer"></script>
<script src="/cloud-operations-best-practices/assets/js/main.9f60db74.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<svg style="display: none;"><defs>
<symbol id="theme-svg-external-link" viewBox="0 0 24 24"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></symbol>
</defs></svg>
<script>!function(){var t=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();document.documentElement.setAttribute("data-theme",t||(window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light")),document.documentElement.setAttribute("data-theme-choice",t||"system")}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="theme-layout-navbar navbar navbar--fixed-top"><div class="navbar__inner"><div class="theme-layout-navbar-left navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/cloud-operations-best-practices/"><b class="navbar__title text--truncate">AWS Cloud Operations Best Practices</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/cloud-operations-best-practices/docs/home">Home</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/cloud-operations-best-practices/docs/guides/">Guides</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/cloud-operations-best-practices/docs/solutions/">Solutions</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/cloud-operations-best-practices/docs/recipes/">Recipes</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/cloud-operations-best-practices/docs/faq/">FAQ</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/cloud-operations-best-practices/docs/contributors">Contributors</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/cloud-operations-best-practices/docs/resources/">Resources</a></div><div class="theme-layout-navbar-right navbar__items navbar__items--right"><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link"><svg viewBox="0 0 24 24" width="20" height="20" aria-hidden="true" class="iconLanguage_nlXk"><path fill="currentColor" d="M12.87 15.07l-2.54-2.51.03-.03c1.74-1.94 2.98-4.17 3.71-6.53H17V4h-7V2H8v2H1v1.99h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11.76-2.04zM18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2l-4.5-12zm-2.62 7l1.62-4.33L19.12 17h-3.24z"></path></svg>English</a><ul class="dropdown__menu"><li><a href="/cloud-operations-best-practices/docs/recipes/centralized-operations-management/patch-reporting/" target="_self" rel="noopener noreferrer" class="dropdown__link dropdown__link--active" lang="en">English</a></li></ul></div><a href="https://github.com/aws-samples/cloud-operations-best-practices" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="system mode" aria-label="Switch between dark and light mode (currently system mode)"><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP systemToggleIcon_QzmC"><path fill="currentColor" d="m12 21c4.971 0 9-4.029 9-9s-4.029-9-9-9-9 4.029-9 9 4.029 9 9 9zm4.95-13.95c1.313 1.313 2.05 3.093 2.05 4.95s-0.738 3.637-2.05 4.95c-1.313 1.313-3.093 2.05-4.95 2.05v-14c1.857 0 3.637 0.737 4.95 2.05z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="theme-layout-main main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/cloud-operations-best-practices/docs/home"><span title="What is AWS Cloud Operations" class="linkLabel_WmDU">What is AWS Cloud Operations</span></a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist" href="/cloud-operations-best-practices/docs/guides/"><span title="Best practices" class="categoryLinkLabel_W154">Best practices</span></a><button aria-label="Expand sidebar category &#x27;Best practices&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist" href="/cloud-operations-best-practices/docs/solutions/"><span title="Solutions" class="categoryLinkLabel_W154">Solutions</span></a><button aria-label="Expand sidebar category &#x27;Solutions&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--active" href="/cloud-operations-best-practices/docs/recipes/"><span title="Recipes" class="categoryLinkLabel_W154">Recipes</span></a><button aria-label="Collapse sidebar category &#x27;Recipes&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist" tabindex="0" href="/cloud-operations-best-practices/docs/recipes/AWS CloudTrail/"><span title="AWS CloudTrail" class="categoryLinkLabel_W154">AWS CloudTrail</span></a><button aria-label="Expand sidebar category &#x27;AWS CloudTrail&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/cloud-operations-best-practices/docs/recipes/application-operations/"><span title="Application Operations" class="linkLabel_WmDU">Application Operations</span></a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--active" tabindex="0" href="/cloud-operations-best-practices/docs/recipes/centralized-operations-management/"><span title="Centralized Operations Management" class="categoryLinkLabel_W154">Centralized Operations Management</span></a><button aria-label="Collapse sidebar category &#x27;Centralized Operations Management&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist" tabindex="0" href="/cloud-operations-best-practices/docs/recipes/centralized-operations-management/just-in-time-node-access/"><span title="Just-in-time node access (JITNA)" class="categoryLinkLabel_W154">Just-in-time node access (JITNA)</span></a><button aria-label="Expand sidebar category &#x27;Just-in-time node access (JITNA)&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/cloud-operations-best-practices/docs/recipes/centralized-operations-management/patch-reporting/"><span title="Centralized patch compliance reporting" class="linkLabel_WmDU">Centralized patch compliance reporting</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/cloud-operations-best-practices/docs/recipes/centralized-operations-management/pwsh-run-command-custom-credentials/"><span title="Invoking PowerShell commands as a custom Windows user in Systems Manager Run Command" class="linkLabel_WmDU">Invoking PowerShell commands as a custom Windows user in Systems Manager Run Command</span></a></li></ul></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist" href="/cloud-operations-best-practices/docs/faq/"><span title="FAQ" class="categoryLinkLabel_W154">FAQ</span></a><button aria-label="Expand sidebar category &#x27;FAQ&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/cloud-operations-best-practices/docs/resources/"><span title="Resources" class="linkLabel_WmDU">Resources</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/cloud-operations-best-practices/docs/contributors"><span title="Contributors" class="linkLabel_WmDU">Contributors</span></a></li></ul></nav><button type="button" title="Collapse sidebar" aria-label="Collapse sidebar" class="button button--secondary button--outline collapseSidebarButton_PEFL"><svg width="20" height="20" aria-hidden="true" class="collapseSidebarButtonIcon_kv0_"><g fill="#7a7a7a"><path d="M9.992 10.023c0 .2-.062.399-.172.547l-4.996 7.492a.982.982 0 01-.828.454H1c-.55 0-1-.453-1-1 0-.2.059-.403.168-.551l4.629-6.942L.168 3.078A.939.939 0 010 2.528c0-.548.45-.997 1-.997h2.996c.352 0 .649.18.828.45L9.82 9.472c.11.148.172.347.172.55zm0 0"></path><path d="M19.98 10.023c0 .2-.058.399-.168.547l-4.996 7.492a.987.987 0 01-.828.454h-3c-.547 0-.996-.453-.996-1 0-.2.059-.403.168-.551l4.625-6.942-4.625-6.945a.939.939 0 01-.168-.55 1 1 0 01.996-.997h3c.348 0 .649.18.828.45l4.996 7.492c.11.148.168.347.168.55zm0 0"></path></g></svg></button></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/cloud-operations-best-practices/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><a class="breadcrumbs__link" href="/cloud-operations-best-practices/docs/recipes/"><span>Recipes</span></a></li><li class="breadcrumbs__item"><a class="breadcrumbs__link" href="/cloud-operations-best-practices/docs/recipes/centralized-operations-management/"><span>Centralized Operations Management</span></a></li><li class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link">Centralized patch compliance reporting</span></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Centralized patch compliance reporting</h1></header>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="what-is-patch-compliance">What is patch compliance?<a href="#what-is-patch-compliance" class="hash-link" aria-label="Direct link to What is patch compliance?" title="Direct link to What is patch compliance?" translate="no">​</a></h2>
<p>Patch compliance is the process of ensuring all computing resources have the latest security updates and bug fixes installed according to organizational policies. A system is considered &quot;patch compliant&quot; when all required patches defined in your patch baseline have been successfully applied. Non-compliant systems may have missing critical security updates, potentially exposing your organization to security vulnerabilities that could be exploited by malicious actors.</p>
<p>In modern cloud environments spanning multiple AWS accounts and regions, decentralized patch management creates significant challenges including visibility gaps, inconsistent reporting, delayed responses to vulnerabilities, complex audit processes, and duplicated effort across teams. These challenges can lead to extended security exposure and inefficient use of resources throughout your organization.</p>
<p>Centralized patch compliance reporting addresses these challenges by consolidating data from all accounts and regions into a single location, providing a comprehensive view of your security posture. This approach delivers numerous benefits: a single source of truth for compliance status, real-time awareness of vulnerabilities, consistent metrics across environments, simplified auditing, trend analysis capabilities, improved resource efficiency, and the foundation for automated remediation workflows.</p>
<p>AWS Systems Manager provides the foundation for this centralization through Patch Manager to automate patching processes, <a href="https://docs.aws.amazon.com/systems-manager/latest/userguide/inventory-create-resource-data-sync.html" target="_blank" rel="noopener noreferrer" class="">resource data syncs</a> to aggregate compliance data into a central S3 bucket, and analytics services like AWS Glue, Amazon Athena, and Amazon QuickSight to transform, query, and visualize the data. The solution described in this recipe leverages these components to create a comprehensive reporting system that works across your entire AWS organization, enabling more efficient operations and faster vulnerability remediation.</p>
<div class="theme-admonition theme-admonition-tip admonition_xJq3 alert alert--success"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>tip</div><div class="admonitionContent_BuS1"><p>The resource data sync provides inventory and patch compliance metadata in the form of a JSON file. As an alternative to using Athena and QuickSight, you can use any BI or analytics tool that can pull the data from the S3 bucket.</p></div></div>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="purpose">Purpose<a href="#purpose" class="hash-link" aria-label="Direct link to Purpose" title="Direct link to Purpose" translate="no">​</a></h2>
<p>The purpose of this recipe is to provide sample CloudFormation templates which can be used to provision the resources required for centralized patch compliance reporting. This recipe does not cover deploying patch scan or install operations.</p>
<p>For more information on how to prepare for patching managed nodes, see <a class="" href="/cloud-operations-best-practices/docs/solutions/centralized-operations-management/patch-nodes-using-tags/">Patching managed nodes using AWS Systems Manager and tagging</a>.</p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="prerequisites">Prerequisites<a href="#prerequisites" class="hash-link" aria-label="Direct link to Prerequisites" title="Direct link to Prerequisites" translate="no">​</a></h2>
<p>Before beginning deployment, ensure you have:</p>
<ul>
<li class="">AWS Organizations setup: A properly configured AWS Organization with a management account and member accounts.</li>
<li class="">Managed nodes configured: Amazon Elastic Compute Cloud (EC2) instances, AWS Internet of Things (IoT) Greengrass core devices, on-premises servers, edge devices, and VMs must be Systems Manager managed nodes to perform patching operations and report patch compliance.</li>
<li class="">Patch operations implemented: At minimum, a patch scan operation must be configured and executed at least once. Without this, there will be no compliance data to report on. For more information on different types of patching and how to implement patching, see the <a class="" href="/cloud-operations-best-practices/docs/guides/centralized-operations-management/patch-management">Patch Management Best Practices guide</a> and the section <a class="" href="/cloud-operations-best-practices/docs/guides/centralized-operations-management/patch-management#different-types-of-patching">Different types of patching</a>.</li>
<li class="">IAM permissions: Appropriate permissions to deploy CloudFormation templates and create the required resources in both the central reporting account and member accounts.</li>
<li class="">Amazon QuickSight: In order to visualize patch compliance information using QuickSight, you must <a href="https://docs.aws.amazon.com/quicksight/latest/user/signing-up.html" target="_blank" rel="noopener noreferrer" class="">sign up for QuickSight</a>.</li>
<li class="">Amazon QuickSight Permissions to S3: You must ensure QuickSight has permissions to the S3 buckets created in <a href="#phase-1-central-account-setup" class="">Phase 1: Central account setup</a>. More information is provided in <a href="#prerequisites-to-complete-before-deploying-the-cloudformation-template-for-quicksight" class="">Prerequisites to complete before deploying the CloudFormation template for QuickSight</a>.</li>
</ul>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="considerations">Considerations<a href="#considerations" class="hash-link" aria-label="Direct link to Considerations" title="Direct link to Considerations" translate="no">​</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="resource-data-sync">Resource data sync<a href="#resource-data-sync" class="hash-link" aria-label="Direct link to Resource data sync" title="Direct link to Resource data sync" translate="no">​</a></h3>
<p>Currently, the <code>AWS::SSM::ResourceDataSync</code> resource in AWS CloudFormation does not support the <code>DestinationDataSharing</code> property within the <a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/TemplateReference/aws-properties-ssm-resourcedatasync-s3destination.html" target="_blank" rel="noopener noreferrer" class="">S3Destination</a> property which is required to create an inventory resource data sync which supports a simplified S3 bucket policy.</p>
<p>Due to this, this recipe uses a custom CloudFormation resource in the <a href="#sample-cloudformation-template-for-organization-resource-data-sync" class="">Sample CloudFormation template for organization resource data sync</a> section to use a Lambda function to create the resource data sync.</p>
<p>Alternatives to using the custom resource to create the resource data sync:</p>
<ol>
<li class="">Use the standard resource data sync which is supported by CloudFormation.<!-- -->
<ol>
<li class="">To accomplish this, you must create and use a bucket policy which grants permissions based in AWS account IDs. For more information and an example S3 bucket policy, see <a href="https://docs.aws.amazon.com/systems-manager/latest/userguide/inventory-create-resource-data-sync.html#datasync-before-you-begin" target="_blank" rel="noopener noreferrer" class="">Before you begin</a>.</li>
<li class="">Update the S3 bucket policy in the <a href="#sample-cloudformation-template-for-central-reporting-using-athena" class="">Sample CloudFormation template for central reporting using Athena</a> to use the new policy which lists out the AWS account IDs.</li>
<li class="">Use CloudFormation StackSets to deploy the <code>AWS::SSM::ResourceDataSync</code> resource. For an example CloudFormation resource snippet, see <a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/TemplateReference/aws-resource-ssm-resourcedatasync.html#aws-resource-ssm-resourcedatasync--examples--Create_a_SyncToDestination_resource_data_sync" target="_blank" rel="noopener noreferrer" class="">Create a SyncToDestination resource data sync</a>.</li>
</ol>
</li>
<li class="">Use an alternative method to create the organization resource data sync, for example, scripting via the AWS CLI or other SDKs.</li>
</ol>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="cost-considerations">Cost considerations<a href="#cost-considerations" class="hash-link" aria-label="Direct link to Cost considerations" title="Direct link to Cost considerations" translate="no">​</a></h3>
<p>Implementing centralized patch compliance reporting involves several AWS services, each with associated costs:</p>
<ol>
<li class=""><a href="https://aws.amazon.com/s3/pricing/" target="_blank" rel="noopener noreferrer" class="">Amazon S3 pricing</a>:<!-- -->
<ul>
<li class="">Standard storage costs for inventory and patch compliance data</li>
<li class="">Data transfer costs for syncing data from multiple accounts and regions<!-- -->
<ul>
<li class="">Cost increases linearly with the number of managed nodes and scan frequency</li>
</ul>
</li>
</ul>
</li>
<li class=""><a href="https://aws.amazon.com/glue/pricing/" target="_blank" rel="noopener noreferrer" class="">AWS Glue pricing</a>:<!-- -->
<ul>
<li class="">Crawler costs</li>
<li class="">For the default configuration (daily crawler run)</li>
</ul>
</li>
<li class=""><a href="https://aws.amazon.com/athena/pricing/" target="_blank" rel="noopener noreferrer" class="">Amazon Athena pricing</a>:<!-- -->
<ul>
<li class="">Query costs</li>
<li class="">Cost varies based on query complexity and frequency</li>
<li class="">Using partitioning and filtering can significantly reduce costs</li>
</ul>
</li>
<li class=""><a href="https://aws.amazon.com/lambda/pricing/" target="_blank" rel="noopener noreferrer" class="">AWS Lambda pricing</a>:<!-- -->
<ul>
<li class="">Minimal costs for the custom resource Lambda function</li>
<li class="">Free tier typically covers this usage for most implementations</li>
</ul>
</li>
<li class=""><a href="https://aws.amazon.com/quicksight/pricing/" target="_blank" rel="noopener noreferrer" class="">Amazon QuickSight pricing</a> (optional):<!-- -->
<ul>
<li class="">Author licenses and Reader licenses</li>
</ul>
</li>
</ol>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="architecture-overview">Architecture overview<a href="#architecture-overview" class="hash-link" aria-label="Direct link to Architecture overview" title="Direct link to Architecture overview" translate="no">​</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="central-reporting-account">Central reporting account<a href="#central-reporting-account" class="hash-link" aria-label="Direct link to Central reporting account" title="Direct link to Central reporting account" translate="no">​</a></h3>
<p>In the following diagram, the <strong>Central Reporting</strong> account is an AWS account within your AWS Organization dedicated for storing the patch and inventory metadata and querying or visualization.</p>
<div class="theme-admonition theme-admonition-warning admonition_xJq3 alert alert--warning"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>warning</div><div class="admonitionContent_BuS1"><p>It is <strong>not recommended</strong> to use the <a href="https://docs.aws.amazon.com/managedservices/latest/userguide/management-account.html" target="_blank" rel="noopener noreferrer" class="">AWS Organization management account</a> as the <strong>Central reporting account</strong>. <a href="https://docs.aws.amazon.com/organizations/latest/userguide/orgs_best-practices_mgmt-acct.html#bp_mgmt-acct_use-mgmt" target="_blank" rel="noopener noreferrer" class="">AWS best practices for the management account</a> recommends that you use the management account and its users and roles for tasks that <strong>must</strong> be performed only by that account. Store all of your AWS resources in other AWS accounts in the organization and keep them out of the management account.</p></div></div>
<p><img decoding="async" loading="lazy" alt="Architecture for the central reporting account" src="/cloud-operations-best-practices/assets/images/architecture-diagram-reporting-account-2c1bd5c3e3673b34240f049b28e4a15f.png" title="Architecture for the central reporting account" width="521" height="721" class="img_ev3q"></p>
<ol>
<li class="">The Glue crawler runs once a day to crawl the S3 bucket which hosts the resource data sync provided metadata.</li>
<li class="">The Glue crawler updates the database and tables based on the metadata in the S3 bucket.</li>
<li class="">After the Glue crawler completes its run, an event is sent to EventBridge.</li>
<li class="">An EventBridge rule invokes the Lambda function.</li>
<li class="">The Lambda function removes a duplicative column for the AWS<!-- -->:InstanceInformation<!-- --> table.<!-- -->
<div class="theme-admonition theme-admonition-info admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</div><div class="admonitionContent_BuS1"><p>The <code>AWS:InstanceInformation</code> table includes a column named <code>resourcetype</code>, which is also a partition key, which causes Athena queries to fail. The EventBridge rule is triggered by the Glue crawler execution, which then invokes the Lambda function to delete the column.</p></div></div>
</li>
<li class="">Athena queries the Glue database and tables based on the queries you run.</li>
<li class="">(Optionally) You can create a QuickSight dashboard to visualize patch compliance information. <strong>Note:</strong> QuickSight is not included in the example CloudFormation template.</li>
</ol>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="member-accountsregions-with-managed-nodes">Member account(s)/Region(s) with managed nodes<a href="#member-accountsregions-with-managed-nodes" class="hash-link" aria-label="Direct link to Member account(s)/Region(s) with managed nodes" title="Direct link to Member account(s)/Region(s) with managed nodes" translate="no">​</a></h3>
<p><img decoding="async" loading="lazy" alt="Architecture for the AWS Organization resource data sync" src="/cloud-operations-best-practices/assets/images/architecture-diagram-ssm-org-resource-data-sync-161bdfe9c3489135927e0c67d8145af9.png" title="Architecture for the AWS Organization resource data sync" width="1903" height="1753" class="img_ev3q"></p>
<ol>
<li class="">The CloudFormation StackSet in the delegated administrator account creates stack instances in the target AWS accounts/Regions to create the required resources.</li>
<li class="">The stack instance creates an IAM service role, Lambda function, and custom CloudFormation resource.</li>
<li class="">The Lambda function creates a Systems Manager resource data sync for AWS Organizations.</li>
<li class="">The resource data sync sends inventory and patch compliance metadata to the S3 bucket specified in the <a href="#central-reporting-account" class="">central reporting account</a>.</li>
</ol>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="process-timeline">Process timeline<a href="#process-timeline" class="hash-link" aria-label="Direct link to Process timeline" title="Direct link to Process timeline" translate="no">​</a></h3>
<p>The following diagram displays the process timeline of querying patch compliance for managed nodes.</p>
<p><img decoding="async" loading="lazy" alt="Process timeline for patching operations" src="/cloud-operations-best-practices/assets/images/architecture-diagram-org-patch-reporting-combined-59b09a9d81ead32b132aa591f01b32a6.png" title="Process timeline for patching operations" width="3828" height="1803" class="img_ev3q"></p>
<ol>
<li class="">Following a patch scan, install, or inventory metadata gathering operation, SSM agent on the managed node reports back data to Systems Manager.</li>
<li class="">The patch and inventory metadata updates are identified by the resource data sync based on actions taken.</li>
<li class="">The resource data sync ships the metadata to the S3 bucket specified in the central reporting account.</li>
<li class="">You can then use Athena to query the results following the operation.</li>
</ol>
<p>As noted in the diagram above, you can register hybrid managed nodes for patching or inventory metadata gathering and the data will flow into the same S3 bucket as EC2 instances.</p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="deployment-steps">Deployment steps<a href="#deployment-steps" class="hash-link" aria-label="Direct link to Deployment steps" title="Direct link to Deployment steps" translate="no">​</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="deployment-checklist">Deployment checklist<a href="#deployment-checklist" class="hash-link" aria-label="Direct link to Deployment checklist" title="Direct link to Deployment checklist" translate="no">​</a></h3>
<p>Below you can find a checklist for the deployment steps included in this recipe.</p>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="central-reporting-account-tasks">Central reporting account tasks<a href="#central-reporting-account-tasks" class="hash-link" aria-label="Direct link to Central reporting account tasks" title="Direct link to Central reporting account tasks" translate="no">​</a></h4>
<ul class="contains-task-list containsTaskList_mC6p">
<li class="task-list-item"><input type="checkbox" disabled=""> <!-- -->Deploy CloudFormation stack for Athena resources</li>
<li class="task-list-item"><input type="checkbox" disabled=""> <!-- -->Note S3 bucket names from stack outputs</li>
<li class="task-list-item"><input type="checkbox" disabled=""> <!-- -->Configure QuickSight permissions for S3 buckets</li>
<li class="task-list-item"><input type="checkbox" disabled=""> <!-- -->Deploy CloudFormation stack for QuickSight visualization</li>
<li class="task-list-item"><input type="checkbox" disabled=""> <!-- -->Verify access to QuickSight analysis</li>
</ul>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="member-account-tasks-via-stacksets">Member account tasks (via StackSets)<a href="#member-account-tasks-via-stacksets" class="hash-link" aria-label="Direct link to Member account tasks (via StackSets)" title="Direct link to Member account tasks (via StackSets)" translate="no">​</a></h4>
<ul class="contains-task-list containsTaskList_mC6p">
<li class="task-list-item"><input type="checkbox" disabled=""> <!-- -->Deploy organization resource data sync CloudFormation StackSet</li>
<li class="task-list-item"><input type="checkbox" disabled=""> <!-- -->Verify resource data syncs are created in member accounts</li>
</ul>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="phase-1-central-account-setup">Phase 1: Central account setup<a href="#phase-1-central-account-setup" class="hash-link" aria-label="Direct link to Phase 1: Central account setup" title="Direct link to Phase 1: Central account setup" translate="no">​</a></h3>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="sample-cloudformation-template-for-central-reporting-using-athena">Sample CloudFormation template for central reporting using Athena<a href="#sample-cloudformation-template-for-central-reporting-using-athena" class="hash-link" aria-label="Direct link to Sample CloudFormation template for central reporting using Athena" title="Direct link to Sample CloudFormation template for central reporting using Athena" translate="no">​</a></h4>
<p>Below you can find details about the resources created by the CloudFormation template and their purpose.</p>
<p><a href="https://github.com/aws-samples/cloud-operations-best-practices/blob/main/cloud-operations-best-practices/static/cfn-templates/patch-reporting/patch-reporting.yaml" target="_blank" rel="noopener noreferrer" class="">Sample CloudFormation template for central reporting using Athena</a></p>
<table><thead><tr><th>Resource Name</th><th>Purpose</th></tr></thead><tbody><tr><td><strong>KMS resources</strong></td><td></td></tr><tr><td>ManagedInstanceDataEncryptionKey</td><td>Customer managed key (CMK) to encrypt managed node metadata in the resource data sync S3 bucket.</td></tr><tr><td>ManagedInstanceDataEncryptionKeyAlias</td><td>Alias for the CMK.</td></tr><tr><td><strong>S3 resources</strong></td><td></td></tr><tr><td>AthenaQueryResultsBucket</td><td>S3 bucket to store Athena query results.</td></tr><tr><td>ResourceSyncBucket</td><td>S3 bucket used to store managed node metadata provided by the resource data sync.</td></tr><tr><td>ResourceSyncBucketPolicy</td><td>S3 bucket policy for the resource data sync S3 bucket.</td></tr><tr><td><strong>Glue resources</strong></td><td></td></tr><tr><td>GlueDatabase</td><td>Glue database for resource data sync metadata.</td></tr><tr><td>GlueCrawler</td><td>Glue crawler to create database and tables.</td></tr><tr><td>GlueCrawlerRole</td><td>IAM role used by Glue crawler.</td></tr><tr><td>DeleteGlueTableColumnFunctionRole</td><td>IAM role for DeleteGlueTableColumnFunction Lambda function.</td></tr><tr><td>DeleteGlueTableColumnFunction</td><td>Lambda function to remove duplicate <code>resourcetype</code> partition key.</td></tr><tr><td>DeleteGlueTableColumnFunctionEventRule</td><td>Amazon EventBridge rule to invoke the DeleteGlueTableColumnFunction Lambda function.</td></tr><tr><td>DeleteGlueTableColumnFunctionCloudWatchPermission</td><td>Granting EventBridge permissions to invoke the DeleteGlueTableColumnFunction Lambda function.</td></tr><tr><td><strong>Athena resources</strong></td><td></td></tr><tr><td>AthenaWorkGroup</td><td>Athena workgroup for named queries.</td></tr><tr><td>AthenaQueryCompliantPatch</td><td>Example query to list managed nodes that are compliant for patching.</td></tr><tr><td>AthenaQueryNonCompliantPatch</td><td>Example query to list managed nodes that are non-compliant for patching.</td></tr><tr><td>AthenaQueryComplianceSummaryPatch</td><td>Example query to provide a compliance summary for patch for managed nodes.</td></tr><tr><td>AthenaQueryPatchSummary</td><td>Example query to provide a patch summary for managed nodes.</td></tr><tr><td>AthenaQueryInstanceList</td><td>Example query to return a list of non-terminated managed nodes.</td></tr><tr><td>AthenaQueryInstanceApplications</td><td>Example query to return a list of non-terminated managed nodes and their applications installed.</td></tr><tr><td>AthenaQuerySSMAgent</td><td>Example query to list SSM Agent versions installed on managed nodes.</td></tr><tr><td><strong>S3 cleanup resources</strong></td><td></td></tr><tr><td>S3CleanupLambdaExecutionRole</td><td>IAM role to clean up S3 buckets</td></tr><tr><td>S3BucketCleanup</td><td>Lambda function to clean up S3 buckets</td></tr><tr><td>S3Cleanup</td><td>Custom resource to clean up S3 buckets</td></tr></tbody></table>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="deploy-a-cloudformation-stack-for-athena-in-the-central-reporting-account">Deploy a CloudFormation stack for Athena in the central reporting account<a href="#deploy-a-cloudformation-stack-for-athena-in-the-central-reporting-account" class="hash-link" aria-label="Direct link to Deploy a CloudFormation stack for Athena in the central reporting account" title="Direct link to Deploy a CloudFormation stack for Athena in the central reporting account" translate="no">​</a></h4>
<ol>
<li class="">Download the <a href="https://github.com/aws-samples/cloud-operations-best-practices/blob/main/cloud-operations-best-practices/static/cfn-templates/patch-reporting/patch-reporting.yaml" target="_blank" rel="noopener noreferrer" class="">Sample CloudFormation template for central reporting using Athena</a> to your local machine.</li>
<li class="">In the central reporting account and Region, navigate to the <a href="https://console.aws.amazon.com/cloudformation/home" target="_blank" rel="noopener noreferrer" class="">AWS CloudFormation console</a>.</li>
<li class="">In left navigation pane, choose <strong>Stacks</strong>, and then choose <strong>Create stack</strong>.</li>
<li class="">From the dropdown list, choose <strong>With new resources (standard)</strong>.</li>
<li class="">On the <strong>Create stack</strong> page, select <strong>Upload a template file</strong>, select <strong>Choose file</strong>, choose the <code>patch-reporting.yaml</code> file, and then choose <strong>Next</strong>.</li>
<li class="">On the <strong>Specify stack details</strong> page, perform the following steps:<!-- -->
<ol>
<li class="">For <strong>Stack name</strong>, enter a descriptive name, such as <code>patch-reporting</code>.</li>
<li class="">For <strong>Organization ID</strong>, enter the AWS Organization ID for your AWS Organization. For example, <code>o-abcde12345</code>.</li>
</ol>
<div class="theme-admonition theme-admonition-tip admonition_xJq3 alert alert--success"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>tip</div><div class="admonitionContent_BuS1"><p>For more information on how to retrieve the AWS Organization ID, see <a href="https://docs.aws.amazon.com/organizations/latest/userguide/orgs_view_org.html" target="_blank" rel="noopener noreferrer" class="">Viewing details of an organization from the management account</a>.</p></div></div>
<ol>
<li class="">For <strong>Enable Glue Crawler Schedule</strong>, choose to enable or disbale scheduled execution of the Glue crawler.</li>
<li class="">For <strong>Glue Crawler Schedule (cron)</strong>, enter a cron schedule expression for the Glue crawler.</li>
<li class="">For <strong>Enable KMS permissions for QuickSight service role</strong>, choose to enable or disable KMS permissions for the QuickSight IAM service role. <strong>Note</strong>: If you do not grant KMS permissions, you will not be able to visualize patch compliance data using QuickSight.</li>
<li class="">Choose <strong>Next</strong>.</li>
</ol>
</li>
<li class="">On the <strong>Configure stack options</strong> page, add any required tags, select <strong>I acknowledge that AWS CloudFormation might create IAM resources with custom names</strong>, and then choose <strong>Next</strong>.</li>
<li class="">On the <strong>Review and create</strong> page, review all the information and then choose <strong>Submit</strong> to create your stack.</li>
</ol>
<p>After the page is refreshed, the status of your stack should be <code>CREATE_IN_PROGRESS</code>. When the status changes to <code>CREATE_COMPLETE</code>, you can then deploy the QuickSight visualization.</p>
<div class="theme-admonition theme-admonition-tip admonition_xJq3 alert alert--success"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>tip</div><div class="admonitionContent_BuS1"><p>Take note of the names of the Amazon S3 buckets for <strong>AthenaQueryResultsBucket</strong> and <strong>ResourceDataSyncBucketName</strong> which can be found in the <strong>Outputs</strong> tab of the CloudFormation stack. You will need these two values in the next section to deploy QuickSight.</p><p><img decoding="async" loading="lazy" alt="Outputs of the CloudFormation stack to show the resource data sync S3 bucket name" src="/cloud-operations-best-practices/assets/images/patch-reporting-cfn-outputs-44a39e0095dd1cf9be2dac81674e8533.png" title="Outputs of the CloudFormation stack to show the resource data sync S3 bucket name" width="989" height="553" class="img_ev3q"></p></div></div>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="sample-cloudformation-template-for-amazon-quicksight-visualization">Sample CloudFormation template for Amazon QuickSight visualization<a href="#sample-cloudformation-template-for-amazon-quicksight-visualization" class="hash-link" aria-label="Direct link to Sample CloudFormation template for Amazon QuickSight visualization" title="Direct link to Sample CloudFormation template for Amazon QuickSight visualization" translate="no">​</a></h4>
<p>Below you can find details about the resources created by the CloudFormation template and their purpose.</p>
<p><a href="https://github.com/aws-samples/cloud-operations-best-practices/blob/main/cloud-operations-best-practices/static/cfn-templates/patch-reporting/quicksight.yaml" target="_blank" rel="noopener noreferrer" class="">Sample CloudFormation template for Amazon QuickSight visualization</a></p>
<table><thead><tr><th>Resource Name</th><th>Purpose</th></tr></thead><tbody><tr><td>SSMDataSyncSource</td><td>QuickSight data source pointing to the Athena workgroup, patch-workgroup.</td></tr><tr><td>ApplicationDataSet</td><td>QuickSight dataset for the application metadata</td></tr><tr><td>ComplianceItemDataSet</td><td>QuickSight dataset for the compliance item metadata</td></tr><tr><td>ComplianceSummaryDataSet</td><td>QuickSight dataset for the compliance summary metadata</td></tr><tr><td>InstanceDetailedInformationDataSet</td><td>QuickSight dataset for the instance detailed information metadata</td></tr><tr><td>InstanceInformationDataSet</td><td>QuickSight dataset for the instance information metadata</td></tr><tr><td>TagDataSet</td><td>QuickSight dataset for the tag metadata</td></tr><tr><td>JoinedDataSet</td><td>QuickSight dataset which joins aws_instanceinformation, aws_compliancesummary, aws_tag</td></tr><tr><td>ManagedNodeAnalysis</td><td>QuickSight analysis dashboard</td></tr></tbody></table>
<div class="theme-admonition theme-admonition-tip admonition_xJq3 alert alert--success"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>tip</div><div class="admonitionContent_BuS1"><p>The sample CloudFormation template uses the <code>DIRECT_QUERY</code> method which allows near real-time querying of the data source. An alternative is to use SPICE to cache the data in QuickSight. If you use SPICE, the sample template also includes example refresh schedules on lines 551-647. For more information on which mode to use, see <a href="https://aws.amazon.com/blogs/business-intelligence/best-practices-for-amazon-quicksight-spice-and-direct-query-mode/" target="_blank" rel="noopener noreferrer" class="">Best practices for Amazon QuickSight SPICE and direct query mode</a></p></div></div>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="prerequisites-to-complete-before-deploying-the-cloudformation-template-for-quicksight">Prerequisites to complete before deploying the CloudFormation template for QuickSight<a href="#prerequisites-to-complete-before-deploying-the-cloudformation-template-for-quicksight" class="hash-link" aria-label="Direct link to Prerequisites to complete before deploying the CloudFormation template for QuickSight" title="Direct link to Prerequisites to complete before deploying the CloudFormation template for QuickSight" translate="no">​</a></h4>
<p>In order for QuickSight to access the patch compliance and inventory metadata, you must grant access to QuickSight for the S3 buckets created in <a href="#deploy-a-cloudformation-stack-for-athena-in-the-central-reporting-account" class="">Deploy a CloudFormation stack for Athena in the central reporting account</a>: <code>ssm-res-sync-athena-query-results-us-east-1-$AccountId</code> and <code>ssm-resource-sync-us-east-1-$AccountId</code>.</p>
<p><img decoding="async" loading="lazy" alt="QuickSight permissions to S3 buckets" src="/cloud-operations-best-practices/assets/images/quicksight-athena-resources-476a4f1e5f60510cb2f334f1829f6b04.png" title="QuickSight permissions to S3 buckets" width="853" height="723" class="img_ev3q"></p>
<p>For more information on how to grant access, see<a href="https://docs.aws.amazon.com/quicksight/latest/user/troubleshoot-connect-S3.html" target="_blank" rel="noopener noreferrer" class="">I can&#x27;t connect to Amazon S3</a>.</p>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="deploy-a-cloudformation-stack-for-quicksight-in-the-central-reporting-account">Deploy a CloudFormation stack for QuickSight in the central reporting account<a href="#deploy-a-cloudformation-stack-for-quicksight-in-the-central-reporting-account" class="hash-link" aria-label="Direct link to Deploy a CloudFormation stack for QuickSight in the central reporting account" title="Direct link to Deploy a CloudFormation stack for QuickSight in the central reporting account" translate="no">​</a></h4>
<ol>
<li class="">Download the <a href="https://github.com/aws-samples/cloud-operations-best-practices/blob/main/cloud-operations-best-practices/static/cfn-templates/patch-reporting/quicksight.yaml" target="_blank" rel="noopener noreferrer" class="">Sample CloudFormation template for Amazon QuickSight visualization</a> to your local machine.</li>
<li class="">In the central reporting account and Region, navigate to the <a href="https://console.aws.amazon.com/cloudformation/home" target="_blank" rel="noopener noreferrer" class="">AWS CloudFormation console</a>.</li>
<li class="">In left navigation pane, choose <strong>Stacks</strong>, and then choose <strong>Create stack</strong>.</li>
<li class="">From the dropdown list, choose <strong>With new resources (standard)</strong>.</li>
<li class="">On the <strong>Create stack</strong> page, select <strong>Upload a template file</strong>, select <strong>Choose file</strong>, choose the <code>quicksight.yaml</code> file, and then choose <strong>Next</strong>.</li>
<li class="">On the <strong>Specify stack details</strong> page, perform the following steps:<!-- -->
<ol>
<li class="">For <strong>Stack name</strong>, enter a descriptive name, such as <code>quicksight</code>.</li>
<li class="">For <strong>QuickSightUser</strong>, enter the name of the QuickSight user to be granted permissions to the QuickSight data sources and analysis dashboard.</li>
<li class="">For <strong>Workgroup</strong>, leave the default value <code>patch-workgroup</code>.</li>
<li class="">Choose <strong>Next</strong>.</li>
</ol>
</li>
<li class="">On the <strong>Configure stack options</strong> page, add any required tags, and then choose <strong>Next</strong>.</li>
<li class="">On the <strong>Review and create</strong> page, review all the information and then choose <strong>Submit</strong> to create your stack.</li>
</ol>
<p>After the page is refreshed, the status of your stack should be <code>CREATE_IN_PROGRESS</code>. When the status changes to <code>CREATE_COMPLETE</code>, deploy resource data syncs into the member account(s)/region(s).</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="phase-2-member-account-configuration">Phase 2: Member account configuration<a href="#phase-2-member-account-configuration" class="hash-link" aria-label="Direct link to Phase 2: Member account configuration" title="Direct link to Phase 2: Member account configuration" translate="no">​</a></h3>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="sample-cloudformation-template-for-organization-resource-data-sync">Sample CloudFormation template for organization resource data sync<a href="#sample-cloudformation-template-for-organization-resource-data-sync" class="hash-link" aria-label="Direct link to Sample CloudFormation template for organization resource data sync" title="Direct link to Sample CloudFormation template for organization resource data sync" translate="no">​</a></h4>
<p>Below you can find details about the resources created by the CloudFormation template and their purpose.</p>
<p><a href="https://github.com/aws-samples/cloud-operations-best-practices/blob/main/cloud-operations-best-practices/static/cfn-templates/patch-reporting/organization-resource-data-sync.yaml" target="_blank" rel="noopener noreferrer" class="">Sample CloudFormation template for organization resource data sync</a></p>
<table><thead><tr><th>Resource Name</th><th>Purpose</th></tr></thead><tbody><tr><td><strong>Resource data sync resources</strong></td><td></td></tr><tr><td>ResourceDataSyncLambdaRole</td><td>IAM service role for Lambda to create organization resource data sync</td></tr><tr><td>ResourceDataSyncLambdaFunction</td><td>Lambda function to create organization resource data sync</td></tr><tr><td>ResourceDataSyncCustomResource</td><td>CFN custom resource to invoke the Lambda function</td></tr></tbody></table>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="deploy-a-cloudformation-stackset">Deploy a CloudFormation StackSet<a href="#deploy-a-cloudformation-stackset" class="hash-link" aria-label="Direct link to Deploy a CloudFormation StackSet" title="Direct link to Deploy a CloudFormation StackSet" translate="no">​</a></h4>
<p>The following walkthrough will use a delegated administrator account for CloudFormation to deploy a StackSet with <a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/stacksets-orgs-associate-stackset-with-org.html" target="_blank" rel="noopener noreferrer" class="">service-managed permissions</a> to deploy the AWS Organization compatible resource data sync.</p>
<ol>
<li class="">Download the <a href="https://github.com/aws-samples/cloud-operations-best-practices/blob/main/cloud-operations-best-practices/static/cfn-templates/patch-reporting/organizational-resource-data-sync.yaml" target="_blank" rel="noopener noreferrer" class="">Sample CloudFormation template for organizational resource data syncs</a> to your local machine.</li>
<li class="">In the delegated administrator account for CloudFormation, navigate to the <a href="https://console.aws.amazon.com/cloudformation/home" target="_blank" rel="noopener noreferrer" class="">AWS CloudFormation console</a>.</li>
<li class="">In left navigation pane, choose <strong>StackSets</strong>, and then choose <strong>Create StackSet</strong>.</li>
<li class="">On the <strong>Choose a template</strong> page, perform the following steps:<!-- -->
<ol>
<li class="">For <strong>Permission model</strong>, leave the default option selected, <strong>Service-managed permissions</strong>.</li>
<li class="">For <strong>Prerequisite - Prepare template</strong>, leave the default option selected, <strong>Template is ready</strong>.</li>
<li class="">For <strong>Specify template</strong>, choose <strong>Upload a template file</strong>, select <strong>Choose file</strong>, choose the <code>organization-resource-data-sync.yaml</code> file, and then choose <strong>Next</strong>.</li>
</ol>
</li>
<li class="">On the <strong>Specify StackSet details</strong> page, perform the following steps:<!-- -->
<ol>
<li class="">For <strong>StackSet name</strong>, enter a descriptive name, such as <code>org-resource-data-sync</code>.</li>
<li class="">For <strong>Name of the resource data sync S3 bucket</strong>, enter the name of the S3 bucket you created in the previous section.</li>
</ol>
<div class="theme-admonition theme-admonition-tip admonition_xJq3 alert alert--success"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>tip</div><div class="admonitionContent_BuS1"><p>In the central reporting account, you can find the S3 bucket name in the <strong>Outputs</strong> of the CloudFormation stack provisioned.
<img decoding="async" loading="lazy" alt="Outputs of the CloudFormation stack to show the resource data sync S3 bucket name" src="/cloud-operations-best-practices/assets/images/patch-reporting-cfn-outputs-44a39e0095dd1cf9be2dac81674e8533.png" title="Outputs of the CloudFormation stack to show the resource data sync S3 bucket name" width="989" height="553" class="img_ev3q"></p></div></div>
<ol>
<li class="">For <strong>Prefix for the resource data sync S3 bucket</strong>, enter a name for the prefix used for the S3 bucket, such as <code>ResourceDataSync</code>.</li>
<li class="">For <strong>AWS Region for the resource data sync S3 bucket</strong>, enter the Region for the resource data sync S3 bucket.</li>
<li class="">For <strong>Name of the resource data sync</strong>, enter the name for the resource data sync.</li>
<li class="">Choose <strong>Next</strong>.</li>
</ol>
</li>
<li class="">On the <strong>Configure StackSet options</strong> page, add any required tags, select <strong>I acknowledge that AWS CloudFormation might create IAM resources</strong>, and then choose <strong>Next</strong>.</li>
<li class="">On the <strong>Set deployment options</strong> page, perform the following steps:<!-- -->
<ol>
<li class="">For <strong>Deployment targets</strong>, choose to deploy to the organization or to specific organization units (OUs).</li>
</ol>
<div class="theme-admonition theme-admonition-tip admonition_xJq3 alert alert--success"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>tip</div><div class="admonitionContent_BuS1"><p>It is recommended to deploy resource data syncs to all accounts and Regions where you have nodes managed by AWS Systems Manager to ensure all available inventory and patch metadata is aggregated into a single S3 bucket for querying, reporting, and visualization.</p></div></div>
<ol>
<li class="">For <strong>Specify Regions</strong>, select the Regions where you want to deploy the resource data sync.</li>
<li class="">Leave all other options as their defaults and choose <strong>Next</strong>.</li>
</ol>
</li>
<li class="">On the <strong>Review</strong> page, review all the information, and then choose <strong>Submit</strong> to create your StackSet.</li>
</ol>
<p>After the page is refreshed, you will be able to see your StackSet. The status will change to <code>SUCCEEDED</code> after it’s been created.</p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="phase-3-verification-and-testing">Phase 3: Verification and Testing<a href="#phase-3-verification-and-testing" class="hash-link" aria-label="Direct link to Phase 3: Verification and Testing" title="Direct link to Phase 3: Verification and Testing" translate="no">​</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="verify-metadata-in-resource-data-sync-s3-bucket">Verify metadata in resource data sync S3 bucket<a href="#verify-metadata-in-resource-data-sync-s3-bucket" class="hash-link" aria-label="Direct link to Verify metadata in resource data sync S3 bucket" title="Direct link to Verify metadata in resource data sync S3 bucket" translate="no">​</a></h3>
<p>In the central reporting account, navigate to the <a href="https://console.aws.amazon.com/s3/home" target="_blank" rel="noopener noreferrer" class="">Amazon S3 console</a> and select the S3 bucket created by CloudFormation named similarly to <code>ssm-resource-sync-${region}-${account-id}</code>. In the S3 bucket, select the bucket prefix you provided when <a href="#deploy-a-cloudformation-stackset" class="">deploying the CloudFormation StackSet</a>.</p>
<p>In the bucket, you can see the various data types that are synchronized by the resource data sync automatically. If you have previously configured Inventory metadata gathering and performed at least a patch scan operation, you should see additional folders (e.g. <code>AWS:Application</code>, <code>AWS:AWSComponent</code>) in the S3 bucket. Each folder represents <a href="https://docs.aws.amazon.com/systems-manager/latest/userguide/inventory-schema.html" target="_blank" rel="noopener noreferrer" class="">metadata collected by Inventory</a>.</p>
<p><img decoding="async" loading="lazy" alt="S3 bucket folders for resource data sync metadata" src="/cloud-operations-best-practices/assets/images/s3-bucket-objects-f99b5ab3af86bc05a2029dbfd0626f1f.png" title="S3 bucket folders for resource data sync metadata" width="1446" height="757" class="img_ev3q"></p>
<p>Within each of the data type prefixes, there will be a prefix for each account that is using resource data sync with this S3 bucket. This is followed by a prefix for each Region that is reporting inventory, and then a prefix for the resource type, which will generally be <code>ManagedInstanceInventory</code>. Then within that prefix, there will be a JSON file for each instance that reports Inventory data.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="verify-access-to-quicksight-analysis">Verify access to QuickSight analysis<a href="#verify-access-to-quicksight-analysis" class="hash-link" aria-label="Direct link to Verify access to QuickSight analysis" title="Direct link to Verify access to QuickSight analysis" translate="no">​</a></h3>
<p>Verify you have access to the QuickSight Analysis dashboard created by CloudFormation by navigating to the <a href="https://quicksight.aws.amazon.com/sn/start/analyses" target="_blank" rel="noopener noreferrer" class="">QuickSight console</a>.</p>
<p>If you do not see the analysis named <strong>Managed Node Analysis CFN</strong>, ensure you are logged into QuickSight as the same user you specified in the CloudFormation parameter <code>QuickSightUser</code>. You can verify the user you are logged into QuickSight with by selecting your profile in the upper-right corner.</p>
<p><img decoding="async" loading="lazy" alt="QuickSight analysis created by CloudFormation" src="/cloud-operations-best-practices/assets/images/quicksight-analysis-d20d97c415de098503c4b740da1be6ee.png" title="QuickSight analysis created by CloudFormation" width="1470" height="618" class="img_ev3q"></p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="query-patch-compliance">Query patch compliance<a href="#query-patch-compliance" class="hash-link" aria-label="Direct link to Query patch compliance" title="Direct link to Query patch compliance" translate="no">​</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="review-the-glue-crawler">Review the Glue crawler<a href="#review-the-glue-crawler" class="hash-link" aria-label="Direct link to Review the Glue crawler" title="Direct link to Review the Glue crawler" translate="no">​</a></h3>
<p>Now that resource data sync has synchronized Systems Manager data to the S3 bucket, we can use a Glue crawler to create tables from the JSON files. The Glue crawler is configured to run once a day at 00:00 UTC. You can either wait for the Glue crawler to run or you can manually run the crawler and generate tables to query in Athena.</p>
<ol>
<li class="">Open the <a href="https://console.aws.amazon.com/glue/home/v2/home" target="_blank" rel="noopener noreferrer" class="">AWS Glue console</a> and in the navigation pane, choose <strong>Crawlers</strong> under the <strong>Data Catalog</strong> header.</li>
<li class="">Select the <strong>SSM-GlueCrawler</strong> and choose <strong>Run</strong>.</li>
</ol>
<p>The Crawler should run for approximately 2-4 minutes before stopping. Once the Crawler has returned to the Ready state, verify that tables were added to the resulting database by choosing <strong>Tables</strong> in the navigation pane.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="query-using-athena">Query using Athena<a href="#query-using-athena" class="hash-link" aria-label="Direct link to Query using Athena" title="Direct link to Query using Athena" translate="no">​</a></h3>
<ol>
<li class="">Log in to the <a href="#central-reporting-account" class="">central reporting AWS account</a> where you deployed the KMS, S3, Glue, and Athena resources.</li>
<li class="">Open the <a href="https://console.aws.amazon.com/athena/home" target="_blank" rel="noopener noreferrer" class="">Amazon Athena console</a> and in the navigation pane, choose <strong>Query editor</strong>.</li>
<li class="">In the upper-right corner, for <strong>Workgroup</strong>, choose <strong>patch-workgroup</strong>.</li>
<li class="">For <strong>Workgroup patch-workgroup settings</strong>, choose <strong>Acknowledge</strong>.</li>
<li class="">Choose the <strong>Saved queries</strong> tab to see the sample queries.</li>
<li class="">Select a saved query, such as <strong>QueryNonCompliantPatch</strong>, and choose <strong>Run</strong>.</li>
<li class="">Validate query results are returned for managed nodes that are missing updates and are non-compliant.</li>
</ol>
<p><img decoding="async" loading="lazy" alt="Athena query results for QueryNonCompliantPatch" src="/cloud-operations-best-practices/assets/images/athena-query-results-552cd3422cb43bd6619846eca565ac1f.png" title="Athena query results for QueryNonCompliantPatch" width="1439" height="1027" class="img_ev3q"></p>
<div class="theme-admonition theme-admonition-warning admonition_xJq3 alert alert--warning"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>warning</div><div class="admonitionContent_BuS1"><p>In order to use the <strong>Saved queries</strong> named <strong>QuerySSMAgentVersion</strong> and <strong>QueryInstanceApplications</strong>, you must enable <a href="https://docs.aws.amazon.com/systems-manager/latest/userguide/systems-manager-inventory.html" target="_blank" rel="noopener noreferrer" class="">Systems Manager Inventory</a>. You can quickly enable Systems Manager Inventory when onboarding to the <a href="https://docs.aws.amazon.com/systems-manager/latest/userguide/systems-manager-setting-up-organizations.html" target="_blank" rel="noopener noreferrer" class="">Systems Manager unified console</a>.</p></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="additional-athena-sample-queries">Additional Athena sample queries<a href="#additional-athena-sample-queries" class="hash-link" aria-label="Direct link to Additional Athena sample queries" title="Direct link to Additional Athena sample queries" translate="no">​</a></h3>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="group-updates-for-non-compliant-managed-nodes">Group updates for non-compliant managed nodes<a href="#group-updates-for-non-compliant-managed-nodes" class="hash-link" aria-label="Direct link to Group updates for non-compliant managed nodes" title="Direct link to Group updates for non-compliant managed nodes" translate="no">​</a></h4>
<p>The following example Athena query groups non-compliant updates by managed node.</p>
<div class="theme-tabs-container tabs-container tabList__CuJ"><ul role="tablist" aria-orientation="horizontal" class="tabs"><li role="tab" tabindex="0" aria-selected="true" class="tabs__item tabItem_LNqP tabs__item--active">Query</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_LNqP">Results</li></ul><div class="margin-top--md"><div role="tabpanel" class="tabItem_Ymn6"><div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">-- Query to aggregate non-compliant patch compliance items by resource (limited to 20 results)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">SELECT</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ci</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">resourceid</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ci</span><span class="token punctuation" style="color:#393A34">.</span><span class="token keyword" style="color:#00009f">status</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ci</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">patchstate</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    LISTAGG</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">DISTINCT</span><span class="token plain"> ci</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">id</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;, &#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">WITHIN</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">GROUP</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">ORDER</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">BY</span><span class="token plain"> ci</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">id</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">AS</span><span class="token plain"> ids</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">FROM</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    aws_complianceitem ci</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">WHERE</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ci</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">compliancetype </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;Patch&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token operator" style="color:#393A34">AND</span><span class="token plain"> ci</span><span class="token punctuation" style="color:#393A34">.</span><span class="token keyword" style="color:#00009f">status</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;NON_COMPLIANT&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">GROUP</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">BY</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ci</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">resourceid</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ci</span><span class="token punctuation" style="color:#393A34">.</span><span class="token keyword" style="color:#00009f">status</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ci</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">patchstate</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">ORDER</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">BY</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ci</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">resourceid</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">LIMIT</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">20</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre></div></div></div><div role="tabpanel" class="tabItem_Ymn6" hidden=""><p><img decoding="async" loading="lazy" alt="Example query results when grouping updates per managed node" src="/cloud-operations-best-practices/assets/images/group-updates-per-node-58df66db686e2c0c60ade2016cdc1cd4.png" title="Example query results when grouping updates per managed node" width="1382" height="1019" class="img_ev3q"></p></div></div></div>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="filter-out-non-active-managed-nodes">Filter out non-active managed nodes<a href="#filter-out-non-active-managed-nodes" class="hash-link" aria-label="Direct link to Filter out non-active managed nodes" title="Direct link to Filter out non-active managed nodes" translate="no">​</a></h4>
<p>Resource data syncs send inventory and patch compliance metadata to S3 buckets. When a managed EC2 instance is stopped or terminated, the <code>AWS:InstanceInformation</code> metadata is updated to reflect the new state. For hybrid managed nodes, this status is updated based on the connectivity state of SSM agent. These values are indicated in the <code>InstanceStatus</code> key which can have the following values:</p>
<ul>
<li class=""><code>Active</code> - SSM agent (on the EC2 or hybrid managed node) is actively running and communicating with AWS Systems Manager.</li>
<li class=""><code>Stopped</code> - The EC2 instance is in a <code>Stopped</code> state.</li>
<li class=""><code>Terminated</code> - The EC2 instance has been terminated (deleted).</li>
<li class=""><code>ConnectionLost</code> - SSM agent on the hybrid managed node is not able to communicate with AWS Systems Manager.</li>
</ul>
<div class="theme-admonition theme-admonition-tip admonition_xJq3 alert alert--success"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>tip</div><div class="admonitionContent_BuS1"><p>Resource data syncs do not remove JSON files from the specified S3 bucket. To automatically clean-up managed node metadata JSON files for terminated EC2 instances or deregistered hybrid managed nodes, you can use <a href="https://docs.aws.amazon.com/AmazonS3/latest/userguide/object-lifecycle-mgmt.html" target="_blank" rel="noopener noreferrer" class="">S3 lifecycle policies</a> to automatically delete objects. For example, you may implement a S3 bucket policy that expires stale objects that have not been updated for 60 days. The sample CloudFormation template in the section, <a href="#sample-cloudformation-template-for-organization-resource-data-sync" class="">Sample CloudFormation template for organization resource data sync</a>, includes a commented-out <code>LifecycleConfiguration</code> starting at line 154.</p></div></div>
<p>You can use <code>InstanceStatus</code> to filter out stopped or terminated instances or hybrid managed nodes in a connection lost state in your Athena queries. For example, the following query returns <code>AWS:InstanceInformation</code> metadata for only <code>Active</code> managed nodes.</p>
<!-- -->
<div class="theme-tabs-container tabs-container tabList__CuJ"><ul role="tablist" aria-orientation="horizontal" class="tabs"><li role="tab" tabindex="0" aria-selected="true" class="tabs__item tabItem_LNqP tabs__item--active">Query</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_LNqP">Results</li></ul><div class="margin-top--md"><div role="tabpanel" class="tabItem_Ymn6"><div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">-- Query to return only Active managed nodes</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">SELECT</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ii</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">accountid</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ii</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">region</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ii</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">resourceid</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ii</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">computername</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ii</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">ipaddress</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ii</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">instancestatus</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ii</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">platformtype</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ii</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">platformname</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ii</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">platformversion</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ii</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">agenttype</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ii</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">agentversion</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ii</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">capturetime</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">FROM</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    aws_instanceinformation ii</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">WHERE</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ii</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">instancestatus </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;Active&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">LIMIT</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">20</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre></div></div></div><div role="tabpanel" class="tabItem_Ymn6" hidden=""><p><img decoding="async" loading="lazy" alt="Example query results to return only active managed nodes" src="/cloud-operations-best-practices/assets/images/active-instance-query-results-7feaed48ed267ba4091cbb72bce573eb.png" title="Example query results to return only active managed nodes" width="1382" height="1021" class="img_ev3q"></p></div></div></div>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="visualize-patch-compliance-using-quicksight">Visualize patch compliance using QuickSight<a href="#visualize-patch-compliance-using-quicksight" class="hash-link" aria-label="Direct link to Visualize patch compliance using QuickSight" title="Direct link to Visualize patch compliance using QuickSight" translate="no">​</a></h2>
<p>The CloudFormation stack deployed in <a href="#deploy-a-cloudformation-stack-for-quicksight-in-the-central-reporting-account" class="">Deploy a CloudFormation stack for QuickSight in the central reporting account</a>, created QuickSight datasets and an empty analysis dashboard so you can begin visualizing patch compliance and inventory metadata.</p>
<p>To create QuickSight visuals, follow the procedures in the two topics listed below:</p>
<ol>
<li class=""><a href="https://catalog.workshops.aws/getting-started-with-com/en-US/advanced-workshops/organization-patch-reporting/create-quicksight-visuals-and-dashboard" target="_blank" rel="noopener noreferrer" class="">Part 1: Create QuickSight visuals based on metadata for managed nodes</a></li>
<li class=""><a href="https://catalog.workshops.aws/getting-started-with-com/en-US/advanced-workshops/organization-patch-reporting/create-quicksight-visuals-for-patch-compliance" target="_blank" rel="noopener noreferrer" class="">Part 2: Create AWS QuickSight Visuals for information on Patch Compliance</a></li>
</ol>
<p>By following the two topics above, you can create a QuickSight dashboard with two sheets that look similar to this:</p>
<div class="theme-tabs-container tabs-container tabList__CuJ"><ul role="tablist" aria-orientation="horizontal" class="tabs"><li role="tab" tabindex="0" aria-selected="true" class="tabs__item tabItem_LNqP tabs__item--active">Instance information</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_LNqP">Patch compliance</li></ul><div class="margin-top--md"><div role="tabpanel" class="tabItem_Ymn6"><p><img decoding="async" loading="lazy" alt="Example QuickSight dashboard for instance information" src="/cloud-operations-best-practices/assets/images/example-instance-information-dashboard-83121d587695fd79923d6bdba3fd0b1d.png" title="Example QuickSight dashboard for instance information" width="1705" height="2502" class="img_ev3q"></p></div><div role="tabpanel" class="tabItem_Ymn6" hidden=""><p><img decoding="async" loading="lazy" alt="Example QuickSight dashboard for patch compliance" src="/cloud-operations-best-practices/assets/images/example-patch-compliance-dashboard-55e972c6192d6c6b0acd7cced185d14d.png" title="Example QuickSight dashboard for patch compliance" width="1718" height="2644" class="img_ev3q"></p></div></div></div>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="clean-up-deployed-resources">Clean-up deployed resources<a href="#clean-up-deployed-resources" class="hash-link" aria-label="Direct link to Clean-up deployed resources" title="Direct link to Clean-up deployed resources" translate="no">​</a></h2>
<div class="theme-admonition theme-admonition-warning admonition_xJq3 alert alert--warning"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>warning</div><div class="admonitionContent_BuS1"><p>The sample CloudFormation templates in this recipe delete the contents of the S3 buckets upon deleting the CloudFormation stack for the central reporting account.</p></div></div>
<p>To clean-up the sample resources created in <a href="#phase-2-member-account-configuration" class="">Phase 2: Member account configuration</a>, you must first <a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/stackinstances-delete.html" target="_blank" rel="noopener noreferrer" class="">delete the stack instances in your StackSet</a> and then <a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/stacksets-delete.html" target="_blank" rel="noopener noreferrer" class="">delete the StackSet</a>.</p>
<p>To clean-up the sample resources created in <a href="#phase-1-central-account-setup" class="">Phase 1: Central account setup</a>, perform the following steps:</p>
<ol>
<li class="">Delete the resources in the stack, <code>quicksight</code>, deployed in the section <a href="#deploy-a-cloudformation-stack-for-athena-in-the-central-reporting-account" class="">Deploy a CloudFormation stack for QuickSight in the central reporting account</a>.</li>
<li class="">Delete the resources in the stack, <code>patch-reporting</code>, deployed in the section <a href="#deploy-a-cloudformation-stack-for-athena-in-the-central-reporting-account" class="">Deploy a CloudFormation stack for Athena in the central reporting account</a>.</li>
</ol>
<p>For information on how to delete CloudFormation stacks, see <a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/cfn-console-delete-stack.html" target="_blank" rel="noopener noreferrer" class="">Delete a stack from the CloudFormation console</a>.</p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="next-steps">Next steps<a href="#next-steps" class="hash-link" aria-label="Direct link to Next steps" title="Direct link to Next steps" translate="no">​</a></h2>
<p>Below you will find a series of related AWS blogs which can be used as a reference to improve your patch operations and reporting mechanisms.</p>
<ul>
<li class=""><a href="https://aws.amazon.com/blogs/mt/automate-systems-manager-patching-reports-via-email-and-slack-notifications-in-an-aws-organization/" target="_blank" rel="noopener noreferrer" class="">Automate Systems Manager patching reports via email and Slack notifications in an AWS Organization</a>
<ul>
<li class=""><em>In this blog post, we’ll explore how to automate the creation and delivery of patching reports, streamlining the process of tracking patching operations. By leveraging AWS services such as AWS Lambda, Amazon EventBridge, AWS Step Functions, and Amazon DynamoDB, you can consolidate Systems Manager Patch Manager execution details from multiple accounts, generate comprehensive reports, and distribute them via email and Slack notifications, empowering your team with the insights needed to maintain a secure and compliant infrastructure.</em></li>
</ul>
</li>
<li class=""><a href="https://aws.amazon.com/blogs/mt/troubleshooting-aws-systems-manager-patching-made-easy-with-amazon-bedrocks-automated-recommendations/" target="_blank" rel="noopener noreferrer" class="">Troubleshooting AWS Systems Manager patching made easy with Amazon Bedrock’s automated recommendations</a>
<ul>
<li class=""><em>In this post, we’ll explore how Amazon Bedrock can simplify the troubleshooting process for Systems Manager patching failures. Bedrock’s automated analysis and recommendation capabilities can help you quickly identify the root causes of patching problems and implement the right solutions, saving you valuable time and effort.</em></li>
</ul>
</li>
<li class=""><a href="https://aws.amazon.com/blogs/mt/visualize-aws-systems-manager-patch-manager-information-using-amazon-quicksight/" target="_blank" rel="noopener noreferrer" class="">Visualize AWS Systems Manager Patch Manager information using Amazon QuickSight</a>
<ul>
<li class=""><em>In this blog post, learn how to build an Amazon QuickSight dashboard to visualize critical patch and inventory information to speed up MTTR. Also, you can use filters to search for a specific AWS Account, specific AWS Region, Amazon Elastic Compute Cloud (Amazon EC2) name, or check installed/missed packages.</em></li>
</ul>
</li>
<li class=""><a href="https://aws.amazon.com/blogs/mt/automate-vulnerability-management-and-remediation-in-aws-using-amazon-inspector-and-aws-systems-manager-part-1/" target="_blank" rel="noopener noreferrer" class="">Automate vulnerability management and remediation in AWS using Amazon Inspector and AWS Systems Manager – Part 1</a>
<ul>
<li class=""><em>In Part 1 of this series, you’ll learn how to remediate Inspector findings for a specific vulnerability affecting multiple EC2 instances. In Part 2, you&#x27;ll learn how to directly invoke the Systems Manager Automation runbook to remediate all Amazon Inspector findings for EC2 instances using resource tags and Amazon Inspector finding severity.</em></li>
</ul>
</li>
</ul>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="technical-terminology-glossary">Technical terminology glossary<a href="#technical-terminology-glossary" class="hash-link" aria-label="Direct link to Technical terminology glossary" title="Direct link to Technical terminology glossary" translate="no">​</a></h2>
<table><thead><tr><th>Term</th><th>Definition</th></tr></thead><tbody><tr><td>AWS Glue Crawler</td><td>A service that automatically discovers and catalogs metadata from data sources, creating tables in the AWS Glue Data Catalog.</td></tr><tr><td>AWS Organizations</td><td>A service for centrally managing and governing multiple AWS accounts as a single organization.</td></tr><tr><td>Custom Resource</td><td>A CloudFormation resource type that enables you to write custom provisioning logic in templates.</td></tr><tr><td>Delegated Administrator</td><td>An AWS account that has been granted permissions to administer certain AWS services on behalf of an AWS organization.</td></tr><tr><td>Managed Node</td><td>Any server (EC2 instance or VM on-premises or in other clouds) that is configured for management by AWS Systems Manager. Requires the SSM Agent to be installed and properly configured.</td></tr><tr><td>Patch Baseline</td><td>A set of rules that define which patches should be installed on your managed nodes, including approval rules for different severity levels.</td></tr><tr><td>Patch Compliance</td><td>The state of a managed node regarding required patches. A node is compliant when all required patches are installed according to the associated patch baseline.</td></tr><tr><td>Patch Group</td><td>A tag-based grouping mechanism that associates managed nodes with specific patch baselines.</td></tr><tr><td>Resource Data Sync</td><td>A Systems Manager feature that automatically aggregates inventory data from managed nodes to a central S3 bucket, enabling consolidated reporting.</td></tr><tr><td>Service-Managed Permissions</td><td>A StackSet permission model that uses AWS Organizations to deploy stack instances to accounts in your organization.</td></tr><tr><td>SSM Agent</td><td>AWS software installed on managed nodes that enables Systems Manager to update, manage, and configure these resources.</td></tr><tr><td>StackSet</td><td>A CloudFormation feature that lets you create, update, or delete stacks across multiple accounts and regions with a single operation.</td></tr></tbody></table></div></article><nav class="docusaurus-mt-lg pagination-nav" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/cloud-operations-best-practices/docs/recipes/centralized-operations-management/just-in-time-node-access/policy-examples"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">JITNA Cedar policy examples</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/cloud-operations-best-practices/docs/recipes/centralized-operations-management/pwsh-run-command-custom-credentials/"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Invoking PowerShell commands as a custom Windows user in Systems Manager Run Command</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#what-is-patch-compliance" class="table-of-contents__link toc-highlight">What is patch compliance?</a></li><li><a href="#purpose" class="table-of-contents__link toc-highlight">Purpose</a></li><li><a href="#prerequisites" class="table-of-contents__link toc-highlight">Prerequisites</a></li><li><a href="#considerations" class="table-of-contents__link toc-highlight">Considerations</a><ul><li><a href="#resource-data-sync" class="table-of-contents__link toc-highlight">Resource data sync</a></li><li><a href="#cost-considerations" class="table-of-contents__link toc-highlight">Cost considerations</a></li></ul></li><li><a href="#architecture-overview" class="table-of-contents__link toc-highlight">Architecture overview</a><ul><li><a href="#central-reporting-account" class="table-of-contents__link toc-highlight">Central reporting account</a></li><li><a href="#member-accountsregions-with-managed-nodes" class="table-of-contents__link toc-highlight">Member account(s)/Region(s) with managed nodes</a></li><li><a href="#process-timeline" class="table-of-contents__link toc-highlight">Process timeline</a></li></ul></li><li><a href="#deployment-steps" class="table-of-contents__link toc-highlight">Deployment steps</a><ul><li><a href="#deployment-checklist" class="table-of-contents__link toc-highlight">Deployment checklist</a></li><li><a href="#phase-1-central-account-setup" class="table-of-contents__link toc-highlight">Phase 1: Central account setup</a></li><li><a href="#phase-2-member-account-configuration" class="table-of-contents__link toc-highlight">Phase 2: Member account configuration</a></li></ul></li><li><a href="#phase-3-verification-and-testing" class="table-of-contents__link toc-highlight">Phase 3: Verification and Testing</a><ul><li><a href="#verify-metadata-in-resource-data-sync-s3-bucket" class="table-of-contents__link toc-highlight">Verify metadata in resource data sync S3 bucket</a></li><li><a href="#verify-access-to-quicksight-analysis" class="table-of-contents__link toc-highlight">Verify access to QuickSight analysis</a></li></ul></li><li><a href="#query-patch-compliance" class="table-of-contents__link toc-highlight">Query patch compliance</a><ul><li><a href="#review-the-glue-crawler" class="table-of-contents__link toc-highlight">Review the Glue crawler</a></li><li><a href="#query-using-athena" class="table-of-contents__link toc-highlight">Query using Athena</a></li><li><a href="#additional-athena-sample-queries" class="table-of-contents__link toc-highlight">Additional Athena sample queries</a></li></ul></li><li><a href="#visualize-patch-compliance-using-quicksight" class="table-of-contents__link toc-highlight">Visualize patch compliance using QuickSight</a></li><li><a href="#clean-up-deployed-resources" class="table-of-contents__link toc-highlight">Clean-up deployed resources</a></li><li><a href="#next-steps" class="table-of-contents__link toc-highlight">Next steps</a></li><li><a href="#technical-terminology-glossary" class="table-of-contents__link toc-highlight">Technical terminology glossary</a></li></ul></div></div></div></div></main></div></div></div><footer class="theme-layout-footer footer footer--dark"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="footer__copyright">Built with ❤️ at AWS. <br> © 2025.  Amazon.com, Inc. or its affiliates. All Rights Reserved.</div></div></div></footer></div>
</body>
</html>