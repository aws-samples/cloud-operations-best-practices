<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-guides/AWS CloudTrail/CloudTrail Network Activity Events/index" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.8.1">
<title data-rh="true">CloudTrail Network Activity Events | AWS Cloud Operations Best Practices</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://aws-samples.github.io/cloud-operations-best-practices/docs/guides/AWS CloudTrail/CloudTrail Network Activity Events/"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="CloudTrail Network Activity Events | AWS Cloud Operations Best Practices"><meta data-rh="true" name="description" content="With network activity events for VPC endpoints, you can view details of who is accessing resources within your network giving you greater ability to identify and respond to malicious or unauthorized actions in your data perimeter. For example, as the VPC endpoint owner, you can view logs of actions that were denied due to VPC endpoint policies or determine if an actor outside of your data perimeter is trying to access the data in your S3 buckets."><meta data-rh="true" property="og:description" content="With network activity events for VPC endpoints, you can view details of who is accessing resources within your network giving you greater ability to identify and respond to malicious or unauthorized actions in your data perimeter. For example, as the VPC endpoint owner, you can view logs of actions that were denied due to VPC endpoint policies or determine if an actor outside of your data perimeter is trying to access the data in your S3 buckets."><link data-rh="true" rel="icon" href="/cloud-operations-best-practices/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://aws-samples.github.io/cloud-operations-best-practices/docs/guides/AWS CloudTrail/CloudTrail Network Activity Events/"><link data-rh="true" rel="alternate" href="https://aws-samples.github.io/cloud-operations-best-practices/docs/guides/AWS CloudTrail/CloudTrail Network Activity Events/" hreflang="en"><link data-rh="true" rel="alternate" href="https://aws-samples.github.io/cloud-operations-best-practices/docs/guides/AWS CloudTrail/CloudTrail Network Activity Events/" hreflang="x-default"><script data-rh="true" type="application/ld+json">{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Best practices","item":"https://aws-samples.github.io/cloud-operations-best-practices/docs/guides/"},{"@type":"ListItem","position":2,"name":"AWS CloudTrail","item":"https://aws-samples.github.io/cloud-operations-best-practices/docs/guides/AWS CloudTrail/"},{"@type":"ListItem","position":3,"name":"CloudTrail Network Activity Events","item":"https://aws-samples.github.io/cloud-operations-best-practices/docs/guides/AWS CloudTrail/CloudTrail Network Activity Events/"}]}</script><link rel="stylesheet" href="/cloud-operations-best-practices/assets/css/styles.5bee5787.css">
<script src="/cloud-operations-best-practices/assets/js/runtime~main.226a5d90.js" defer="defer"></script>
<script src="/cloud-operations-best-practices/assets/js/main.9f1347cb.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<svg xmlns="http://www.w3.org/2000/svg" style="display: none;"><defs>
<symbol id="theme-svg-external-link" viewBox="0 0 24 24"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></symbol>
</defs></svg>
<script>!function(){var t=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();document.documentElement.setAttribute("data-theme",t||(window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light")),document.documentElement.setAttribute("data-theme-choice",t||"system")}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="theme-layout-navbar navbar navbar--fixed-top"><div class="navbar__inner"><div class="theme-layout-navbar-left navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/cloud-operations-best-practices/"><b class="navbar__title text--truncate">AWS Cloud Operations Best Practices</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/cloud-operations-best-practices/docs/home">Home</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/cloud-operations-best-practices/docs/guides/">Guides</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/cloud-operations-best-practices/docs/solutions/">Solutions</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/cloud-operations-best-practices/docs/recipes/">Recipes</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/cloud-operations-best-practices/docs/faq/">FAQ</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/cloud-operations-best-practices/docs/contributors">Contributors</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/cloud-operations-best-practices/docs/resources/">Resources</a></div><div class="theme-layout-navbar-right navbar__items navbar__items--right"><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link"><svg viewBox="0 0 24 24" width="20" height="20" aria-hidden="true" class="iconLanguage_nlXk"><path fill="currentColor" d="M12.87 15.07l-2.54-2.51.03-.03c1.74-1.94 2.98-4.17 3.71-6.53H17V4h-7V2H8v2H1v1.99h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11.76-2.04zM18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2l-4.5-12zm-2.62 7l1.62-4.33L19.12 17h-3.24z"></path></svg>English</a><ul class="dropdown__menu"><li><a href="/cloud-operations-best-practices/docs/guides/AWS CloudTrail/CloudTrail Network Activity Events/" target="_self" rel="noopener noreferrer" class="dropdown__link dropdown__link--active" lang="en">English</a></li></ul></div><a href="https://github.com/aws-samples/cloud-operations-best-practices" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="system mode" aria-label="Switch between dark and light mode (currently system mode)"><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP systemToggleIcon_QzmC"><path fill="currentColor" d="m12 21c4.971 0 9-4.029 9-9s-4.029-9-9-9-9 4.029-9 9 4.029 9 9 9zm4.95-13.95c1.313 1.313 2.05 3.093 2.05 4.95s-0.738 3.637-2.05 4.95c-1.313 1.313-3.093 2.05-4.95 2.05v-14c1.857 0 3.637 0.737 4.95 2.05z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="theme-layout-main main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/cloud-operations-best-practices/docs/home">What is AWS Cloud Operations</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" href="/cloud-operations-best-practices/docs/guides/">Best practices</a><button aria-label="Collapse sidebar category &#x27;Best practices&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" tabindex="0" href="/cloud-operations-best-practices/docs/guides/AWS CloudTrail/">AWS CloudTrail</a><button aria-label="Collapse sidebar category &#x27;AWS CloudTrail&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/cloud-operations-best-practices/docs/guides/AWS CloudTrail/Operating CloudTrail/">Operating CloudTrail</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/cloud-operations-best-practices/docs/guides/AWS CloudTrail/CloudTrail Trails/">CloudTrail Trails</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/cloud-operations-best-practices/docs/guides/AWS CloudTrail/CloudTrail Lake/">CloudTrail Lake</a><button aria-label="Expand sidebar category &#x27;CloudTrail Lake&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/cloud-operations-best-practices/docs/guides/AWS CloudTrail/CloudTrail-DataEvents/">CloudTrail Data Events</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/cloud-operations-best-practices/docs/guides/AWS CloudTrail/CloudTrail Network Activity Events/">CloudTrail Network Activity Events</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/cloud-operations-best-practices/docs/guides/AWS Config/">AWS Config</a><button aria-label="Expand sidebar category &#x27;AWS Config&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/cloud-operations-best-practices/docs/guides/application-operations/">Application Operations</a><button aria-label="Expand sidebar category &#x27;Application Operations&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/cloud-operations-best-practices/docs/guides/centralized-operations-management/">Centralized Operations Management</a><button aria-label="Expand sidebar category &#x27;Centralized Operations Management&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/cloud-operations-best-practices/docs/solutions/">Solutions</a><button aria-label="Expand sidebar category &#x27;Solutions&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/cloud-operations-best-practices/docs/recipes/">Recipes</a><button aria-label="Expand sidebar category &#x27;Recipes&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/cloud-operations-best-practices/docs/faq/">FAQ</a><button aria-label="Expand sidebar category &#x27;FAQ&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/cloud-operations-best-practices/docs/resources/">Resources</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/cloud-operations-best-practices/docs/contributors">Contributors</a></li></ul></nav><button type="button" title="Collapse sidebar" aria-label="Collapse sidebar" class="button button--secondary button--outline collapseSidebarButton_PEFL"><svg width="20" height="20" aria-hidden="true" class="collapseSidebarButtonIcon_kv0_"><g fill="#7a7a7a"><path d="M9.992 10.023c0 .2-.062.399-.172.547l-4.996 7.492a.982.982 0 01-.828.454H1c-.55 0-1-.453-1-1 0-.2.059-.403.168-.551l4.629-6.942L.168 3.078A.939.939 0 010 2.528c0-.548.45-.997 1-.997h2.996c.352 0 .649.18.828.45L9.82 9.472c.11.148.172.347.172.55zm0 0"></path><path d="M19.98 10.023c0 .2-.058.399-.168.547l-4.996 7.492a.987.987 0 01-.828.454h-3c-.547 0-.996-.453-.996-1 0-.2.059-.403.168-.551l4.625-6.942-4.625-6.945a.939.939 0 01-.168-.55 1 1 0 01.996-.997h3c.348 0 .649.18.828.45l4.996 7.492c.11.148.168.347.168.55zm0 0"></path></g></svg></button></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/cloud-operations-best-practices/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><a class="breadcrumbs__link" href="/cloud-operations-best-practices/docs/guides/"><span>Best practices</span></a></li><li class="breadcrumbs__item"><a class="breadcrumbs__link" href="/cloud-operations-best-practices/docs/guides/AWS CloudTrail/"><span>AWS CloudTrail</span></a></li><li class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link">CloudTrail Network Activity Events</span></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>CloudTrail Network Activity Events</h1></header>
<p>With network activity events for VPC endpoints, you can view details of who is accessing resources within your network giving you greater ability to identify and respond to malicious or unauthorized actions in your data perimeter. For example, as the VPC endpoint owner, you can view logs of actions that were denied due to VPC endpoint policies or determine if an actor outside of your data perimeter is trying to access the data in your S3 buckets.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="advanced-event-selectors-for-network-activity-events">Advanced Event Selectors for Network Activity Events<a href="#advanced-event-selectors-for-network-activity-events" class="hash-link" aria-label="Direct link to Advanced Event Selectors for Network Activity Events" title="Direct link to Advanced Event Selectors for Network Activity Events">​</a></h3>
<p>When you use network activity events, advanced event selectors offer greater control over which CloudTrail events are ingested into your event data stores. With advanced event selectors, you can include or exclude values on fields such as errorCode, eventName, &amp; vpcEndpointId. Advanced event selectors also support including or excluding values with pattern matching on partial strings. This increases the efficiency and precision of your security, compliance, and operational investigations while helping reduce costs. For example, you can filter CloudTrail events based on the vpcEndpointId attribute to only inlcude events from a specific VPC edpoint Id. This allows you to significantly reduce the volume of CloudTrail events ingested into CloudTrail Lake, lowering costs while maintaining visibility into relevant user and system activities.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="demo-network-activity-events-for-cloudtrail-lake"><a href="https://aws-cloudops.storylane.io/demo/n5vlqcsmygpi" target="_blank" rel="noopener noreferrer">Demo: Network Activity Events for CloudTrail Lake</a><a href="#demo-network-activity-events-for-cloudtrail-lake" class="hash-link" aria-label="Direct link to demo-network-activity-events-for-cloudtrail-lake" title="Direct link to demo-network-activity-events-for-cloudtrail-lake">​</a></h3>
<p>In the following interactive demo we will explore how to use network activity events for VPC endpoints in CloudTrail Lake.</p>
<div><script async="" src="https://js.storylane.io/js/v2/storylane.js"></script><div class="sl-embed" style="position:relative;padding-bottom:56.25%;width:100%;height:0;transform:scale(1)"><iframe loading="lazy" class="sl-demo" src="https://aws-cloudops.storylane.io/demo/n5vlqcsmygpi?embed=inline" name="sl-embed" allow="fullscreen" style="position:absolute;top:0;left:0;width:100%;height:100%;border:1px solid rgba(63,95,172,0.35);box-shadow:0px 0px 18px rgba(26, 19, 72, 0.15);border-radius:10px;box-sizing:border-box"></iframe></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="sample-sql-queries-for-cloudtrail-lake">Sample SQL Queries for CloudTrail Lake:<a href="#sample-sql-queries-for-cloudtrail-lake" class="hash-link" aria-label="Direct link to Sample SQL Queries for CloudTrail Lake:" title="Direct link to Sample SQL Queries for CloudTrail Lake:">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="count-of-vpc-access-denied-errors">Count of VPC Access Denied Errors<a href="#count-of-vpc-access-denied-errors" class="hash-link" aria-label="Direct link to Count of VPC Access Denied Errors" title="Direct link to Count of VPC Access Denied Errors">​</a></h4>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">SELECT count(*) as VPCAccessDenied, userIdentity.arn,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    userIdentity.accountid,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    eventName,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    errorMessage,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    vpcEndpointId,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    vpcEndpointAccountId,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    sourceIPAddress</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">FROM $EDS_ID</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">WHERE eventCategory = &#x27;NetworkActivity&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    AND eventSource = &#x27;s3.amazonaws.com&#x27; </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    AND errorCode = &#x27;VpceAccessDenied&#x27; </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    AND eventtime &gt;= &#x27;2025-02-18 17:00:00&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    AND eventtime &lt;= &#x27;2025-02-21 17:00:00&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    GROUP BY </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    userIdentity.arn,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    userIdentity.accountid,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    eventName,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    errorMessage,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    vpcEndpointId,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    vpcEndpointAccountId,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    sourceIPAddress</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ORDER BY eventName DESC;</span><br></span></code></pre></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="vpc-access-denied-errors">VPC Access Denied Errors<a href="#vpc-access-denied-errors" class="hash-link" aria-label="Direct link to VPC Access Denied Errors" title="Direct link to VPC Access Denied Errors">​</a></h4>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">SELECT userIdentity.arn,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    userIdentity.accountid,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    eventType,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    eventCategory,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    eventName,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    errorCode,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    errorMessage,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    vpcEndpointId,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    vpcEndpointAccountId,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    sourceIPAddress</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">FROM $EDS_ID</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">WHERE eventCategory = &#x27;NetworkActivity&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    AND eventSource = &#x27;s3.amazonaws.com&#x27; </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    AND errorCode = &#x27;VpceAccessDenied&#x27; </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    AND eventtime &gt;= &#x27;2025-02-18 17:00:00&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    AND eventtime &lt;= &#x27;2025-02-20 17:00:00&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ORDER BY eventTime DESC;</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="cloud-operation-show-securing-your-vpc-endpoints-using-network-activity-events--aws-cloudtrail">Cloud Operation Show: Securing your VPC Endpoints using Network Activity Events | AWS CloudTrail<a href="#cloud-operation-show-securing-your-vpc-endpoints-using-network-activity-events--aws-cloudtrail" class="hash-link" aria-label="Direct link to Cloud Operation Show: Securing your VPC Endpoints using Network Activity Events | AWS CloudTrail" title="Direct link to Cloud Operation Show: Securing your VPC Endpoints using Network Activity Events | AWS CloudTrail">​</a></h3>
<div align="center"><iframe width="560" height="315" src="https://www.youtube.com/embed/pAppy_tkWPY?si=sy7w_Yp8nejmwbLv" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" referrerpolicy="strict-origin-when-cross-origin"></iframe></div></div></article><nav class="docusaurus-mt-lg pagination-nav" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/cloud-operations-best-practices/docs/guides/AWS CloudTrail/CloudTrail-DataEvents/"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">CloudTrail Data Events</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/cloud-operations-best-practices/docs/guides/AWS Config/"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">AWS Config</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#advanced-event-selectors-for-network-activity-events" class="table-of-contents__link toc-highlight">Advanced Event Selectors for Network Activity Events</a></li><li><a href="#demo-network-activity-events-for-cloudtrail-lake" class="table-of-contents__link toc-highlight">Demo: Network Activity Events for CloudTrail Lake</a></li><li><a href="#sample-sql-queries-for-cloudtrail-lake" class="table-of-contents__link toc-highlight">Sample SQL Queries for CloudTrail Lake:</a></li><li><a href="#cloud-operation-show-securing-your-vpc-endpoints-using-network-activity-events--aws-cloudtrail" class="table-of-contents__link toc-highlight">Cloud Operation Show: Securing your VPC Endpoints using Network Activity Events | AWS CloudTrail</a></li></ul></div></div></div></div></main></div></div></div><footer class="theme-layout-footer footer footer--dark"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="footer__copyright">Built with ❤️ at AWS. <br> © 2025.  Amazon.com, Inc. or its affiliates. All Rights Reserved.</div></div></div></footer></div>
</body>
</html>