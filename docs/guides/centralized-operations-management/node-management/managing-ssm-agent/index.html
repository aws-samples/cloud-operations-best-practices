<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-guides/centralized-operations-management/node-management/managing-ssm-agent" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.9.2">
<title data-rh="true">Managing SSM Agent within an AWS Organization | AWS Cloud Operations Best Practices</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://aws-samples.github.io/cloud-operations-best-practices/docs/guides/centralized-operations-management/node-management/managing-ssm-agent"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Managing SSM Agent within an AWS Organization | AWS Cloud Operations Best Practices"><meta data-rh="true" name="description" content="This section outlines how to manage SSM agent installation within an AWS Organization and provides sample code CloudFormation, Terraform, Shell, PowerShell, Ansible, Chef, and Puppet."><meta data-rh="true" property="og:description" content="This section outlines how to manage SSM agent installation within an AWS Organization and provides sample code CloudFormation, Terraform, Shell, PowerShell, Ansible, Chef, and Puppet."><link data-rh="true" rel="icon" href="/cloud-operations-best-practices/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://aws-samples.github.io/cloud-operations-best-practices/docs/guides/centralized-operations-management/node-management/managing-ssm-agent"><link data-rh="true" rel="alternate" href="https://aws-samples.github.io/cloud-operations-best-practices/docs/guides/centralized-operations-management/node-management/managing-ssm-agent" hreflang="en"><link data-rh="true" rel="alternate" href="https://aws-samples.github.io/cloud-operations-best-practices/docs/guides/centralized-operations-management/node-management/managing-ssm-agent" hreflang="x-default"><script data-rh="true" type="application/ld+json">{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Best practices","item":"https://aws-samples.github.io/cloud-operations-best-practices/docs/guides/"},{"@type":"ListItem","position":2,"name":"Centralized Operations Management","item":"https://aws-samples.github.io/cloud-operations-best-practices/docs/guides/centralized-operations-management/"},{"@type":"ListItem","position":3,"name":"Node Management","item":"https://aws-samples.github.io/cloud-operations-best-practices/docs/guides/centralized-operations-management/node-management/"},{"@type":"ListItem","position":4,"name":"Managing SSM Agent within an AWS Organization","item":"https://aws-samples.github.io/cloud-operations-best-practices/docs/guides/centralized-operations-management/node-management/managing-ssm-agent"}]}</script><link rel="stylesheet" href="/cloud-operations-best-practices/assets/css/styles.4d5a722e.css">
<script src="/cloud-operations-best-practices/assets/js/runtime~main.151ff5ba.js" defer="defer"></script>
<script src="/cloud-operations-best-practices/assets/js/main.dcc7877e.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<svg style="display: none;"><defs>
<symbol id="theme-svg-external-link" viewBox="0 0 24 24"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></symbol>
</defs></svg>
<script>!function(){var t=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();document.documentElement.setAttribute("data-theme",t||(window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light")),document.documentElement.setAttribute("data-theme-choice",t||"system")}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="theme-layout-navbar navbar navbar--fixed-top"><div class="navbar__inner"><div class="theme-layout-navbar-left navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/cloud-operations-best-practices/"><b class="navbar__title text--truncate">AWS Cloud Operations Best Practices</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/cloud-operations-best-practices/docs/home">Home</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/cloud-operations-best-practices/docs/guides/">Guides</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/cloud-operations-best-practices/docs/solutions/">Solutions</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/cloud-operations-best-practices/docs/recipes/">Recipes</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/cloud-operations-best-practices/docs/faq/">FAQ</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/cloud-operations-best-practices/docs/contributors">Contributors</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/cloud-operations-best-practices/docs/resources/">Resources</a></div><div class="theme-layout-navbar-right navbar__items navbar__items--right"><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link"><svg viewBox="0 0 24 24" width="20" height="20" aria-hidden="true" class="iconLanguage_nlXk"><path fill="currentColor" d="M12.87 15.07l-2.54-2.51.03-.03c1.74-1.94 2.98-4.17 3.71-6.53H17V4h-7V2H8v2H1v1.99h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11.76-2.04zM18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2l-4.5-12zm-2.62 7l1.62-4.33L19.12 17h-3.24z"></path></svg>English</a><ul class="dropdown__menu"><li><a href="/cloud-operations-best-practices/docs/guides/centralized-operations-management/node-management/managing-ssm-agent" target="_self" rel="noopener noreferrer" class="dropdown__link dropdown__link--active" lang="en">English</a></li></ul></div><a href="https://github.com/aws-samples/cloud-operations-best-practices" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="system mode" aria-label="Switch between dark and light mode (currently system mode)"><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP systemToggleIcon_QzmC"><path fill="currentColor" d="m12 21c4.971 0 9-4.029 9-9s-4.029-9-9-9-9 4.029-9 9 4.029 9 9 9zm4.95-13.95c1.313 1.313 2.05 3.093 2.05 4.95s-0.738 3.637-2.05 4.95c-1.313 1.313-3.093 2.05-4.95 2.05v-14c1.857 0 3.637 0.737 4.95 2.05z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="theme-layout-main main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/cloud-operations-best-practices/docs/home"><span title="What is AWS Cloud Operations" class="linkLabel_WmDU">What is AWS Cloud Operations</span></a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--active" href="/cloud-operations-best-practices/docs/guides/"><span title="Best practices" class="categoryLinkLabel_W154">Best practices</span></a><button aria-label="Collapse sidebar category &#x27;Best practices&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist" tabindex="0" href="/cloud-operations-best-practices/docs/guides/AWS CloudTrail/"><span title="AWS CloudTrail" class="categoryLinkLabel_W154">AWS CloudTrail</span></a><button aria-label="Expand sidebar category &#x27;AWS CloudTrail&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist" tabindex="0" href="/cloud-operations-best-practices/docs/guides/AWS Config/"><span title="AWS Config" class="categoryLinkLabel_W154">AWS Config</span></a><button aria-label="Expand sidebar category &#x27;AWS Config&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist" tabindex="0" href="/cloud-operations-best-practices/docs/guides/AWS Control Tower/"><span title="AWS Control Tower" class="categoryLinkLabel_W154">AWS Control Tower</span></a><button aria-label="Expand sidebar category &#x27;AWS Control Tower&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist" tabindex="0" href="/cloud-operations-best-practices/docs/guides/AWS Region Usage/"><span title="AWS Region Usage" class="categoryLinkLabel_W154">AWS Region Usage</span></a><button aria-label="Expand sidebar category &#x27;AWS Region Usage&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist" tabindex="0" href="/cloud-operations-best-practices/docs/guides/application-operations/"><span title="Application Operations" class="categoryLinkLabel_W154">Application Operations</span></a><button aria-label="Expand sidebar category &#x27;Application Operations&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--active" tabindex="0" href="/cloud-operations-best-practices/docs/guides/centralized-operations-management/"><span title="Centralized Operations Management" class="categoryLinkLabel_W154">Centralized Operations Management</span></a><button aria-label="Collapse sidebar category &#x27;Centralized Operations Management&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--active" tabindex="0" href="/cloud-operations-best-practices/docs/guides/centralized-operations-management/node-management/"><span title="Node Management" class="categoryLinkLabel_W154">Node Management</span></a><button aria-label="Collapse sidebar category &#x27;Node Management&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/cloud-operations-best-practices/docs/guides/centralized-operations-management/node-management/managing-ssm-agent"><span title="Managing SSM Agent within an AWS Organization" class="linkLabel_WmDU">Managing SSM Agent within an AWS Organization</span></a></li></ul></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/cloud-operations-best-practices/docs/guides/centralized-operations-management/patch-management/"><span title="Patch Management" class="linkLabel_WmDU">Patch Management</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/cloud-operations-best-practices/docs/guides/centralized-operations-management/remote-and-session-management/"><span title="Remote and Session Management" class="linkLabel_WmDU">Remote and Session Management</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/cloud-operations-best-practices/docs/guides/centralized-operations-management/automation/"><span title="Automation" class="linkLabel_WmDU">Automation</span></a></li></ul></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist" href="/cloud-operations-best-practices/docs/solutions/"><span title="Solutions" class="categoryLinkLabel_W154">Solutions</span></a><button aria-label="Expand sidebar category &#x27;Solutions&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist" href="/cloud-operations-best-practices/docs/recipes/"><span title="Recipes" class="categoryLinkLabel_W154">Recipes</span></a><button aria-label="Expand sidebar category &#x27;Recipes&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist" href="/cloud-operations-best-practices/docs/faq/"><span title="FAQ" class="categoryLinkLabel_W154">FAQ</span></a><button aria-label="Expand sidebar category &#x27;FAQ&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist" href="/cloud-operations-best-practices/docs/resources/"><span title="Resources" class="categoryLinkLabel_W154">Resources</span></a><button aria-label="Expand sidebar category &#x27;Resources&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/cloud-operations-best-practices/docs/contributors"><span title="Contributors" class="linkLabel_WmDU">Contributors</span></a></li></ul></nav><button type="button" title="Collapse sidebar" aria-label="Collapse sidebar" class="button button--secondary button--outline collapseSidebarButton_PEFL"><svg width="20" height="20" aria-hidden="true" class="collapseSidebarButtonIcon_kv0_"><g fill="#7a7a7a"><path d="M9.992 10.023c0 .2-.062.399-.172.547l-4.996 7.492a.982.982 0 01-.828.454H1c-.55 0-1-.453-1-1 0-.2.059-.403.168-.551l4.629-6.942L.168 3.078A.939.939 0 010 2.528c0-.548.45-.997 1-.997h2.996c.352 0 .649.18.828.45L9.82 9.472c.11.148.172.347.172.55zm0 0"></path><path d="M19.98 10.023c0 .2-.058.399-.168.547l-4.996 7.492a.987.987 0 01-.828.454h-3c-.547 0-.996-.453-.996-1 0-.2.059-.403.168-.551l4.625-6.942-4.625-6.945a.939.939 0 01-.168-.55 1 1 0 01.996-.997h3c.348 0 .649.18.828.45l4.996 7.492c.11.148.168.347.168.55zm0 0"></path></g></svg></button></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/cloud-operations-best-practices/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><a class="breadcrumbs__link" href="/cloud-operations-best-practices/docs/guides/"><span>Best practices</span></a></li><li class="breadcrumbs__item"><a class="breadcrumbs__link" href="/cloud-operations-best-practices/docs/guides/centralized-operations-management/"><span>Centralized Operations Management</span></a></li><li class="breadcrumbs__item"><a class="breadcrumbs__link" href="/cloud-operations-best-practices/docs/guides/centralized-operations-management/node-management/"><span>Node Management</span></a></li><li class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link">Managing SSM Agent within an AWS Organization</span></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Managing SSM Agent within an AWS Organization</h1></header>
<p>This section outlines how to manage SSM agent installation within an AWS Organization and provides sample code CloudFormation, Terraform, Shell, PowerShell, Ansible, Chef, and Puppet.</p>
<p>Please keep in mind that this is sample code and should be thoroughly tested and validated in a development environment prior to any usage in a production environment.</p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="understanding-ssm-agent">Understanding SSM Agent<a href="#understanding-ssm-agent" class="hash-link" aria-label="Direct link to Understanding SSM Agent" title="Direct link to Understanding SSM Agent" translate="no">​</a></h2>
<p>As discussed in the previous sections, to get started with managing your nodes in your environment using Systems Manager, nodes must be <a href="https://docs.aws.amazon.com/systems-manager/latest/userguide/operating-systems-and-machine-types.html#supported-machine-types" target="_blank" rel="noopener noreferrer" class="">managed</a>, which means SSM Agent is installed on the machine and the agent can communicate with the Systems Manager service endpoints with required permissions.</p>
<p>AWS Systems Manager Agent (SSM Agent) is Amazon software that runs on Amazon Elastic Compute Cloud (Amazon EC2) instances, edge devices, on-premises servers, and virtual machines (VMs). The source code for SSM Agent is available on <a href="https://github.com/aws/amazon-ssm-agent" target="_blank" rel="noopener noreferrer" class="">GitHub</a>. SSM Agent makes it possible for Systems Manager to update, manage, and configure these resources. The agent processes requests from the Systems Manager service in the AWS Cloud, and then runs them as specified in the request.</p>
<p>Therefore, ensuring the SSM Agent is installed on nodes is necessary and the very first step to address when starting the journey with node management operations using the AWS Systems Manager service.</p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="operating-system-support">Operating system support<a href="#operating-system-support" class="hash-link" aria-label="Direct link to Operating system support" title="Direct link to Operating system support" translate="no">​</a></h2>
<p>SSM Agent is supported on a wide range of operating systems and machine types. See <a href="https://docs.aws.amazon.com/systems-manager/latest/userguide/operating-systems-and-machine-types.html" target="_blank" rel="noopener noreferrer" class="">Supported operating systems and machine types</a> in User guide to verify that your operating system (OS), OS version, and machine type are supported.</p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="amis-with-ssm-agent-pre-installed">AMIs with SSM Agent pre-installed<a href="#amis-with-ssm-agent-pre-installed" class="hash-link" aria-label="Direct link to AMIs with SSM Agent pre-installed" title="Direct link to AMIs with SSM Agent pre-installed" translate="no">​</a></h2>
<p>To get started with Systems Manager, AWS Systems Manager Agent (SSM Agent) is preinstalled on some Amazon Machine Images (AMIs) provided by AWS and trusted third-parties. See <a href="https://docs.aws.amazon.com/systems-manager/latest/userguide/ami-preinstalled-agent.html" target="_blank" rel="noopener noreferrer" class="">Find AMIs with the SSM Agent preinstalled</a>, to get the list of operating systems where its preinstalled.</p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="ssm-agent-installation-methods">SSM Agent installation methods<a href="#ssm-agent-installation-methods" class="hash-link" aria-label="Direct link to SSM Agent installation methods" title="Direct link to SSM Agent installation methods" translate="no">​</a></h2>
<p>Now that we understand which operating systems support SSM Agent, let&#x27;s explore the various methods to install the agent on instances which do not have SSM Agent preinstalled. The installation approach can be categorized into two main scenarios:</p>
<ul>
<li class=""><strong>New instance deployment</strong>: Installing SSM Agent when launching new instances.</li>
<li class=""><strong>Existing instance management</strong>: Installing SSM Agent on already running instances.</li>
</ul>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="installing-ssm-agent-on-new-instances">Installing SSM Agent on new instances<a href="#installing-ssm-agent-on-new-instances" class="hash-link" aria-label="Direct link to Installing SSM Agent on new instances" title="Direct link to Installing SSM Agent on new instances" translate="no">​</a></h3>
<p>When launching new instances, incorporating SSM Agent installation into your initial setup process ensures consistent management capabilities from the start. This approach eliminates the need for post-deployment installation. You can achieve this through various methods such as Golden AMIs, user data scripts, or infrastructure as code tools etc. The choice of method often depends on your organization&#x27;s deployment practices and scaling requirements.</p>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="golden-ami-approach">Golden AMI Approach<a href="#golden-ami-approach" class="hash-link" aria-label="Direct link to Golden AMI Approach" title="Direct link to Golden AMI Approach" translate="no">​</a></h4>
<p>A Golden AMI is a customized Amazon Machine Image that serves as a standardized template for launching EC2 instances. For Systems Manager integration, organizations can create Golden AMIs with SSM Agent pre-installed, ensuring all instances launched from these AMIs are immediately manageable through Systems Manager. This approach eliminates the need for post-launch installation scripts and reduces the risk of deployment failures.</p>
<p>Creating a Golden AMI</p>
<ol>
<li class="">Manually: Creating a Golden AMI manually can be done by launching an instance, installing and configuring SSM Agent, testing the configuration, and then creating an AMI from that instance.</li>
<li class="">EC2 Image builder: If you are using EC2 Image Builder for creating golden images, configure the <a href="https://docs.aws.amazon.com/imagebuilder/latest/userguide/start-build-image-pipeline.html#start-build-image-step2" target="_blank" rel="noopener noreferrer" class="">image recipe</a> and select the option to keeps the SSM agent in the output image.</li>
<li class="">Hashicorp Packer: If you are Hasicorp Packer, use the shell Packer provisioner to run shell commands to install SSM agent.</li>
</ol>
<div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;provisioners&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token property" style="color:#36acaa">&quot;type&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;shell&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token property" style="color:#36acaa">&quot;inline&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;if [ -f /etc/system-release ]; then&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;  # Amazon Linux&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;  sudo yum install -y amazon-ssm-agent&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;  sudo systemctl enable amazon-ssm-agent&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;  sudo systemctl start amazon-ssm-agent&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;elif [ -f /etc/lsb-release ]; then&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;  # Ubuntu&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;  sudo snap install amazon-ssm-agent —classic&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;  sudo systemctl enable snap.amazon-ssm-agent.amazon-ssm-agent.service&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;  sudo systemctl start snap.amazon-ssm-agent.amazon-ssm-agent.service&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;fi&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre></div></div>
<p>Alternatively, provide the path to the script which contains Agent installation shell commands.</p>
<div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;provisioners&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;type&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;shell&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;script&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;scripts/install_ssm.sh&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre></div></div>
<p>When using Packer with script provisioner, the <code>install_ssm.sh</code> should be stored relative to your Packer configuration file (<code>.json</code> or <code>.pkr</code> <code>.hcl</code>).</p>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="infrastructure-as-code-iac">Infrastructure as Code (IaC)<a href="#infrastructure-as-code-iac" class="hash-link" aria-label="Direct link to Infrastructure as Code (IaC)" title="Direct link to Infrastructure as Code (IaC)" translate="no">​</a></h4>
<!-- -->
<div class="theme-tabs-container tabs-container tabList__CuJ"><ul role="tablist" aria-orientation="horizontal" class="tabs"><li role="tab" tabindex="0" aria-selected="true" class="tabs__item tabItem_LNqP tabs__item--active">CloudFormation</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_LNqP">Terraform</li></ul><div class="margin-top--md"><div role="tabpanel" class="tabItem_Ymn6"><p>If you use CloudFormation to launch instances using AMIs that do not have SSM agent pre-installed, you can leverage the <code>UserData</code> property to install SSM agent.</p><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># EC2 Instance</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">EC2Instance</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">Type</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> AWS</span><span class="token punctuation" style="color:#393A34">:</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">EC2</span><span class="token punctuation" style="color:#393A34">:</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">Instance</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">Properties</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">ImageId</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token tag" style="color:#00009f">!FindInMap</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> RegionMap</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token tag" style="color:#00009f">!Ref</span><span class="token plain"> AWS</span><span class="token punctuation" style="color:#393A34">:</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">Region</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token tag" style="color:#00009f">!Ref</span><span class="token plain"> OperatingSystem</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">InstanceType</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token tag" style="color:#00009f">!FindInMap</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> EnvironmentSettings</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token tag" style="color:#00009f">!Ref</span><span class="token plain"> EnvironmentType</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> InstanceType</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">IamInstanceProfile</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token tag" style="color:#00009f">!Ref</span><span class="token plain"> SSMInstanceProfile</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">UserData</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token tag" style="color:#00009f">!If</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token tag" style="color:#00009f">!Base64</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">&#x27;Fn::Sub&#x27;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">|</span><span class="token scalar string" style="color:#e3116c"></span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">            #!/bin/bash</span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">            # Install SSM Agent based on OS</span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">            if [ -f /etc/os-release ]; then</span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">                . /etc/os-release</span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">                case &quot;$ID&quot; in</span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">                    amzn|rhel)</span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">                        yum install -y amazon-ssm-agent</span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">                        systemctl enable amazon-ssm-agent</span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">                        systemctl start amazon-ssm-agent</span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">                        ;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">                    ubuntu)</span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">                        snap install amazon-ssm-agent —classic</span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">                        systemctl enable snap.amazon-ssm-agent.amazon-ssm-agent.service</span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">                        systemctl start snap.amazon-ssm-agent.amazon-ssm-agent.service</span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">                        ;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">                esac</span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">            fi</span><br></span></code></pre></div></div></div><div role="tabpanel" class="tabItem_Ymn6" hidden=""><p>When using Terraform, create a script file which contains SSM agent installation shell commands. Then use the <code>user_data</code> property of the instance resource to point to the installation script file.</p><div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># EC2 Instance</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">resource </span><span class="token string" style="color:#e3116c">&quot;aws_instance&quot;</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;web&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ami           = data.aws_ami.amazon_linux_2.id</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  instance_type = </span><span class="token string" style="color:#e3116c">&quot;t2.micro&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  subnet_id                   = data.aws_subnet.main.id</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  vpc_security_group_ids      = </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">aws_security_group.allow_ssm.id</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  iam_instance_profile        = aws_iam_instance_profile.ssm_profile.name</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  associate_public_ip_address = </span><span class="token boolean" style="color:#36acaa">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  user_data = filebase64(</span><span class="token string" style="color:#e3116c">&quot;${path.module}/scripts/install_ssm.sh&quot;</span><span class="token plain">)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  tags = </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Name = </span><span class="token string" style="color:#e3116c">&quot;SSM-enabled-instance&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Output</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">output </span><span class="token string" style="color:#e3116c">&quot;instance_id&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  value = aws_instance.web.id</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre></div></div></div></div></div>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="ec2-consoleapisdk">EC2 Console/API/SDK<a href="#ec2-consoleapisdk" class="hash-link" aria-label="Direct link to EC2 Console/API/SDK" title="Direct link to EC2 Console/API/SDK" translate="no">​</a></h4>
<p>When launching the EC2 instance using EC2 console or any SDK, add user data with SSM Agent installation commands to an Amazon EC2 instance before you launch the instance.</p>
<ul>
<li class="">Refer to steps mentioned in this article for Linux: <a href="https://repost.aws/knowledge-center/install-ssm-agent-ec2-linux" target="_blank" rel="noopener noreferrer" class="">How do I install SSM Agent on an Amazon EC2 Linux instance at launch?</a></li>
<li class="">Refer to steps mentioned in this article for Windows: <a href="https://repost.aws/knowledge-center/ssm-agent-windows-ec2" target="_blank" rel="noopener noreferrer" class="">How do I install AWS Systems Manager Agent (SSM Agent) on an Amazon EC2 Windows instance at launch?</a></li>
</ul>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="application-migration-service-mgn">Application Migration Service (MGN)<a href="#application-migration-service-mgn" class="hash-link" aria-label="Direct link to Application Migration Service (MGN)" title="Direct link to Application Migration Service (MGN)" translate="no">​</a></h4>
<p>If your servers are migrated and launched using Application Migration Service, use the <strong>post-launch</strong> settings to install SSM Agent. Refer to the steps outlined <a href="https://docs.aws.amazon.com/mgn/latest/ug/post-launch-settings.html#post-launch-settings-activation" target="_blank" rel="noopener noreferrer" class="">here</a>.</p>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="amazon-eks">Amazon EKS<a href="#amazon-eks" class="hash-link" aria-label="Direct link to Amazon EKS" title="Direct link to Amazon EKS" translate="no">​</a></h4>
<p>The latest Amazon EKS optimized AMIs install SSM Agent automatically. If you are using a customized AMI, to install SSM Agent, use <code>preBootstrapCommands</code> property as outlined <a href="https://docs.aws.amazon.com/prescriptive-guidance/latest/patterns/install-the-ssm-agent-and-cloudwatch-agent-on-amazon-eks-worker-nodes-using-prebootstrapcommands.html" target="_blank" rel="noopener noreferrer" class="">here</a>.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="installing-ssm-agent-on-running-instances">Installing SSM Agent on running instances<a href="#installing-ssm-agent-on-running-instances" class="hash-link" aria-label="Direct link to Installing SSM Agent on running instances" title="Direct link to Installing SSM Agent on running instances" translate="no">​</a></h3>
<p>For instances that are already running in your environment, you can install SSM Agent using various remote access and automation methods. The installation process varies depending on your operating system type, access methods available, and network configuration. This section describes different approaches you can use to install SSM Agent on your existing instances.</p>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="custom-solution">Custom solution<a href="#custom-solution" class="hash-link" aria-label="Direct link to Custom solution" title="Direct link to Custom solution" translate="no">​</a></h4>
<p>Refer to the <a href="https://aws.amazon.com/blogs/mt/automate-installing-ssm-agent-on-unmanaged-ec2-instances-in-an-aws-organization/" target="_blank" rel="noopener noreferrer" class="">public blog</a> on <strong>Automate installing AWS Systems Manager agent on unmanaged Amazon EC2 nodes</strong>.
This solution uses userdata to install ssm agent and automation runbooks orchestrate this process accross regions and accounts.</p>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="configuration-management-tools">Configuration management tools<a href="#configuration-management-tools" class="hash-link" aria-label="Direct link to Configuration management tools" title="Direct link to Configuration management tools" translate="no">​</a></h4>
<p>If your organization uses configuration management tools such as Puppet, Chef, or Ansible, you can leverage these existing tools to deploy SSM Agent across your instances.</p>
<div class="theme-tabs-container tabs-container tabList__CuJ"><ul role="tablist" aria-orientation="horizontal" class="tabs"><li role="tab" tabindex="0" aria-selected="true" class="tabs__item tabItem_LNqP tabs__item--active">Ansible</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_LNqP">Chef</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_LNqP">Puppet</li></ul><div class="margin-top--md"><div role="tabpanel" class="tabItem_Ymn6"><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Install SSM Agent across fleet</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">hosts</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> all</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">become</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> yes</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">tasks</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Detect OS family</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">ansible.builtin.set_fact</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">os_family</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;{{ ansible_facts[&#x27;os_family&#x27;] }}&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Install SSM Agent on RedHat family</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">block</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Download SSM Agent RPM</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">get_url</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token key atrule" style="color:#00a4db">url</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;https://s3.{{ aws_region }}.amazonaws.com/amazon-ssm-{{ aws_region }}/latest/linux_amd64/amazon-ssm-agent.rpm&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token key atrule" style="color:#00a4db">dest</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> /tmp/amazon</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">ssm</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">agent.rpm</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token key atrule" style="color:#00a4db">mode</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;0644&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Install SSM Agent</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">yum</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> /tmp/amazon</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">ssm</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">agent.rpm</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token key atrule" style="color:#00a4db">state</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> present</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">when</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> os_family == &quot;RedHat&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Install SSM Agent on Debian family</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">block</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Install SSM Agent via Snap</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">community.general.snap</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> amazon</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">ssm</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">agent</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token key atrule" style="color:#00a4db">classic</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> yes</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">when</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> os_family == &quot;Debian&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Enable and start SSM Agent</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">systemd</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> amazon</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">ssm</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">agent</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">enabled</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> yes</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">state</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> started</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Verify installation</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">command</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> systemctl status amazon</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">ssm</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">agent</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">register</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> ssm_status</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">ignore_errors</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> yes</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Report status</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">debug</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">var</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> ssm_status.stdout_lines</span><br></span></code></pre></div></div></div><div role="tabpanel" class="tabItem_Ymn6" hidden=""><div class="language-puppet codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-puppet codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token variable" style="color:#36acaa">$facts</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&#x27;os&#x27;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&#x27;family&#x27;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;RedHat&#x27;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  package </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;amazon-ssm-agent&#x27;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token attr-name" style="color:#00a4db">ensure</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> installed</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token attr-name" style="color:#00a4db">source</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;s3.amazonaws.com/ec2-downloads-windows/SSMAgent/latest/linux_amd64/amazon-ssm-agent.rpm&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token attr-name" style="color:#00a4db">provider</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;rpm&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">elsif</span><span class="token plain"> </span><span class="token variable" style="color:#36acaa">$facts</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&#x27;os&#x27;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&#x27;family&#x27;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;Debian&#x27;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  package </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;amazon-ssm-agent&#x27;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token attr-name" style="color:#00a4db">ensure</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> installed</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token attr-name" style="color:#00a4db">source</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;s3.amazonaws.com/ec2-downloads-windows/SSMAgent/latest/debian_amd64/amazon-ssm-agent.deb&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token attr-name" style="color:#00a4db">provider</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;dpkg&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">service </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;amazon-ssm-agent&#x27;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token attr-name" style="color:#00a4db">ensure</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> running</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token attr-name" style="color:#00a4db">enable</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token attr-name" style="color:#00a4db">require</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> Package</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&#x27;amazon-ssm-agent&#x27;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre></div></div></div><div role="tabpanel" class="tabItem_Ymn6" hidden=""><div class="language-ruby codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-ruby codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># cookbooks/ssm_agent/recipes/default.rb</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">case</span><span class="token plain"> node</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string-literal string" style="color:#e3116c">&#x27;platform_family&#x27;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">when</span><span class="token plain"> </span><span class="token string-literal string" style="color:#e3116c">&#x27;rhel&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  remote_file </span><span class="token string-literal string" style="color:#e3116c">&#x27;/tmp/amazon-ssm-agent.rpm&#x27;</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">do</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    source </span><span class="token string-literal string" style="color:#e3116c">&quot;https://s3.</span><span class="token string-literal interpolation delimiter punctuation" style="color:#393A34">#{</span><span class="token string-literal interpolation content">node</span><span class="token string-literal interpolation content punctuation" style="color:#393A34">[</span><span class="token string-literal interpolation content string-literal string" style="color:#e3116c">&#x27;region&#x27;</span><span class="token string-literal interpolation content punctuation" style="color:#393A34">]</span><span class="token string-literal interpolation delimiter punctuation" style="color:#393A34">}</span><span class="token string-literal string" style="color:#e3116c">.amazonaws.com/amazon-ssm-</span><span class="token string-literal interpolation delimiter punctuation" style="color:#393A34">#{</span><span class="token string-literal interpolation content">node</span><span class="token string-literal interpolation content punctuation" style="color:#393A34">[</span><span class="token string-literal interpolation content string-literal string" style="color:#e3116c">&#x27;region&#x27;</span><span class="token string-literal interpolation content punctuation" style="color:#393A34">]</span><span class="token string-literal interpolation delimiter punctuation" style="color:#393A34">}</span><span class="token string-literal string" style="color:#e3116c">/latest/linux_amd64/amazon-ssm-agent.rpm&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    mode </span><span class="token string-literal string" style="color:#e3116c">&#x27;0644&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    action </span><span class="token symbol" style="color:#36acaa">:create</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">end</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  package </span><span class="token string-literal string" style="color:#e3116c">&#x27;amazon-ssm-agent&#x27;</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">do</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    source </span><span class="token string-literal string" style="color:#e3116c">&#x27;/tmp/amazon-ssm-agent.rpm&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    action </span><span class="token symbol" style="color:#36acaa">:install</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">end</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">when</span><span class="token plain"> </span><span class="token string-literal string" style="color:#e3116c">&#x27;debian&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  execute </span><span class="token string-literal string" style="color:#e3116c">&#x27;install_ssm_agent&#x27;</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">do</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    command &#x27;snap install amazon</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">ssm</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">agent —classic’</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    not_if </span><span class="token string-literal string" style="color:#e3116c">&#x27;snap list | grep amazon-ssm-agent&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">end</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">end</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">service </span><span class="token string-literal string" style="color:#e3116c">&#x27;amazon-ssm-agent&#x27;</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">do</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  action </span><span class="token punctuation" style="color:#393A34">[</span><span class="token symbol" style="color:#36acaa">:enable</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token symbol" style="color:#36acaa">:start</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">end</span><br></span></code></pre></div></div></div></div></div>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="ec2-user-data">EC2 user data<a href="#ec2-user-data" class="hash-link" aria-label="Direct link to EC2 user data" title="Direct link to EC2 user data" translate="no">​</a></h4>
<p>By default, user data command and cloud-init directives run only during the first boot cycle when an EC2 instance is launched. However, you can configure your user data command and cloud-init directives with a mime multi-part file.</p>
<p>To update the user data, <strong>stop</strong> the Instance. Click on <strong>Actions</strong>, Select <strong>Instance settings</strong> and choose <strong>Edit User Data</strong>.</p>
<div class="theme-tabs-container tabs-container tabList__CuJ"><ul role="tablist" aria-orientation="horizontal" class="tabs"><li role="tab" tabindex="0" aria-selected="true" class="tabs__item tabItem_LNqP tabs__item--active">Linux</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_LNqP">Windows</li></ul><div class="margin-top--md"><div role="tabpanel" class="tabItem_Ymn6"><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Content-Type: multipart/mixed; boundary=&quot;//&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MIME-Version: 1.0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">--//</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Content-Type: text/cloud-config; charset=&quot;us-ascii&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MIME-Version: 1.0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Content-Transfer-Encoding: 7bit</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Content-Disposition: attachment;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> filename=&quot;cloud-config.txt&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#cloud-config</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cloud_final_modules:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- [scripts-user, always]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">--//</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Content-Type: text/x-shellscript; charset=&quot;us-ascii&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MIME-Version: 1.0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Content-Transfer-Encoding: 7bit</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Content-Disposition: attachment; filename=&quot;userdata.txt&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#!/bin/bash</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Amazon Linux 2, RHEL</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">dnf install -y s3.amazonaws.com/ec2-downloads-windows/SSMAgent/latest/linux_amd64/amazon-ssm-agent.rpm</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">systemctl enable amazon-ssm-agent</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">systemctl start amazon-ssm-agent</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">--//--</span><br></span></code></pre></div></div></div><div role="tabpanel" class="tabItem_Ymn6" hidden=""><p><strong>Note</strong>: The below PowerShell script works only with the EC2Launch v2 launch agent.</p><div class="language-powershell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-powershell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">&lt;powershell&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token variable" style="color:#36acaa">$dir</span><span class="token plain"> = </span><span class="token variable" style="color:#36acaa">$env</span><span class="token plain">:TEMP </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;\ssm&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">New-Item</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-</span><span class="token plain">ItemType directory </span><span class="token operator" style="color:#393A34">-</span><span class="token plain">Path </span><span class="token variable" style="color:#36acaa">$dir</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-</span><span class="token plain">Force</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cd </span><span class="token variable" style="color:#36acaa">$dir</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">(</span><span class="token function" style="color:#d73a49">New-Object</span><span class="token plain"> System</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Net</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">WebClient</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">DownloadFile</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;https://s3.amazonaws.com/ec2-downloads-windows/SSMAgent/latest/windows_amd64/AmazonSSMAgentSetup.exe&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token variable" style="color:#36acaa">$dir</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;\AmazonSSMAgentSetup.exe&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">Start-Process</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">\AmazonSSMAgentSetup</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">exe </span><span class="token operator" style="color:#393A34">-</span><span class="token plain">ArgumentList @</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;/q&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;/log&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;install.log&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-</span><span class="token plain">Wait</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&lt;</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">powershell&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&lt;persist&gt;true&lt;</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">persist&gt;</span><br></span></code></pre></div></div></div></div></div>
<p>When done programmatically using the <code>ModifyInstanceAttribute</code> API, this script needs to be converted to base64-encoded text.</p>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="group-policy-for-windows">Group Policy (for Windows)<a href="#group-policy-for-windows" class="hash-link" aria-label="Direct link to Group Policy (for Windows)" title="Direct link to Group Policy (for Windows)" translate="no">​</a></h4>
<p>While Group Policy traditionally supports .msi packages, the AWS Systems Manager (SSM) Agent comes as an .exe file. To overcome this limitation, we&#x27;ll use a combination of Group Policy and Scheduled Tasks to deploy the SSM Agent across your Windows environment.</p>
<ol>
<li class="">
<p>Create (or modify an existing) GPO in the appropriate hierarchy/OU in Active Directory. Edit the policy to utilize the computer scheduled task script configuration.</p>
</li>
<li class="">
<p>The option is located under Computer Configuration | Preferences | Control Panel Settings | Scheduled Tasks | Right-click and select New→Immediate Task</p>
</li>
<li class="">
<p>Select <strong>Create</strong> for the action, give the task a name, and specify <code>NT AUTHORITY\System</code> as the user account to run the task. Click on the radio button for <strong>Run whether user is logged on or not</strong> and click the <strong>Triggers</strong> tab to proceed to the next section.</p>
</li>
</ol>
<p><img decoding="async" loading="lazy" alt="Task Manager screenshot for SSMAgent properties" src="/cloud-operations-best-practices/assets/images/task-manager-ssm-agent-f98d1f2259433a0689accb0a3168fbbb.png" title="Task Manager screenshot for SSMAgent properties" width="720" height="608" class="img_ev3q"></p>
<ol start="4">
<li class="">
<p>For triggers, choose one time.</p>
</li>
<li class="">
<p>Create a new action to <strong>Start a program</strong> and choose <code>powershell.exe</code> and for the <strong>Argument</strong> use the following:</p>
</li>
</ol>
<div class="language-powershell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-powershell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token operator" style="color:#393A34">-</span><span class="token plain">ExecutionPolicy Bypass </span><span class="token operator" style="color:#393A34">-</span><span class="token plain">Command </span><span class="token string" style="color:#e3116c">&quot;</span><span class="token string variable" style="color:#36acaa">$dir</span><span class="token string" style="color:#e3116c"> = </span><span class="token string variable" style="color:#36acaa">$env</span><span class="token string" style="color:#e3116c">:TEMP + &#x27;\ssm&#x27;; New-Item -ItemType directory -Path </span><span class="token string variable" style="color:#36acaa">$dir</span><span class="token string" style="color:#e3116c"> -Force; Set-Location </span><span class="token string variable" style="color:#36acaa">$dir</span><span class="token string" style="color:#e3116c">; (New-Object System.Net.WebClient).DownloadFile(&#x27;https://s3.amazonaws.com/ec2-downloads-windows/SSMAgent/latest/windows_amd64/AmazonSSMAgentSetup.exe&#x27;, </span><span class="token string variable" style="color:#36acaa">$dir</span><span class="token string" style="color:#e3116c"> + &#x27;\AmazonSSMAgentSetup.exe&#x27;); Start-Process .\AmazonSSMAgentSetup.exe -ArgumentList @(&#x27;/q&#x27;, &#x27;/log&#x27;, &#x27;install.log&#x27;) -Wait&quot;</span><br></span></code></pre></div></div>
<p><img decoding="async" loading="lazy" alt="Task Manager screenshot for adding a new action" src="/cloud-operations-best-practices/assets/images/task-manager-new-action-13ff35dff112343bf46ba38b21cb16d6.png" title="Task Manager screenshot for adding a new action" width="2490" height="1424" class="img_ev3q"></p>
<ol start="6">
<li class="">
<p>Click <strong>OK</strong> on New Action window and click <strong>OK</strong> on Properties window to close out those dialogues.</p>
</li>
<li class="">
<p>Once this is complete, any linked computers should get the installer pushed to them when the GP policy updates or when using <code>gpudate /force</code> from the command prompt to force that action.</p>
</li>
</ol>
<p>For more information, see <a href="https://github.com/aws-samples/sample-ssm-automate-windows-hybrid-install" target="_blank" rel="noopener noreferrer" class="">Automate Registering Windows Managed Nodes in AWS Systems Manager</a>.</p>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="ssh-for-linux">SSH (for Linux)<a href="#ssh-for-linux" class="hash-link" aria-label="Direct link to SSH (for Linux)" title="Direct link to SSH (for Linux)" translate="no">​</a></h4>
<p>For Linux instances accessible via SSH, you can automate the SSM Agent installation using the following sample script. This script detects the OS type and installs the appropriate package.</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">#!/bin/bash</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">USERNAME=ec2-user</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">HOSTS=(&quot;192.168.1.121&quot; &quot;192.168.1.122&quot; &quot;192.168.1.123&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">KEY_PATH=&quot;/path/to/your/key.pem&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">for HOSTNAME in ${HOSTS}; do</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    # Detect OS type</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    OS_TYPE=$(ssh -i &quot;${KEY_PATH}&quot; -l ${USERNAME} ${HOSTNAME} &quot;cat /etc/os-release | grep &#x27;^ID=&#x27; | cut -d= -f2 | tr -d &#x27;\&quot;&#x27;&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    case ${OS_TYPE} in</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;amzn&quot;|&quot;rhel&quot;|&quot;centos&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            SCRIPT=&quot;sudo yum install -y s3.amazonaws.com/ec2-downloads-windows/SSMAgent/latest/linux_amd64/amazon-ssm-agent.rpm &amp;&amp; sudo systemctl start amazon-ssm-agent&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            ;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;ubuntu&quot;|&quot;debian&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            SCRIPT=&quot;wget s3.amazonaws.com/ec2-downloads-windows/SSMAgent/latest/debian_amd64/amazon-ssm-agent.deb &amp;&amp; sudo dpkg -i amazon-ssm-agent.deb &amp;&amp; sudo systemctl start amazon-ssm-agent&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            ;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        *)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            echo &quot;Unsupported OS on ${HOSTNAME}&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            continue</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            ;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    esac</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ssh -i &quot;${KEY_PATH}&quot; -l ${USERNAME} ${HOSTNAME} &quot;${SCRIPT}&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">done</span><br></span></code></pre></div></div>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="amazon-eks---existing-instances">Amazon EKS - Existing instances<a href="#amazon-eks---existing-instances" class="hash-link" aria-label="Direct link to Amazon EKS - Existing instances" title="Direct link to Amazon EKS - Existing instances" translate="no">​</a></h4>
<p>The latest Amazon EKS optimized AMIs install SSM Agent automatically. If you are using a customized AMI, to install SSM Agent on running worker nodes, use Kubernetes Daemonset as outlined <a href="https://docs.aws.amazon.com/prescriptive-guidance/latest/patterns/install-ssm-agent-on-amazon-eks-worker-nodes-by-using-kubernetes-daemonset.html" target="_blank" rel="noopener noreferrer" class="">here</a>.</p>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="amazon-workspaces">Amazon Workspaces<a href="#amazon-workspaces" class="hash-link" aria-label="Direct link to Amazon Workspaces" title="Direct link to Amazon Workspaces" translate="no">​</a></h4>
<p>Use the customized solution documented <a href="https://github.com/aws-samples/workspaces-ssm-install" target="_blank" rel="noopener noreferrer" class="">here</a>.</p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="managing-iam-permissions-for-ssm-agent">Managing IAM permissions for SSM Agent<a href="#managing-iam-permissions-for-ssm-agent" class="hash-link" aria-label="Direct link to Managing IAM permissions for SSM Agent" title="Direct link to Managing IAM permissions for SSM Agent" translate="no">​</a></h2>
<p>Proper IAM permissions are crucial for SSM Agent functionality. AWS provides multiple approaches to manage these permissions, from manual instance profile attachment to automated organization-wide solutions.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="default-host-management-configuration-dhmc">Default Host Management Configuration (DHMC)<a href="#default-host-management-configuration-dhmc" class="hash-link" aria-label="Direct link to Default Host Management Configuration (DHMC)" title="Direct link to Default Host Management Configuration (DHMC)" translate="no">​</a></h3>
<p>DHMC is AWS&#x27;s recommended approach for managing SSM Agent permissions across your organization. It makes it possible to manage EC2 instances without your having to manually create an AWS Identity and Access Management (IAM) instance profile. Instead, Default Host Management Configuration creates and applies a default IAM role to ensure that Systems Manager has permissions to manage all instances in the AWS account and AWS Region where it&#x27;s activated.</p>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="methods-to-enable-dhmc">Methods to enable DHMC:<a href="#methods-to-enable-dhmc" class="hash-link" aria-label="Direct link to Methods to enable DHMC:" title="Direct link to Methods to enable DHMC:" translate="no">​</a></h4>
<ul>
<li class=""><strong>Through Unified Console Experience</strong>: When <a href="https://docs.aws.amazon.com/systems-manager/latest/userguide/systems-manager-setting-up-organizations.html" target="_blank" rel="noopener noreferrer" class="">onboarding to unified console experience</a>, DHMC is automatically enabled. This is enabled using a State Manager association created during onboarding and will enable DHMC in each target account and region.</li>
<li class=""><strong>Using Fleet Manager</strong>: You can turn on the Default Host Management Configuration from the Fleet Manager console. You must turn on the Default Host Management Configuration one by one in each Region you where you want your Amazon EC2 instances managed. Refer to the steps <a href="https://docs.aws.amazon.com/systems-manager/latest/userguide/setup-instance-permissions.html#default-host-management" target="_blank" rel="noopener noreferrer" class="">here</a>.</li>
<li class=""><strong>Through CLI/SDK</strong>: This is done by creating the required role and updating the service setting using AWS CLI/SDK. You must turn on the Default Host Management Configuration one by one in each Region you where you want your Amazon EC2 instances managed. Refer to steps <a href="https://docs.aws.amazon.com/systems-manager/latest/userguide/fleet-manager-default-host-management-configuration.html#dhmc-activate" target="_blank" rel="noopener noreferrer" class="">here</a>.</li>
<li class=""><strong>Though Quick Setup</strong>: With Quick Setup, you can activate Default Host Management Configuration for all accounts and Regions that have been added to your organization in AWS Organizations. Refer to steps <a href="https://docs.aws.amazon.com/systems-manager/latest/userguide/fleet-manager-default-host-management-configuration.html#dhmc-activate" target="_blank" rel="noopener noreferrer" class="">here</a>.</li>
<li class=""><strong>Using CloudFormation</strong>: You can also use CloudFormation, to enable DHMC is multi accounts and region using StackSets. Refer to this <a href="https://aws.amazon.com/blogs/mt/enable-management-of-your-amazon-ec2-instances-in-aws-systems-manager-using-default-host-management-configuration/" target="_blank" rel="noopener noreferrer" class="">blog</a>.</li>
</ul>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="individual-instance-permissions">Individual instance permissions<a href="#individual-instance-permissions" class="hash-link" aria-label="Direct link to Individual instance permissions" title="Direct link to Individual instance permissions" translate="no">​</a></h3>
<p>If you are not using DHMC, the permission for SSM agent must be granted at each instance level by using IAM Instance Profiles. We recommend creating the Instance Profile with the recommended Amazon Managed Policy for SSM agent, AmazonSSMManagedInstanceCore. Additional permissions to this instance profile will be required depending on the use case. See <a href="https://docs.aws.amazon.com/systems-manager/latest/userguide/setup-instance-permissions.html#instance-profile-policies-overview" target="_blank" rel="noopener noreferrer" class="">Additional policy considerations for managed instances</a> in User guide which discusses creating an IAM instance profile for SSM agent use and additional policy considerations.</p>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="attaching-instance-profile-to-ec2-instances-at-launch">Attaching instance profile to EC2 instances at launch<a href="#attaching-instance-profile-to-ec2-instances-at-launch" class="hash-link" aria-label="Direct link to Attaching instance profile to EC2 instances at launch" title="Direct link to Attaching instance profile to EC2 instances at launch" translate="no">​</a></h4>
<div class="theme-tabs-container tabs-container tabList__CuJ"><ul role="tablist" aria-orientation="horizontal" class="tabs"><li role="tab" tabindex="0" aria-selected="true" class="tabs__item tabItem_LNqP tabs__item--active">CloudFormation</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_LNqP">Terraform</li></ul><div class="margin-top--md"><div role="tabpanel" class="tabItem_Ymn6"><p>If you are using CloudFormation to launch Instances, you can create an IAM instance profile resource and refer to it in your instance resource.</p><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">AWSTemplateFormatVersion</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;2010-09-09&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">Resources</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">SSMInstanceRole</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">Type</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;AWS::IAM::Role&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">Properties</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">AssumeRolePolicyDocument</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">Version</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;2012-10-17&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">Statement</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">Effect</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Allow</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token key atrule" style="color:#00a4db">Principal</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              </span><span class="token key atrule" style="color:#00a4db">Service</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> ec2.amazonaws.com</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token key atrule" style="color:#00a4db">Action</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> sts</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">AssumeRole</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">ManagedPolicyArns</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> arn</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">aws</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">iam</span><span class="token punctuation" style="color:#393A34">:</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">aws</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">policy/AmazonSSMManagedInstanceCore</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">SSMInstanceProfile</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">Type</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;AWS::IAM::InstanceProfile&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">Properties</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">Path</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> /</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">Roles</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token tag" style="color:#00009f">!Ref</span><span class="token plain"> SSMInstanceRole</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">EC2Instance</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">Type</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;AWS::EC2::Instance&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">Properties</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">IamInstanceProfile</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token tag" style="color:#00009f">!Ref</span><span class="token plain"> SSMInstanceProfile</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token comment" style="color:#999988;font-style:italic"># Other instance properties</span><br></span></code></pre></div></div><p>When deploying Autoscaling groups, the Launch template resource property can refer to use the Instance Profile.</p><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># ASG with SSM Instance Profile</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">Resources</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">AutoScalingGroup</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">Type</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> AWS</span><span class="token punctuation" style="color:#393A34">:</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">AutoScaling</span><span class="token punctuation" style="color:#393A34">:</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">AutoScalingGroup</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">Properties</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">LaunchTemplate</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">LaunchTemplateId</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token tag" style="color:#00009f">!Ref</span><span class="token plain"> LaunchTemplate</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">Version</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token tag" style="color:#00009f">!GetAtt</span><span class="token plain"> LaunchTemplate.LatestVersionNumber</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">LaunchTemplate</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">Type</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> AWS</span><span class="token punctuation" style="color:#393A34">:</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">EC2</span><span class="token punctuation" style="color:#393A34">:</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">LaunchTemplate</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">Properties</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">LaunchTemplateData</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">IamInstanceProfile</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">Name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token tag" style="color:#00009f">!Ref</span><span class="token plain"> SSMInstanceProfile</span><br></span></code></pre></div></div></div><div role="tabpanel" class="tabItem_Ymn6" hidden=""><p>If you are using Terraform to launch instances, you can create an IAM Instance Profile resource and refer it in your Instance resource.</p><div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># IAM Role and Instance Profile</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">resource </span><span class="token string" style="color:#e3116c">&quot;aws_iam_role&quot;</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;ssm_role&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  name = </span><span class="token string" style="color:#e3116c">&quot;SSMManagedInstanceRole&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  assume_role_policy = jsonencode(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Version = </span><span class="token string" style="color:#e3116c">&quot;2012-10-17&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Statement = </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Action = </span><span class="token string" style="color:#e3116c">&quot;sts:AssumeRole&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Effect = </span><span class="token string" style="color:#e3116c">&quot;Allow&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Principal = </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          Service = </span><span class="token string" style="color:#e3116c">&quot;ec2.amazonaws.com&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain">)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">resource </span><span class="token string" style="color:#e3116c">&quot;aws_iam_role_policy_attachment&quot;</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;ssm_policy&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  role       = aws_iam_role.ssm_role.name</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  policy_arn = </span><span class="token string" style="color:#e3116c">&quot;arn:aws:iam::aws:policy/AmazonSSMManagedInstanceCore&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">resource </span><span class="token string" style="color:#e3116c">&quot;aws_iam_instance_profile&quot;</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;ssm_profile&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  name = </span><span class="token string" style="color:#e3116c">&quot;SSMManagedInstanceProfile&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  role = aws_iam_role.ssm_role.name</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># EC2 Instance with Profile</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">resource </span><span class="token string" style="color:#e3116c">&quot;aws_instance&quot;</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;example&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  # ... other configuration ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  iam_instance_profile = aws_iam_instance_profile.ssm_profile.name</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre></div></div></div></div></div>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="launching-instances-using-systems-manager-automation-runbooks">Launching instances using Systems Manager Automation runbooks<a href="#launching-instances-using-systems-manager-automation-runbooks" class="hash-link" aria-label="Direct link to Launching instances using Systems Manager Automation runbooks" title="Direct link to Launching instances using Systems Manager Automation runbooks" translate="no">​</a></h4>
<p><a href="https://docs.aws.amazon.com/systems-manager-automation-runbooks/latest/userguide/automation-aws-createmanagedlinuxinstance.html" target="_blank" rel="noopener noreferrer" class="">AWS-CreateManagedLinuxInstance</a> and <a href="https://docs.aws.amazon.com/systems-manager-automation-runbooks/latest/userguide/automation-aws-createmanagedwindowsinstance.html" target="_blank" rel="noopener noreferrer" class="">AWS-CreateManagedWindowsInstance</a> are pre-configured Systems Manager Automation runbooks that automate the process of creating and configuring managed instances. These runbooks ensure the instance profile have the required SSM Permissions are attached to the launched instances.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="attaching-instance-profiles-to-already-running-ec2-instances">Attaching instance profiles to already running EC2 instances<a href="#attaching-instance-profiles-to-already-running-ec2-instances" class="hash-link" aria-label="Direct link to Attaching instance profiles to already running EC2 instances" title="Direct link to Attaching instance profiles to already running EC2 instances" translate="no">​</a></h3>
<ul>
<li class="">
<p>Using Quick Setup (Recommended): Using <a href="https://docs.aws.amazon.com/systems-manager/latest/userguide/quick-setup-host-management.html" target="_blank" rel="noopener noreferrer" class="">Amazon EC2 host management using Quick Setup</a>, you can configure to add the required IAM policies to the existing instance profiles attached to your instances, or to allow Quick Setup to create the IAM policies and instance profiles with the permissions needed for the configuration you choose. This option can target instances in multiple accounts in organization or specific OUs.</p>
</li>
<li class="">
<p>Using Systems Manager Automation : You can use the automation runbook <a href="https://docs.aws.amazon.com/systems-manager-automation-runbooks/latest/userguide/automation-aws-setupmanagedroleonec2instance.html" target="_blank" rel="noopener noreferrer" class="">AWS-SetupManagedRoleOnEc2Instance</a> to configure an instance with the SSMRoleForManagedInstance managed IAM role for Systems Manager access.. If the specified role does not exist, it will be created by the automation. To target instances in multiple account and regions, run the automation in <a href="https://docs.aws.amazon.com/systems-manager/latest/userguide/running-automations-multiple-accounts-regions.html" target="_blank" rel="noopener noreferrer" class="">multi-account/multi-Region</a> mode.</p>
</li>
</ul></div></article><nav class="docusaurus-mt-lg pagination-nav" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/cloud-operations-best-practices/docs/guides/centralized-operations-management/node-management/"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Node Management</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/cloud-operations-best-practices/docs/guides/centralized-operations-management/patch-management/"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Patch Management</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#understanding-ssm-agent" class="table-of-contents__link toc-highlight">Understanding SSM Agent</a></li><li><a href="#operating-system-support" class="table-of-contents__link toc-highlight">Operating system support</a></li><li><a href="#amis-with-ssm-agent-pre-installed" class="table-of-contents__link toc-highlight">AMIs with SSM Agent pre-installed</a></li><li><a href="#ssm-agent-installation-methods" class="table-of-contents__link toc-highlight">SSM Agent installation methods</a><ul><li><a href="#installing-ssm-agent-on-new-instances" class="table-of-contents__link toc-highlight">Installing SSM Agent on new instances</a></li><li><a href="#installing-ssm-agent-on-running-instances" class="table-of-contents__link toc-highlight">Installing SSM Agent on running instances</a></li></ul></li><li><a href="#managing-iam-permissions-for-ssm-agent" class="table-of-contents__link toc-highlight">Managing IAM permissions for SSM Agent</a><ul><li><a href="#default-host-management-configuration-dhmc" class="table-of-contents__link toc-highlight">Default Host Management Configuration (DHMC)</a></li><li><a href="#individual-instance-permissions" class="table-of-contents__link toc-highlight">Individual instance permissions</a></li><li><a href="#attaching-instance-profiles-to-already-running-ec2-instances" class="table-of-contents__link toc-highlight">Attaching instance profiles to already running EC2 instances</a></li></ul></li></ul></div></div></div></div></main></div></div></div><footer class="theme-layout-footer footer footer--dark"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="footer__copyright">Built with ❤️ at AWS. <br> © 2026.  Amazon.com, Inc. or its affiliates. All Rights Reserved.</div></div></div></footer></div>
</body>
</html>